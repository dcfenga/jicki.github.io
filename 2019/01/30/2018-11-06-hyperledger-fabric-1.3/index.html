<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Your future depends on your dreams">
    <meta name="keyword" content="小炒肉, 运维工程师, Jicki, DevOps, Docker, Kubernetes">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          hyperledger-fabric v 1.3 - 小炒肉 | Blog
        
    </title>

    <link rel="canonical" href="https://www.jicki.me/2019/01/30/2018-11-06-hyperledger-fabric-1.3/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('/img/article_header/article_bg.jpg')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#docker" title="docker">docker</a>
                            
                              <a class="tag" href="/tags/#fabric" title="fabric">fabric</a>
                            
                        </div>
                        <h1>hyperledger-fabric v 1.3</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 小炒肉 on
                            2019-01-30
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">小炒肉</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <blockquote>
<p>fabric v1.3 , 单机 多节点 kafka 手动部署, 所有服务均 开启 SSL 认证。</p>
</blockquote>
<h1><span id="部署-hyperledger-fabric-v13">部署 hyperledger-fabric v1.3</span></h1>
<h2><span id="环境规划">环境规划</span></h2>
<blockquote>
<p>相关hostname 必须配置 dns</p>
<p>关于 orderer 集群</p>
<p>当orderer 向peer节点提交Transaction的时候，peer节点会得到或返回一个读写集结果，该结果会发送给orderer节点进行共识和排序，此时如果orderer节点突然down掉，就会使请求服务失效而引发的数据丢失等问题，且目前的sdk对orderer发送的Transaction的回调会占用极长的时间，当大批量数据导入的时候该回调可认为不可用。</p>
</blockquote>
<table>
<thead>
<tr>
<th>节点标识</th>
<th>hostname</th>
<th>IP</th>
<th>开放端口</th>
<th>系统</th>
</tr>
</thead>
<tbody>
<tr>
<td>orderer0节点</td>
<td><a href="http://orderer0.jicki.me" target="_blank" rel="noopener">orderer0.jicki.me</a></td>
<td>192.168.100.100</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>orderer1节点</td>
<td><a href="http://orderer1.jicki.me" target="_blank" rel="noopener">orderer1.jicki.me</a></td>
<td>192.168.100.100</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>orderer2节点</td>
<td><a href="http://orderer2.jicki.me" target="_blank" rel="noopener">orderer2.jicki.me</a></td>
<td>192.168.100.100</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>peer0节点</td>
<td><a href="http://peer0.org1.jicki.me" target="_blank" rel="noopener">peer0.org1.jicki.me</a></td>
<td>192.168.100.100</td>
<td>7051, 7052, 7053</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>peer0节点</td>
<td><a href="http://peer0.org2.jicki.me" target="_blank" rel="noopener">peer0.org2.jicki.me</a></td>
<td>192.168.100.100</td>
<td>7051, 7052, 7053</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk0节点</td>
<td>zookeeper0</td>
<td>192.168.100.100</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk1节点</td>
<td>zookeeper1</td>
<td>192.168.100.100</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk2节点</td>
<td>zookeeper2</td>
<td>192.168.100.100</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka0节点</td>
<td>kafka0</td>
<td>192.168.100.100</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka1节点</td>
<td>kafka1</td>
<td>192.168.100.100</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka2节点</td>
<td>kafka2</td>
<td>192.168.100.100</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 配置一下 hosts 后面需要调用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># fabric</span><br><span class="line"></span><br><span class="line">192.168.168.100 orderer0.jicki.me</span><br><span class="line">192.168.168.100 orderer1.jicki.me</span><br><span class="line">192.168.168.100 orderer2.jicki.me</span><br><span class="line">192.168.168.100 peer0.org1.jicki.me</span><br><span class="line">192.168.168.100 peer0.org2.jicki.me</span><br><span class="line"></span><br><span class="line"># fabric</span><br></pre></td></tr></table></figure>
<h2><span id="官方地址">官方地址</span></h2>
<blockquote>
<p>文档以官方文档为主 <a href="http://hyperledger-fabric.readthedocs.io/en/release-1.3/prereqs.html" target="_blank" rel="noopener">http://hyperledger-fabric.readthedocs.io/en/release-1.3/prereqs.html</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 官网 github</span><br><span class="line">https://github.com/hyperledger/fabric</span><br></pre></td></tr></table></figure>
<h2><span id="环境准备">环境准备</span></h2>
<blockquote>
<p>所有机器 安装 Docker (用于 fabric 服务启动)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 导入 yum 源</span><br><span class="line"></span><br><span class="line"># 安装 yum-config-manager</span><br><span class="line"></span><br><span class="line">yum -y install yum-utils</span><br><span class="line"></span><br><span class="line"># 导入</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"># 安装 docker</span><br><span class="line"></span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 启动 docker </span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 查看 docker 版本</span><br><span class="line"></span><br><span class="line">docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.1-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        e68fc7a</span><br><span class="line"> Built:             Tue Aug 21 17:23:03 2018</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.06.1-ce</span><br><span class="line">  API version:      1.38 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.3</span><br><span class="line">  Git commit:       e68fc7a</span><br><span class="line">  Built:            Tue Aug 21 17:25:29 2018</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 Docker-compose (用于 docker 容器服务统一管理 编排)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 安装 pip</span><br><span class="line"></span><br><span class="line">curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</span><br><span class="line"></span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 安装 docker-compose</span><br><span class="line"></span><br><span class="line">pip install docker-compose --ignore-installed requests</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br><span class="line">docker-compose version 1.32.0, build f46880f</span><br><span class="line">docker-py version: 3.4.1</span><br><span class="line">CPython version: 2.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>
<ul>
<li>Golang (用于 fabric cli 服务的调用， ca 服务证书生成 )</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/golang</span><br><span class="line">mkdir -p /opt/gopath</span><br><span class="line"></span><br><span class="line"># 国外地址</span><br><span class="line">wget https://storage.googleapis.com/golang/go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"># 国内地址</span><br><span class="line">wget https://studygolang.com/dl/golang/go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar zxvf go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"># 配置环境变量</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">添加如下</span><br><span class="line"></span><br><span class="line"># golang env</span><br><span class="line">export PATH=$PATH:/opt/golang/go/bin</span><br><span class="line">export GOPATH=/opt/gopath</span><br><span class="line"></span><br><span class="line"># 生效配置</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看配置</span><br><span class="line"></span><br><span class="line">go version</span><br><span class="line">go version go1.10 linux/amd64</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-源码">Hyperledger Fabric 源码</span></h2>
<blockquote>
<p>fabric 源码用于 cli 智能合约安装时的依赖, 这里只用于第一个节点</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"># 下载 Fabric 源码, 源码中 import 的路径为github.com/hyperledger/fabric ,所以我们要按照这个路径</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/gopath/src/github.com/hyperledger</span><br><span class="line"></span><br><span class="line">cd /opt/gopath/src/github.com/hyperledger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">git clone https://github.com/hyperledger/fabric</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看分支</span><br><span class="line">git branch -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看本地分支</span><br><span class="line">git branch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 切换分支</span><br><span class="line">git checkout -b release-1.3 remotes/origin/release-1.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 文件如下:</span><br><span class="line"></span><br><span class="line">[root@localhost fabric]# ls -lt</span><br><span class="line">总用量 1240</span><br><span class="line">drwxr-xr-x  8 root root    153 11月  5 11:41 vendor</span><br><span class="line">drwxr-xr-x  4 root root     96 11月  5 11:41 token</span><br><span class="line">-rw-r--r--  1 root root    301 11月  5 11:41 tox.ini</span><br><span class="line">drwxr-xr-x  2 root root     56 11月  5 11:41 unit-test</span><br><span class="line">-rw-r--r--  1 root root   3816 11月  5 11:41 testingInfo.rst</span><br><span class="line">-rw-r--r--  1 root root 438053 11月  5 11:41 test-pyramid.png</span><br><span class="line">drwxr-xr-x  2 root root   4096 11月  5 11:41 scripts</span><br><span class="line">-rw-r--r--  1 root root    316 11月  5 11:41 settings.gradle</span><br><span class="line">drwxr-xr-x  4 root root    110 11月  5 11:41 sampleconfig</span><br><span class="line">drwxr-xr-x  3 root root     22 11月  5 11:41 release</span><br><span class="line">drwxr-xr-x  2 root root   4096 11月  5 11:41 release_notes</span><br><span class="line">drwxr-xr-x 14 root root   4096 11月  5 11:41 protos</span><br><span class="line">drwxr-xr-x 11 root root   4096 11月  5 11:41 peer</span><br><span class="line">drwxr-xr-x  6 root root    126 11月  5 11:41 orderer</span><br><span class="line">drwxr-xr-x  6 root root   4096 11月  5 11:41 msp</span><br><span class="line">drwxr-xr-x 12 root root   4096 11月  5 11:41 integration</span><br><span class="line">drwxr-xr-x  8 root root    112 11月  5 11:41 images</span><br><span class="line">drwxr-xr-x  2 root root   4096 11月  5 11:41 idemix</span><br><span class="line">drwxr-xr-x 16 root root   4096 11月  5 11:41 gossip</span><br><span class="line">-rw-r--r--  1 root root   2944 11月  5 11:41 gotools.mk</span><br><span class="line">drwxr-xr-x  8 root root    126 11月  5 11:41 examples</span><br><span class="line">drwxr-xr-x  5 root root    156 11月  5 11:41 docs</span><br><span class="line">drwxr-xr-x  7 root root   4096 11月  5 11:41 discovery</span><br><span class="line">-rw-r--r--  1 root root   3356 11月  5 11:41 docker-env.mk</span><br><span class="line">drwxr-xr-x  4 root root   4096 11月  5 11:41 devenv</span><br><span class="line">drwxr-xr-x 22 root root   4096 11月  5 11:41 core</span><br><span class="line">drwxr-xr-x 24 root root   4096 11月  5 11:41 common</span><br><span class="line">drwxr-xr-x  4 root root     46 11月  5 11:41 cmd</span><br><span class="line">-rw-r--r--  1 root root     14 11月  5 11:41 ci.properties</span><br><span class="line">drwxr-xr-x  8 root root   4096 11月  5 11:41 bccsp</span><br><span class="line">-rw-r--r--  1 root root   3205 11月  5 11:41 Gopkg.toml</span><br><span class="line">-rw-r--r--  1 root root  11358 11月  5 11:41 LICENSE</span><br><span class="line">-rwxr-xr-x  1 root root  18176 11月  5 11:41 Makefile</span><br><span class="line">-rw-r--r--  1 root root   6482 11月  5 11:41 README.md</span><br><span class="line">-rw-r--r--  1 root root 670001 11月  5 11:41 CHANGELOG.md</span><br><span class="line">-rw-r--r--  1 root root    597 11月  5 11:41 CODE_OF_CONDUCT.md</span><br><span class="line">-rw-r--r--  1 root root    664 11月  5 11:41 CONTRIBUTING.md</span><br><span class="line">-rw-r--r--  1 root root  26423 11月  5 11:41 Gopkg.lock</span><br></pre></td></tr></table></figure>
<h2><span id="生成-hyperledger-fabric-证书">生成 Hyperledger Fabric 证书</span></h2>
<blockquote>
<p>证书生成只需要生成一次，这里只在第一个节点配置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 下载官方证书生成软件(均为二进制文件)</span><br><span class="line"># 官方离线下载地址为 https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 选择相应版本 CentOS 选择 linux-amd64-1.3.0  Mac 选择 darwin-amd64-1.3.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 下载地址为: https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.3.0/hyperledger-fabric-linux-amd64-1.3.0.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir /opt/jicki/</span><br><span class="line"></span><br><span class="line">cd /opt/jicki</span><br><span class="line"></span><br><span class="line">wget https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.3.0/hyperledger-fabric-linux-amd64-1.3.0.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf hyperledger-fabric-linux-amd64-1.3.0.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 解压后是 一个 bin 与 一个 config 目录</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# tree bin/</span><br><span class="line">bin/</span><br><span class="line">├── configtxgen</span><br><span class="line">├── configtxlator</span><br><span class="line">├── cryptogen</span><br><span class="line">├── discover</span><br><span class="line">├── get-docker-images.sh</span><br><span class="line">├── idemixgen</span><br><span class="line">├── orderer</span><br><span class="line">└── peer</span><br><span class="line"></span><br><span class="line">0 directories, 8 files</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 为方便使用 我们配置一个 环境变量</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># fabric env</span><br><span class="line">export PATH=$PATH:/opt/jicki/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使文件生效</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 拷贝 configtx.yaml  与 crypto-config.yaml 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /opt/jicki/</span><br><span class="line"></span><br><span class="line">cp /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config.yaml .</span><br><span class="line"></span><br><span class="line">cp /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/configtx.yaml .</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 这里修改相应 jicki.me 为 jicki.me</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/example\.com/jicki\.me/g&apos; *.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 编辑 crypto-config.yaml 增加 orderer 为三个如下:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OrdererOrgs:</span><br><span class="line">  - Name: Orderer</span><br><span class="line">    Domain: jicki.me</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Specs:</span><br><span class="line">      - Hostname: orderer0</span><br><span class="line">      - Hostname: orderer1</span><br><span class="line">      - Hostname: orderer2</span><br><span class="line">      </span><br><span class="line">PeerOrgs:</span><br><span class="line">  - Name: Org1</span><br><span class="line">    Domain: org1.jicki.me</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br><span class="line">  - Name: Org2</span><br><span class="line">    Domain: org2.jicki.me</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"># 然后这里使用 cryptogen 软件来生成相应的证书了</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">org1.jicki.me</span><br><span class="line">org2.jicki.me</span><br><span class="line"></span><br><span class="line"># 生成一个 crypto-config 证书目录</span><br><span class="line"></span><br><span class="line">[root@payment jicki]# tree crypto-config</span><br><span class="line">crypto-config</span><br><span class="line">├── ordererOrganizations</span><br><span class="line">│   └── jicki.me</span><br><span class="line">│       ├── ca</span><br><span class="line">│       │   ├── 1b50e9236c72ccbdf474ecd39ceb300f90b983b8044981895ee8ba4fda466c38_sk</span><br><span class="line">│       │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       ├── msp</span><br><span class="line">│       │   ├── admincerts</span><br><span class="line">│       │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   ├── cacerts</span><br><span class="line">│       │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   └── tlscacerts</span><br><span class="line">│       │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       ├── orderers</span><br><span class="line">│       │   ├── orderer0.jicki.me</span><br><span class="line">│       │   │   ├── msp</span><br><span class="line">│       │   │   │   ├── admincerts</span><br><span class="line">│       │   │   │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── cacerts</span><br><span class="line">│       │   │   │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── keystore</span><br><span class="line">│       │   │   │   │   └── 4dd2ea13c77739776e2e70a82516fce9836c25c92ab6d762333b468b8824fdfd_sk</span><br><span class="line">│       │   │   │   ├── signcerts</span><br><span class="line">│       │   │   │   │   └── orderer0.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   └── tlscacerts</span><br><span class="line">│       │   │   │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │   │   └── tls</span><br><span class="line">│       │   │       ├── ca.crt</span><br><span class="line">│       │   │       ├── server.crt</span><br><span class="line">│       │   │       └── server.key</span><br><span class="line">│       │   ├── orderer1.jicki.me</span><br><span class="line">│       │   │   ├── msp</span><br><span class="line">│       │   │   │   ├── admincerts</span><br><span class="line">│       │   │   │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── cacerts</span><br><span class="line">│       │   │   │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── keystore</span><br><span class="line">│       │   │   │   │   └── 2a55c127a61858ddf36cdffe66782f6a3976955ed6ccafa7dd602b9f393cee77_sk</span><br><span class="line">│       │   │   │   ├── signcerts</span><br><span class="line">│       │   │   │   │   └── orderer1.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   └── tlscacerts</span><br><span class="line">│       │   │   │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │   │   └── tls</span><br><span class="line">│       │   │       ├── ca.crt</span><br><span class="line">│       │   │       ├── server.crt</span><br><span class="line">│       │   │       └── server.key</span><br><span class="line">│       │   └── orderer2.jicki.me</span><br><span class="line">│       │       ├── msp</span><br><span class="line">│       │       │   ├── admincerts</span><br><span class="line">│       │       │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │       │   ├── cacerts</span><br><span class="line">│       │       │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │       │   ├── keystore</span><br><span class="line">│       │       │   │   └── d85da317a39fc3c95c5ddce183bf492e1310decee79dd215ef4cfd4f7130d0c4_sk</span><br><span class="line">│       │       │   ├── signcerts</span><br><span class="line">│       │       │   │   └── orderer2.jicki.me-cert.pem</span><br><span class="line">│       │       │   └── tlscacerts</span><br><span class="line">│       │       │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │       └── tls</span><br><span class="line">│       │           ├── ca.crt</span><br><span class="line">│       │           ├── server.crt</span><br><span class="line">│       │           └── server.key</span><br><span class="line">│       ├── tlsca</span><br><span class="line">│       │   ├── e03e3c85138178da8a03c3cc00aecb0627aa299bdd0b92c4bc82591cd47a2672_sk</span><br><span class="line">│       │   └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       └── users</span><br><span class="line">│           └── Admin@jicki.me</span><br><span class="line">│               ├── msp</span><br><span class="line">│               │   ├── admincerts</span><br><span class="line">│               │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│               │   ├── cacerts</span><br><span class="line">│               │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│               │   ├── keystore</span><br><span class="line">│               │   │   └── fac87a53e4255e8007bf947bda23464b40f46107ebcae48400e33ae5b778ac32_sk</span><br><span class="line">│               │   ├── signcerts</span><br><span class="line">│               │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│               │   └── tlscacerts</span><br><span class="line">│               │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│               └── tls</span><br><span class="line">│                   ├── ca.crt</span><br><span class="line">│                   ├── client.crt</span><br><span class="line">│                   └── client.key</span><br><span class="line">└── peerOrganizations</span><br><span class="line">    ├── org1.jicki.me</span><br><span class="line">    │   ├── ca</span><br><span class="line">    │   │   ├── aa167e5dcb62e9e1068487484c08f0bc0a13e13cebf53a0fa2f64038a1a76662_sk</span><br><span class="line">    │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   ├── msp</span><br><span class="line">    │   │   ├── admincerts</span><br><span class="line">    │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │   ├── cacerts</span><br><span class="line">    │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   ├── config.yaml</span><br><span class="line">    │   │   └── tlscacerts</span><br><span class="line">    │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   ├── peers</span><br><span class="line">    │   │   ├── peer0.org1.jicki.me</span><br><span class="line">    │   │   │   ├── msp</span><br><span class="line">    │   │   │   │   ├── admincerts</span><br><span class="line">    │   │   │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   ├── cacerts</span><br><span class="line">    │   │   │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   ├── config.yaml</span><br><span class="line">    │   │   │   │   ├── keystore</span><br><span class="line">    │   │   │   │   │   └── 7d20eedce4f8f3417bb1d4b723a0018b701fb2485afd727a2e1f34c09148e4eb_sk</span><br><span class="line">    │   │   │   │   ├── signcerts</span><br><span class="line">    │   │   │   │   │   └── peer0.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   └── tlscacerts</span><br><span class="line">    │   │   │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   └── tls</span><br><span class="line">    │   │   │       ├── ca.crt</span><br><span class="line">    │   │   │       ├── server.crt</span><br><span class="line">    │   │   │       └── server.key</span><br><span class="line">    │   │   └── peer1.org1.jicki.me</span><br><span class="line">    │   │       ├── msp</span><br><span class="line">    │   │       │   ├── admincerts</span><br><span class="line">    │   │       │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   ├── cacerts</span><br><span class="line">    │   │       │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   ├── config.yaml</span><br><span class="line">    │   │       │   ├── keystore</span><br><span class="line">    │   │       │   │   └── f4b8c4a0ebe3b34fe08cc2d33ea0c8f1e8a9817ffacc42d0c97323f0ddd57958_sk</span><br><span class="line">    │   │       │   ├── signcerts</span><br><span class="line">    │   │       │   │   └── peer1.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   └── tlscacerts</span><br><span class="line">    │   │       │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       └── tls</span><br><span class="line">    │   │           ├── ca.crt</span><br><span class="line">    │   │           ├── server.crt</span><br><span class="line">    │   │           └── server.key</span><br><span class="line">    │   ├── tlsca</span><br><span class="line">    │   │   ├── 9c549e33c1d594a0f5eaedac0e1e6c753b9c3b2368d27d907d5a4ad59faa06d0_sk</span><br><span class="line">    │   │   └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   └── users</span><br><span class="line">    │       ├── Admin@org1.jicki.me</span><br><span class="line">    │       │   ├── msp</span><br><span class="line">    │       │   │   ├── admincerts</span><br><span class="line">    │       │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   ├── cacerts</span><br><span class="line">    │       │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   ├── keystore</span><br><span class="line">    │       │   │   │   └── a9666f561d211e7b7cc170bfe854721431a1038b7914a67555d82dcf6b9eaaf8_sk</span><br><span class="line">    │       │   │   ├── signcerts</span><br><span class="line">    │       │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   └── tlscacerts</span><br><span class="line">    │       │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │       │   └── tls</span><br><span class="line">    │       │       ├── ca.crt</span><br><span class="line">    │       │       ├── client.crt</span><br><span class="line">    │       │       └── client.key</span><br><span class="line">    │       └── User1@org1.jicki.me</span><br><span class="line">    │           ├── msp</span><br><span class="line">    │           │   ├── admincerts</span><br><span class="line">    │           │   │   └── User1@org1.jicki.me-cert.pem</span><br><span class="line">    │           │   ├── cacerts</span><br><span class="line">    │           │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │           │   ├── keystore</span><br><span class="line">    │           │   │   └── 543ee272a207c159538c412a2d97f83863031027014a17d2e4a6e3de931cfa3d_sk</span><br><span class="line">    │           │   ├── signcerts</span><br><span class="line">    │           │   │   └── User1@org1.jicki.me-cert.pem</span><br><span class="line">    │           │   └── tlscacerts</span><br><span class="line">    │           │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │           └── tls</span><br><span class="line">    │               ├── ca.crt</span><br><span class="line">    │               ├── client.crt</span><br><span class="line">    │               └── client.key</span><br><span class="line">    └── org2.jicki.me</span><br><span class="line">        ├── ca</span><br><span class="line">        │   ├── bcbc85a3992715502c7e7e7d21b792678a9d03668a52bb18a0c10862d45222c3_sk</span><br><span class="line">        │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        ├── msp</span><br><span class="line">        │   ├── admincerts</span><br><span class="line">        │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │   ├── cacerts</span><br><span class="line">        │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │   ├── config.yaml</span><br><span class="line">        │   └── tlscacerts</span><br><span class="line">        │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        ├── peers</span><br><span class="line">        │   ├── peer0.org2.jicki.me</span><br><span class="line">        │   │   ├── msp</span><br><span class="line">        │   │   │   ├── admincerts</span><br><span class="line">        │   │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   ├── cacerts</span><br><span class="line">        │   │   │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   ├── config.yaml</span><br><span class="line">        │   │   │   ├── keystore</span><br><span class="line">        │   │   │   │   └── ad97de341e17baae8d25d34d1d23808cb77b5eceaf1ab53586cbf751ff9157cb_sk</span><br><span class="line">        │   │   │   ├── signcerts</span><br><span class="line">        │   │   │   │   └── peer0.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   └── tlscacerts</span><br><span class="line">        │   │   │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   └── tls</span><br><span class="line">        │   │       ├── ca.crt</span><br><span class="line">        │   │       ├── server.crt</span><br><span class="line">        │   │       └── server.key</span><br><span class="line">        │   └── peer1.org2.jicki.me</span><br><span class="line">        │       ├── msp</span><br><span class="line">        │       │   ├── admincerts</span><br><span class="line">        │       │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │       │   ├── cacerts</span><br><span class="line">        │       │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │       │   ├── config.yaml</span><br><span class="line">        │       │   ├── keystore</span><br><span class="line">        │       │   │   └── a38c440f80e16a95a808744f4b6409c4f2fc5d718c06047bd4b13e5d71b8c868_sk</span><br><span class="line">        │       │   ├── signcerts</span><br><span class="line">        │       │   │   └── peer1.org2.jicki.me-cert.pem</span><br><span class="line">        │       │   └── tlscacerts</span><br><span class="line">        │       │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        │       └── tls</span><br><span class="line">        │           ├── ca.crt</span><br><span class="line">        │           ├── server.crt</span><br><span class="line">        │           └── server.key</span><br><span class="line">        ├── tlsca</span><br><span class="line">        │   ├── 6a4bf592dd12463266fad5f8ef683ad90062ea1913f734a9149046b6269ca73b_sk</span><br><span class="line">        │   └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        └── users</span><br><span class="line">            ├── Admin@org2.jicki.me</span><br><span class="line">            │   ├── msp</span><br><span class="line">            │   │   ├── admincerts</span><br><span class="line">            │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">            │   │   ├── cacerts</span><br><span class="line">            │   │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">            │   │   ├── keystore</span><br><span class="line">            │   │   │   └── d402b684b807080653511978a51fcd2326668156cd8a10fb612b80bc49c9b354_sk</span><br><span class="line">            │   │   ├── signcerts</span><br><span class="line">            │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">            │   │   └── tlscacerts</span><br><span class="line">            │   │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">            │   └── tls</span><br><span class="line">            │       ├── ca.crt</span><br><span class="line">            │       ├── client.crt</span><br><span class="line">            │       └── client.key</span><br><span class="line">            └── User1@org2.jicki.me</span><br><span class="line">                ├── msp</span><br><span class="line">                │   ├── admincerts</span><br><span class="line">                │   │   └── User1@org2.jicki.me-cert.pem</span><br><span class="line">                │   ├── cacerts</span><br><span class="line">                │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">                │   ├── keystore</span><br><span class="line">                │   │   └── b7d167da7a974720943d33bd5641d0b306273565a7e715538d3edf1e58f5d3e6_sk</span><br><span class="line">                │   ├── signcerts</span><br><span class="line">                │   │   └── User1@org2.jicki.me-cert.pem</span><br><span class="line">                │   └── tlscacerts</span><br><span class="line">                │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">                └── tls</span><br><span class="line">                    ├── ca.crt</span><br><span class="line">                    ├── client.crt</span><br><span class="line">                    └── client.key</span><br><span class="line"></span><br><span class="line">125 directories, 123 files</span><br></pre></td></tr></table></figure>
<h2><span id="生成-hyperledger-fabric-创世区块">生成 Hyperledger Fabric 创世区块</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"># 这里使用 configtxgen 来创建 创世区块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 首先需要创建一个文件夹</span><br><span class="line">mkdir -p /opt/jicki/channel-artifacts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改 configtx.yaml 文件增加 orderer 多节点 以及 peer 多节点, 删除了 &amp;Org3 节点</span><br><span class="line"></span><br><span class="line"># 完整 configtx.yaml 如下: </span><br><span class="line"># configtx.yaml 文件格式 请千万注意 空格 与 tab 键 里的缩进，否则会报错。</span><br><span class="line"></span><br><span class="line">Organizations:</span><br><span class="line"></span><br><span class="line">    - &amp;OrdererOrg</span><br><span class="line">        Name: OrdererOrg</span><br><span class="line">        ID: OrdererMSP</span><br><span class="line">        MSPDir: crypto-config/ordererOrganizations/jicki.me/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.member&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.member&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">    - &amp;Org1</span><br><span class="line">        Name: Org1MSP</span><br><span class="line">        ID: Org1MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org1.jicki.me/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;, &apos;Org1MSP.peer&apos;, &apos;Org1MSP.client&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;, &apos;Org1MSP.client&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org1.jicki.me</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">    - &amp;Org2</span><br><span class="line">        Name: Org2MSP</span><br><span class="line">        ID: Org2MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org2.jicki.me/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;, &apos;Org2MSP.peer&apos;, &apos;Org2MSP.client&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;, &apos;Org2MSP.client&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org2.jicki.me</span><br><span class="line">              Port: 7051</span><br><span class="line"></span><br><span class="line">Capabilities:</span><br><span class="line">    Channel: &amp;ChannelCapabilities</span><br><span class="line">        V1_3: true</span><br><span class="line"></span><br><span class="line">    Orderer: &amp;OrdererCapabilities</span><br><span class="line">        V1_1: true</span><br><span class="line"></span><br><span class="line">    Application: &amp;ApplicationCapabilities</span><br><span class="line">        V1_3: true</span><br><span class="line">        V1_2: false</span><br><span class="line">        V1_1: false</span><br><span class="line"></span><br><span class="line">Application: &amp;ApplicationDefaults</span><br><span class="line"></span><br><span class="line">    Organizations:</span><br><span class="line"></span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line"></span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ApplicationCapabilities</span><br><span class="line"></span><br><span class="line">Orderer: &amp;OrdererDefaults</span><br><span class="line"></span><br><span class="line">    OrdererType: kafka</span><br><span class="line"></span><br><span class="line">    Addresses:</span><br><span class="line">        - orderer0.jicki.me:7050</span><br><span class="line">        - orderer1.jicki.me:7050</span><br><span class="line">        - orderer2.jicki.me:7050</span><br><span class="line"></span><br><span class="line">    BatchTimeout: 2s</span><br><span class="line"></span><br><span class="line">    BatchSize:</span><br><span class="line">        MaxMessageCount: 10</span><br><span class="line">        AbsoluteMaxBytes: 99 MB</span><br><span class="line">        PreferredMaxBytes: 512 KB</span><br><span class="line"></span><br><span class="line">    Kafka:</span><br><span class="line">        Brokers:</span><br><span class="line">            - kafka0:9092</span><br><span class="line">            - kafka1:9092</span><br><span class="line">            - kafka2:9092</span><br><span class="line"></span><br><span class="line">    Organizations:</span><br><span class="line"></span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line">        BlockValidation:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line"></span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *OrdererCapabilities</span><br><span class="line"></span><br><span class="line">Channel: &amp;ChannelDefaults</span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line"></span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ChannelCapabilities</span><br><span class="line"></span><br><span class="line">Profiles:</span><br><span class="line">    TwoOrgsOrdererGenesis:</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Orderer:</span><br><span class="line">            &lt;&lt;: *OrdererDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *OrdererOrg</span><br><span class="line">        Consortiums:</span><br><span class="line">            SampleConsortium:</span><br><span class="line">                Organizations:</span><br><span class="line">                    - *Org1</span><br><span class="line">                    - *Org2</span><br><span class="line">    TwoOrgsChannel:</span><br><span class="line">        Consortium: SampleConsortium</span><br><span class="line">        Application:</span><br><span class="line">            &lt;&lt;: *ApplicationDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *Org1</span><br><span class="line">                - *Org2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 创建 创世区块  TwoOrgsOrdererGenesis 名称为 configtx.yaml 中 Profiles 字段下的</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-11-05 12:06:21.780 CST [common/tools/configtxgen] main -&gt; WARN 001 Omitting the channel ID for configtxgen for output operations is deprecated.  Explicitly passing the channel ID will be required in the future, defaulting to &apos;testchainid&apos;.</span><br><span class="line">2018-11-05 12:06:21.780 CST [common/tools/configtxgen] main -&gt; INFO 002 Loading configuration</span><br><span class="line">2018-11-05 12:06:21.829 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 003 Generating genesis block</span><br><span class="line">2018-11-05 12:06:21.829 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 004 Writing genesis block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创世区块 是在 orderer 服务中使用</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt channel-artifacts/</span><br><span class="line">总用量 16</span><br><span class="line">-rw-r--r-- 1 root root 12479 11月  5 12:06 genesis.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 下面来生成一个 peer 服务 中使用的 tx 文件 TwoOrgsChannel 名称为 configtx.yaml 中 Profiles 字段下的，这里必须指定上面的 channelID</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-11-05 12:08:11.241 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-11-05 12:08:11.286 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx</span><br><span class="line">2018-11-05 12:08:11.288 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 003 Writing new channel tx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt channel-artifacts/</span><br><span class="line">总用量 20</span><br><span class="line">-rw-r--r-- 1 root root   346 11月  5 12:08 channel.tx</span><br><span class="line">-rw-r--r-- 1 root root 12479 11月  5 12:06 genesis.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 定义组织 生成锚节点更新文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Org1MSP</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-11-05 12:08:47.653 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-11-05 12:08:47.701 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update</span><br><span class="line">2018-11-05 12:08:47.702 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Org2MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-11-05 12:09:00.134 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-11-05 12:09:00.179 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update</span><br><span class="line">2018-11-05 12:09:00.179 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update</span><br></pre></td></tr></table></figure>
<h2><span id="配置-zookeeper-kafka-集群">配置 Zookeeper Kafka 集群</span></h2>
<blockquote>
<p>启动 zookeeper 与 kafka 集群</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose-zk-kafka.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  zookeeper1:</span><br><span class="line">    container_name: zookeeper1</span><br><span class="line">    hostname: zookeeper1</span><br><span class="line">    image: hyperledger/fabric-zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=1</span><br><span class="line">      - ZOO_SERVERS=server.1=zookeeper1:2888:3888 server.2=zookeeper2:2888:3888 server.3=zookeeper3:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper1/data:/data</span><br><span class="line">    #- ./data/zookeeper1/datalog:/datalog</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line"></span><br><span class="line">  zookeeper2:</span><br><span class="line">    container_name: zookeeper2</span><br><span class="line">    hostname: zookeeper2</span><br><span class="line">    image: hyperledger/fabric-zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=2</span><br><span class="line">      - ZOO_SERVERS=server.1=zookeeper1:2888:3888 server.2=zookeeper2:2888:3888 server.3=zookeeper3:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper2/data:/data</span><br><span class="line">    #- ./data/zookeeper2/datalog:/datalog</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line"></span><br><span class="line">  zookeeper3:</span><br><span class="line">    container_name: zookeeper3</span><br><span class="line">    hostname: zookeeper3</span><br><span class="line">    image: hyperledger/fabric-zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=3</span><br><span class="line">      - ZOO_SERVERS=server.1=zookeeper1:2888:3888 server.2=zookeeper2:2888:3888 server.3=zookeeper3:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper3/data:/data</span><br><span class="line">    #- ./data/zookeeper3/datalog:/datalog</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  kafka0:</span><br><span class="line">    container_name: kafka0</span><br><span class="line">    hostname: kafka0</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=1</span><br><span class="line">      # 设置一个M值,数据提交时会写入至少M个副本(这里M=2)（这些数据会被同步并且归属到in-sync 副本集合或ISR）M 必须小于 如下 N 值,并且大于1,既最小为2。</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      # 设置一个N值, N代表着每个channel都保存N个副本的数据到Kafka的代理上。N 必须大于如上 M 值, 既 N 值最小值为 3。</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper1:2181,zookeeper2:2181,zookeeper3:2181</span><br><span class="line">      # 如下99为configtx.yaml中会设置最大的区块大小(参考configtx.yaml中AbsoluteMaxBytes参数)</span><br><span class="line">      # 每个区块最大有Orderer.AbsoluteMaxBytes个字节</span><br><span class="line">      # 99 * 1024 * 1024 B</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      # 每个通道获取的消息的字节数 如上一样</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      # 数据一致性在区块链环境中是至关重要的, 我们不能从in-sync 副本（ISR）集合之外选取channel leader , 否则我们将会面临对于之前的leader产生的offsets覆盖的风险</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      # 关闭基于时间的日志保留方式并且避免分段到期。</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka1/data:/data</span><br><span class="line">    #- ./data/kafka1/data:/logs</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper1</span><br><span class="line">      - zookeeper2</span><br><span class="line">      - zookeeper3</span><br><span class="line"></span><br><span class="line">  kafka1:</span><br><span class="line">    container_name: kafka1</span><br><span class="line">    hostname: kafka1</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=2</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper1:2181,zookeeper2:2181,zookeeper3:2181</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka1/data:/data</span><br><span class="line">    #- ./data/kafka1/data:/logs</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper1</span><br><span class="line">      - zookeeper2</span><br><span class="line">      - zookeeper3</span><br><span class="line">          </span><br><span class="line">  kafka2:</span><br><span class="line">    container_name: kafka2</span><br><span class="line">    hostname: kafka2</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=3</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper1:2181,zookeeper2:2181,zookeeper3:2181</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      # 关闭基于时间的日志保留方式并且避免分段到期。</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka2/data:/data</span><br><span class="line">    #- ./data/kafka2/data:/logs</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper1</span><br><span class="line">      - zookeeper2</span><br><span class="line">      - zookeeper3</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 分别启动服务</span><br><span class="line"></span><br><span class="line">docker-compose -f docker-compose-zk-kafka.yaml up -d</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-orderer">配置 Hyperledger Fabric Orderer</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"># 创建文件 docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"># 创建于 /opt/jicki 目录下</span><br><span class="line"></span><br><span class="line">vi  docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  orderer0.jicki.me:</span><br><span class="line">    container_name: orderer0.jicki.me</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      # - ORDERER_GENERAL_LOGLEVEL=error</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050</span><br><span class="line">      #- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=ram</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=file</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt, /etc/hyperledger/crypto/peerOrg1/tls/ca.crt, /etc/hyperledger/crypto/peerOrg2/tls/ca.crt]</span><br><span class="line"></span><br><span class="line">      # KAFKA</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGTOTAL=100s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">    - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp:/var/hyperledger/orderer/msp</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/:/etc/hyperledger/crypto/peerOrg1</span><br><span class="line">    - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/:/etc/hyperledger/crypto/peerOrg2</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    depends_on:</span><br><span class="line">      - kafka0</span><br><span class="line">      - kafka1</span><br><span class="line">      - kafka2</span><br><span class="line"></span><br><span class="line">  orderer1.jicki.me:</span><br><span class="line">    container_name: orderer1.jicki.me</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      # - ORDERER_GENERAL_LOGLEVEL=error</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050</span><br><span class="line">      #- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=ram</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=file</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt, /etc/hyperledger/crypto/peerOrg1/tls/ca.crt, /etc/hyperledger/crypto/peerOrg2/tls/ca.crt]</span><br><span class="line"></span><br><span class="line">      # KAFKA</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGTOTAL=100s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">    - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp:/var/hyperledger/orderer/msp</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/:/etc/hyperledger/crypto/peerOrg1</span><br><span class="line">    - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/:/etc/hyperledger/crypto/peerOrg2</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    ports:</span><br><span class="line">      - 8050:7050</span><br><span class="line">    depends_on:</span><br><span class="line">      - kafka0</span><br><span class="line">      - kafka1</span><br><span class="line">      - kafka2</span><br><span class="line">      </span><br><span class="line">  orderer2.jicki.me:</span><br><span class="line">    container_name: orderer2.jicki.me</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      # - ORDERER_GENERAL_LOGLEVEL=error</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050</span><br><span class="line">      #- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=ram</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=file</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=true</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt, /etc/hyperledger/crypto/peerOrg1/tls/ca.crt, /etc/hyperledger/crypto/peerOrg2/tls/ca.crt]</span><br><span class="line"></span><br><span class="line">      # KAFKA</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGTOTAL=100s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">    - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp:/var/hyperledger/orderer/msp</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/:/etc/hyperledger/crypto/peerOrg1</span><br><span class="line">    - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/:/etc/hyperledger/crypto/peerOrg2</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    ports:</span><br><span class="line">      - 9050:7050</span><br><span class="line">    depends_on:</span><br><span class="line">      - kafka0</span><br><span class="line">      - kafka1</span><br><span class="line">      - kafka2</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<blockquote>
<p>所有节点启动服务</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-orderer.yaml up -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动完毕，查看docker logs 如下表示成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 2fd [channel: testchainid] Successfully unmarshalled consumed message, offset is 0. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 2fe [channel: testchainid] It&apos;s a connect message - ignoring</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 2ff [channel: testchainid] Successfully unmarshalled consumed message, offset is 1. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 300 [channel: testchainid] It&apos;s a connect message - ignoring</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 301 [channel: testchainid] Successfully unmarshalled consumed message, offset is 2. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 302 [channel: testchainid] It&apos;s a connect message - ignoring</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-ca-节点">配置 Hyperledger Fabric ca 节点</span></h2>
<blockquote>
<p>配置两个 ca 节点</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose-ca.yaml</span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  ca.org1.jicki.me:</span><br><span class="line">    container_name: ca.org1.jicki.me</span><br><span class="line">    image: hyperledger/fabric-ca</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca-org1</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_ENABLED=true</span><br><span class="line">      - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.jicki.me-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/aa167e5dcb62e9e1068487484c08f0bc0a13e13cebf53a0fa2f64038a1a76662_sk</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org1.jicki.me-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/aa167e5dcb62e9e1068487484c08f0bc0a13e13cebf53a0fa2f64038a1a76662_sk</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;7054:7054&quot;</span><br><span class="line">    command: sh -c &apos;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.jicki.me-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/aa167e5dcb62e9e1068487484c08f0bc0a13e13cebf53a0fa2f64038a1a76662_sk -b admin:adminpw -d&apos;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./crypto-config/peerOrganizations/org1.jicki.me/ca/:/etc/hyperledger/fabric-ca-server-config</span><br><span class="line">    depends_on:</span><br><span class="line">      - orderer0.jicki.me</span><br><span class="line">      - orderer1.jicki.me</span><br><span class="line">      - orderer2.jicki.me</span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">  ca.org2.jicki.me:</span><br><span class="line">    container_name: ca.org2.jicki.me</span><br><span class="line">    image: hyperledger/fabric-ca</span><br><span class="line">    environment:</span><br><span class="line">      - FABRIC_CA_HOME=/etc/hyperledger/fabric-ca-server</span><br><span class="line">      - FABRIC_CA_SERVER_CA_NAME=ca-org2</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_ENABLED=true</span><br><span class="line">      - FABRIC_CA_SERVER_CA_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.jicki.me-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_CA_KEYFILE=/etc/hyperledger/fabric-ca-server-config/bcbc85a3992715502c7e7e7d21b792678a9d03668a52bb18a0c10862d45222c3_sk</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_CERTFILE=/etc/hyperledger/fabric-ca-server-config/ca.org2.jicki.me-cert.pem</span><br><span class="line">      - FABRIC_CA_SERVER_TLS_KEYFILE=/etc/hyperledger/fabric-ca-server-config/bcbc85a3992715502c7e7e7d21b792678a9d03668a52bb18a0c10862d45222c3_sk</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8054:7054&quot;</span><br><span class="line">    command: sh -c &apos;fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org2.jicki.me-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/bcbc85a3992715502c7e7e7d21b792678a9d03668a52bb18a0c10862d45222c3_sk -b admin:adminpw -d&apos;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./crypto-config/peerOrganizations/org2.jicki.me/ca/:/etc/hyperledger/fabric-ca-server-config</span><br><span class="line">    depends_on:</span><br><span class="line">      - orderer0.jicki.me</span><br><span class="line">      - orderer1.jicki.me</span><br><span class="line">      - orderer2.jicki.me</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-peer">配置 Hyperledger Fabric peer</span></h2>
<blockquote>
<p>peer 节点下都必须启动一个数据存储，如 file 或者 couchdb 等</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line">vi  docker-compose-peer.yaml</span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  couchdb0:</span><br><span class="line">    container_name: couchdb0</span><br><span class="line">    image: hyperledger/fabric-couchdb</span><br><span class="line">    environment:</span><br><span class="line">      - COUCHDB_USER=</span><br><span class="line">      - COUCHDB_PASSWORD=</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5984:5984&quot;</span><br><span class="line">    #volumes:</span><br><span class="line">      # 数据持久化，用于存储链码值</span><br><span class="line">      #- ./data/couchdb0/data:/opt/couchdb/data</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line"></span><br><span class="line">  couchdb1:</span><br><span class="line">    container_name: couchdb1</span><br><span class="line">    image: hyperledger/fabric-couchdb</span><br><span class="line">    environment:</span><br><span class="line">      - COUCHDB_USER=</span><br><span class="line">      - COUCHDB_PASSWORD=</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;6984:5984&quot;</span><br><span class="line">    #volumes:</span><br><span class="line">      # 数据持久化，用于存储链码值</span><br><span class="line">      #- ./data/couchdb1/data:/opt/couchdb/data</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">          </span><br><span class="line">  peer0.org1.jicki.me:</span><br><span class="line">    container_name: peer0.org1.jicki.me</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="line">      - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb0:5984</span><br><span class="line">      </span><br><span class="line">      - CORE_PEER_ID=peer0.org1.jicki.me</span><br><span class="line">      - CORE_PEER_NETWORKID=jicki</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.jicki.me:7052</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line"></span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true</span><br><span class="line">      - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">      - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">      - CORE_PEER_PROFILE_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">        - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">        # 数据持久化, 存储安装，以及实例化智能合约的数据</span><br><span class="line">        #- ./data/peer0org1:/var/hyperledger/production</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    depends_on:</span><br><span class="line">      - couchdb0</span><br><span class="line">      - ca.org1.jicki.me</span><br><span class="line">      - ca.org2.jicki.me</span><br><span class="line">      - orderer0.jicki.me</span><br><span class="line">      - orderer1.jicki.me</span><br><span class="line">      - orderer2.jicki.me</span><br><span class="line"></span><br><span class="line">  peer0.org2.jicki.me:</span><br><span class="line">    container_name: peer0.org2.jicki.me</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="line">      - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb1:5984</span><br><span class="line">      </span><br><span class="line">      - CORE_PEER_ID=peer0.org2.jicki.me</span><br><span class="line">      - CORE_PEER_NETWORKID=jicki</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.jicki.me:7052</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line"></span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true</span><br><span class="line">      - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">      - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">      - CORE_PEER_PROFILE_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">        - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">        # 数据持久化, 存储安装，以及实例化智能合约的数据</span><br><span class="line">        #- ./data/peer0org2:/var/hyperledger/production</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    ports:</span><br><span class="line">      - 8051:7051</span><br><span class="line">      - 8052:7052</span><br><span class="line">      - 8053:7053</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br><span class="line">    depends_on:</span><br><span class="line">      - couchdb1</span><br><span class="line">      - ca.org1.jicki.me</span><br><span class="line">      - ca.org2.jicki.me</span><br><span class="line">      - orderer0.jicki.me</span><br><span class="line">      - orderer1.jicki.me</span><br><span class="line">      - orderer2.jicki.me</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-peer.yaml up -d</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-cli-客户端">配置 Hyperledger Fabric cli 客户端</span></h2>
<blockquote>
<p>客户端服务，只需要配置一个既可，用于调用创建 channel 与 智能合约</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">vi  docker-compose-cli.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=true</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - /opt/golang/go:/opt/go</span><br><span class="line">        - /opt/gopath:/opt/gopath</span><br><span class="line">        - ./peer:/opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">        - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    networks:</span><br><span class="line">      default:</span><br><span class="line">        aliases:</span><br><span class="line">          - jicki</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-cli.yaml up -d</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-创建-channel">Hyperledger Fabric 创建 Channel</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 上面我们创建了 cli 容器，我们可以直接进入 容器里操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# docker exec -it cli bash</span><br><span class="line">root@0b55c64a9853:/opt/gopath/src/github.com/hyperledger/fabric/peer#</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 执行 创建命令 (未启动 认证)</span><br><span class="line"></span><br><span class="line">peer channel create -c mychannel -f ./channel-artifacts/channel.tx --orderer orderer0.jicki.me:7050</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 提示如下表示认证不通过</span><br><span class="line">Error: failed to create deliver client: rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: &lt;nil&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 以下为启用认证</span><br><span class="line">peer channel create -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:29:11.416 UTC [grpc] DialContext -&gt; DEBU 060 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:29:11.416 UTC [grpc] DialContext -&gt; DEBU 061 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:29:11.416 UTC [grpc] watcher -&gt; DEBU 062 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:29:11.416 UTC [grpc] switchBalancer -&gt; DEBU 063 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:29:11.417 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 064 pickfirstBalancer: HandleSubConnStateChange: 0xc420389240, CONNECTING</span><br><span class="line">2018-11-05 04:29:11.417 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 065 pickfirstBalancer: HandleSubConnStateChange: 0xc420389240, READY</span><br><span class="line">2018-11-05 04:29:11.417 UTC [channelCmd] InitCmdFactory -&gt; INFO 066 Endorser and orderer connections initialized</span><br><span class="line">2018-11-05 04:29:11.618 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 067 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:29:11.618 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 068 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:29:11.618 UTC [msp/identity] Sign -&gt; DEBU 069 Sign: plaintext: 0AD1060A1508051A0608978EFFDE0522...3561A3D8F91812080A021A0012021A00 </span><br><span class="line">2018-11-05 04:29:11.618 UTC [msp/identity] Sign -&gt; DEBU 06a Sign: digest: 8E158641AEF7FC331BDF972FB71525AA5B119D2ABD26A6B4932A6BE6E0179D4F </span><br><span class="line">2018-11-05 04:29:11.622 UTC [cli/common] readBlock -&gt; INFO 06b Received block: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建以后生成文件 mychannel.block</span><br><span class="line"></span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 15407 Nov  5 04:29 mychannel.block</span><br><span class="line">drwxr-xr-x 2 root root   111 Nov  5 04:09 channel-artifacts</span><br><span class="line">drwxr-xr-x 4 root root    69 Nov  5 03:53 crypto</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-加入-channel">Hyperledger Fabric 加入 Channel</span></h2>
<blockquote>
<p>我们这边有2个 peer 所以需要分别加入, 后续有多少个 peer 都需要加入到 Channel 中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># peer0.org1.jicki.me 加入 此 channel 中，首先需要查看如下 环境变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo $CORE_PEER_LOCALMSPID</span><br><span class="line">echo $CORE_PEER_ADDRESS</span><br><span class="line">echo $CORE_PEER_MSPCONFIGPATH</span><br><span class="line">echo $CORE_PEER_TLS_ROOTCERT_FILE</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 加入 channel (未开启认证)</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 加入 channel (开启认证)</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下: </span><br><span class="line"></span><br><span class="line">2018-11-07 03:12:21.050 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-07 03:12:21.050 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-07 03:12:21.050 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-11-07 03:12:21.051 UTC [grpc] DialContext -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:12:21.051 UTC [grpc] DialContext -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:12:21.051 UTC [grpc] watcher -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:12:21.051 UTC [grpc] switchBalancer -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:12:21.051 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42053dd30, CONNECTING</span><br><span class="line">2018-11-07 03:12:21.056 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc42053dd30, READY</span><br><span class="line">2018-11-07 03:12:21.056 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-11-07 03:12:21.057 UTC [msp/identity] Sign -&gt; DEBU 03f Sign: plaintext: 0A97070A5B08011A0B0895B089DF0510...FD5719255DE61A080A000A000A000A00 </span><br><span class="line">2018-11-07 03:12:21.057 UTC [msp/identity] Sign -&gt; DEBU 040 Sign: digest: 4F2C696D018EC053894B7911B363A9D58394B6DF795CBDBEFDF52A1775AF87F3 </span><br><span class="line">2018-11-07 03:12:21.163 UTC [channelCmd] executeJoin -&gt; INFO 041 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># peer1.org2.jicki.me 加入 此 channel 中，这里配置一下环境变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 加入 channel (未开启认证)</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 加入 channel (开启认证)</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输入如下:</span><br><span class="line"></span><br><span class="line">2018-11-07 03:13:15.350 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-07 03:13:15.350 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-11-07 03:13:15.351 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-11-07 03:13:15.351 UTC [grpc] DialContext -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:13:15.351 UTC [grpc] DialContext -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:13:15.352 UTC [grpc] watcher -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:13:15.352 UTC [grpc] switchBalancer -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:13:15.352 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc420311d00, CONNECTING</span><br><span class="line">2018-11-07 03:13:15.356 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc420311d00, READY</span><br><span class="line">2018-11-07 03:13:15.356 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-11-07 03:13:15.357 UTC [msp/identity] Sign -&gt; DEBU 03f Sign: plaintext: 0A9C070A5C08011A0C08CBB089DF0510...FD5719255DE61A080A000A000A000A00 </span><br><span class="line">2018-11-07 03:13:15.357 UTC [msp/identity] Sign -&gt; DEBU 040 Sign: digest: 9D4D6D52E6C028072A3053D31AD56AC4D334C323F0464E4026A15AFDDB6AB720 </span><br><span class="line">2018-11-07 03:13:15.466 UTC [channelCmd] executeJoin -&gt; INFO 041 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-实例化测试">Hyperledger Fabric 实例化测试</span></h2>
<blockquote>
<p>在上面我们已经拷贝了官方的例子，在 chaincode 下, 下面我们来测试一下</p>
</blockquote>
<h3><span id="安装智能合约">安装智能合约</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># cli 部分  ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line"># 为 智能合约的目录 我们约定为这个目录 需要预先创建 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p /opt/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line">cd /opt/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line"># 创建以后~我们拷贝官方的 例子进来，方便后面进行合约测试</span><br><span class="line"></span><br><span class="line">cp -r /opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go/example0* /opt/jicki/chaincode/go/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 官方这里有5个例子</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt chaincode/go/</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x 3 root root 75 11月  5 12:32 example05</span><br><span class="line">drwxr-xr-x 3 root root 75 11月  5 12:32 example03</span><br><span class="line">drwxr-xr-x 3 root root 75 11月  5 12:32 example04</span><br><span class="line">drwxr-xr-x 3 root root 47 11月  5 12:32 example01</span><br><span class="line">drwxr-xr-x 3 root root 75 11月  5 12:32 example02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如上我们挂载的地址为 github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注: 这里面的 example02 的 package 为 example02 会报错</span><br><span class="line"></span><br><span class="line">Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction 819b581ce88604e9b6651764324876f2ca7a47d7aeb7ee307f273af867a4a134: error starting container: error starting container: API error (404): oci runtime error: container_linux.go:247: starting container process caused &quot;exec: \&quot;chaincode\&quot;: executable file not found in $PATH&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 将 chaincode.go  chaincode_test.go 中  package 修改成 main 然后在最下面增加 main()函数</span><br><span class="line"></span><br><span class="line">package example02 修改为 package main</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在最后添加如下:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">        err := shim.Start(new(SimpleChaincode))</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 安装指定合约到 所有的 peer 节点中，每个节点都必须安装一次</span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装 合约</span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/example02 -v 1.0   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:34:32.461 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:34:32.461 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-05 04:34:32.462 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:34:32.462 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:34:32.463 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:34:32.463 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:34:32.463 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc42054f730, CONNECTING</span><br><span class="line">2018-11-05 04:34:32.464 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42054f730, READY</span><br><span class="line">2018-11-05 04:34:32.466 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:34:32.466 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:34:32.466 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:34:32.466 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:34:32.466 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4205ad630, CONNECTING</span><br><span class="line">2018-11-05 04:34:32.467 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4205ad630, READY</span><br><span class="line">2018-11-05 04:34:32.468 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:34:32.468 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 044 Using default escc</span><br><span class="line">2018-11-05 04:34:32.468 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 045 Using default vscc</span><br><span class="line">2018-11-05 04:34:32.545 UTC [golang-platform] getCodeFromFS -&gt; DEBU 046 getCodeFromFS github.com/hyperledger/fabric/jicki/chaincode/go/example02</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] func1 -&gt; DEBU 047 Discarding GOROOT package fmt</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] func1 -&gt; DEBU 048 Discarding provided package github.com/hyperledger/fabric/core/chaincode/shim</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] func1 -&gt; DEBU 049 Discarding provided package github.com/hyperledger/fabric/protos/peer</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] func1 -&gt; DEBU 04a Discarding GOROOT package strconv</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] func1 -&gt; DEBU 04b skipping dir: /opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/cmd</span><br><span class="line">2018-11-05 04:34:34.204 UTC [golang-platform] GetDeploymentPayload -&gt; DEBU 04c done</span><br><span class="line">2018-11-05 04:34:34.204 UTC [container] WriteFileToPackage -&gt; DEBU 04d Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode.go</span><br><span class="line">2018-11-05 04:34:34.206 UTC [container] WriteFileToPackage -&gt; DEBU 04e Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode_test.go</span><br><span class="line">2018-11-05 04:34:34.206 UTC [msp/identity] Sign -&gt; DEBU 04f Sign: plaintext: 0A97070A5B08031A0B08DA90FFDE0510...C7F84F000000FFFFEB6FF30D00280000 </span><br><span class="line">2018-11-05 04:34:34.206 UTC [msp/identity] Sign -&gt; DEBU 050 Sign: digest: 608ADA9B6683C70D87397C3F254A354AEA4EEC4E69C67C5A67A8D25CF0291AFA </span><br><span class="line">2018-11-05 04:34:34.223 UTC [chaincodeCmd] install -&gt; INFO 051 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 安装指定合约到 所有的 peer 节点中，每个节点都必须安装一次</span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装 合约</span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/example02 -v 1.0  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:34:52.684 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:34:52.684 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-11-05 04:34:52.685 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:34:52.685 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:34:52.685 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:34:52.685 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:34:52.685 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc420533700, CONNECTING</span><br><span class="line">2018-11-05 04:34:52.686 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc420533700, READY</span><br><span class="line">2018-11-05 04:34:52.688 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:34:52.688 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:34:52.688 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:34:52.688 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:34:52.689 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc420598d60, CONNECTING</span><br><span class="line">2018-11-05 04:34:52.689 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc420598d60, READY</span><br><span class="line">2018-11-05 04:34:52.690 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:34:52.690 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 044 Using default escc</span><br><span class="line">2018-11-05 04:34:52.690 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 045 Using default vscc</span><br><span class="line">2018-11-05 04:34:52.748 UTC [golang-platform] getCodeFromFS -&gt; DEBU 046 getCodeFromFS github.com/hyperledger/fabric/jicki/chaincode/go/example02</span><br><span class="line">2018-11-05 04:34:53.087 UTC [golang-platform] func1 -&gt; DEBU 047 Discarding GOROOT package fmt</span><br><span class="line">2018-11-05 04:34:53.087 UTC [golang-platform] func1 -&gt; DEBU 048 Discarding provided package github.com/hyperledger/fabric/core/chaincode/shim</span><br><span class="line">2018-11-05 04:34:53.087 UTC [golang-platform] func1 -&gt; DEBU 049 Discarding provided package github.com/hyperledger/fabric/protos/peer</span><br><span class="line">2018-11-05 04:34:53.087 UTC [golang-platform] func1 -&gt; DEBU 04a Discarding GOROOT package strconv</span><br><span class="line">2018-11-05 04:34:53.088 UTC [golang-platform] func1 -&gt; DEBU 04b skipping dir: /opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/cmd</span><br><span class="line">2018-11-05 04:34:53.088 UTC [golang-platform] GetDeploymentPayload -&gt; DEBU 04c done</span><br><span class="line">2018-11-05 04:34:53.088 UTC [container] WriteFileToPackage -&gt; DEBU 04d Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode.go</span><br><span class="line">2018-11-05 04:34:53.089 UTC [container] WriteFileToPackage -&gt; DEBU 04e Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode_test.go</span><br><span class="line">2018-11-05 04:34:53.090 UTC [msp/identity] Sign -&gt; DEBU 04f Sign: plaintext: 0A9B070A5B08031A0B08ED90FFDE0510...C7F84F000000FFFFEB6FF30D00280000 </span><br><span class="line">2018-11-05 04:34:53.090 UTC [msp/identity] Sign -&gt; DEBU 050 Sign: digest: 2EBCA1E2BB3349F501E9DBE66E02B986333AE1FD3FEFE0AE86C985437FA2905C </span><br><span class="line">2018-11-05 04:34:53.105 UTC [chaincodeCmd] install -&gt; INFO 051 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<h3><span id="实例化-chaincode">实例化 Chaincode</span></h3>
<blockquote>
<p>这里无论多少个 peer 节点, 实例化只需要实例化一次，就可以。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 实例化合约 (未认证)</span><br><span class="line">peer chaincode instantiate -o orderer0.jicki.me:7050 -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;200&quot;,&quot;B&quot;,&quot;500&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 实例化合约 (已认证)</span><br><span class="line">peer chaincode instantiate -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;200&quot;,&quot;B&quot;,&quot;500&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-07 03:17:30.242 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-07 03:17:30.242 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-11-07 03:17:30.243 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:17:30.243 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:17:30.244 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:17:30.244 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:17:30.244 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4205e5be0, CONNECTING</span><br><span class="line">2018-11-07 03:17:30.248 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4205e5be0, READY</span><br><span class="line">2018-11-07 03:17:30.249 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:17:30.249 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:17:30.249 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:17:30.249 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:17:30.249 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4205b0780, CONNECTING</span><br><span class="line">2018-11-07 03:17:30.252 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4205b0780, READY</span><br><span class="line">2018-11-07 03:17:30.253 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-07 03:17:30.254 UTC [grpc] DialContext -&gt; DEBU 044 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:17:30.254 UTC [grpc] DialContext -&gt; DEBU 045 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:17:30.254 UTC [grpc] watcher -&gt; DEBU 046 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:17:30.254 UTC [grpc] switchBalancer -&gt; DEBU 047 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:17:30.254 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 048 pickfirstBalancer: HandleSubConnStateChange: 0xc42029ee50, CONNECTING</span><br><span class="line">2018-11-07 03:17:30.257 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 049 pickfirstBalancer: HandleSubConnStateChange: 0xc42029ee50, READY</span><br><span class="line">2018-11-07 03:17:30.257 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 04a Using default escc</span><br><span class="line">2018-11-07 03:17:30.257 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 04b Using default vscc</span><br><span class="line">2018-11-07 03:17:30.258 UTC [msp/identity] Sign -&gt; DEBU 04c Sign: plaintext: 0AA6070A6608031A0B08CAB289DF0510...324D53500A04657363630A0476736363 </span><br><span class="line">2018-11-07 03:17:30.258 UTC [msp/identity] Sign -&gt; DEBU 04d Sign: digest: 4CADBFD99999E7E35A2C6C221EE15A5D6D1531AEC62B35B70F47B3C638049B67 </span><br><span class="line">2018-11-07 03:17:30.267 UTC [msp/identity] Sign -&gt; DEBU 04e Sign: plaintext: 0AA6070A6608031A0B08CAB289DF0510...A39B1E366186F53CCB32CCEC0B05E851 </span><br><span class="line">2018-11-07 03:17:30.267 UTC [msp/identity] Sign -&gt; DEBU 04f Sign: digest: 382322A56C5F45E0E6432CBFB026334DDA4106A3DFEABE7A14802614F04D5914</span><br></pre></td></tr></table></figure>
<h3><span id="操作智能合约">操作智能合约</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># query 查询方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询 A 账户里的余额</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:35:47.211 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:35:47.212 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-05 04:35:47.212 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:35:47.212 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:35:47.213 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:35:47.213 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:35:47.213 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4205355e0, CONNECTING</span><br><span class="line">2018-11-05 04:35:47.214 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4205355e0, READY</span><br><span class="line">2018-11-05 04:35:47.216 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:35:47.216 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:35:47.216 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:35:47.216 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:35:47.216 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4203d2790, CONNECTING</span><br><span class="line">2018-11-05 04:35:47.217 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4203d2790, READY</span><br><span class="line">2018-11-05 04:35:47.218 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:35:47.218 UTC [msp/identity] Sign -&gt; DEBU 044 Sign: plaintext: 0AA6070A6A08031A0B08A391FFDE0510...706C65321A0A0A0571756572790A0141 </span><br><span class="line">2018-11-05 04:35:47.219 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: digest: F4FF4D4EE24CDFE6D2EF369DEF6AA927717916A8076FAD3A32396C2EE39D70B6 </span><br><span class="line">200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到 返回 200</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 查询 B 账户里的余额</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:36:00.734 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:36:00.734 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-05 04:36:00.735 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:00.735 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:00.735 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:00.735 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:00.735 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4203e5470, CONNECTING</span><br><span class="line">2018-11-05 04:36:00.737 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4203e5470, READY</span><br><span class="line">2018-11-05 04:36:00.738 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:00.739 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:00.739 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:00.739 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:00.739 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc42039b0c0, CONNECTING</span><br><span class="line">2018-11-05 04:36:00.740 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc42039b0c0, READY</span><br><span class="line">2018-11-05 04:36:00.740 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:36:00.741 UTC [msp/identity] Sign -&gt; DEBU 044 Sign: plaintext: 0AA7070A6B08031A0C08B091FFDE0510...706C65321A0A0A0571756572790A0142 </span><br><span class="line">2018-11-05 04:36:00.741 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: digest: 32655FF22BB7DBA7FC4D7CF39D1E5D65C4212A61E76E809124BBE6A823304F98 </span><br><span class="line">500</span><br><span class="line"></span><br><span class="line"># 可以看到 返回 500</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># invoke 转账方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 从A账户 转账 100 个币 到 B 账户 (未认证)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">peer chaincode invoke -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;100&quot;]&#125;&apos;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 从A账户 转账 100 个币 到 B 账户 (开启认证)</span><br><span class="line"></span><br><span class="line">peer chaincode invoke -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;100&quot;]&#125;&apos; -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-07 03:19:54.832 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-07 03:19:54.832 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-11-07 03:19:54.833 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:19:54.833 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:19:54.833 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:19:54.833 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:19:54.833 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4203b7ce0, CONNECTING</span><br><span class="line">2018-11-07 03:19:54.837 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4203b7ce0, READY</span><br><span class="line">2018-11-07 03:19:54.838 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:19:54.839 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:19:54.839 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:19:54.839 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:19:54.839 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4206c67f0, CONNECTING</span><br><span class="line">2018-11-07 03:19:54.842 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4206c67f0, READY</span><br><span class="line">2018-11-07 03:19:54.843 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-07 03:19:54.843 UTC [grpc] DialContext -&gt; DEBU 044 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-07 03:19:54.843 UTC [grpc] DialContext -&gt; DEBU 045 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-07 03:19:54.843 UTC [grpc] watcher -&gt; DEBU 046 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-07 03:19:54.843 UTC [grpc] switchBalancer -&gt; DEBU 047 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-07 03:19:54.843 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 048 pickfirstBalancer: HandleSubConnStateChange: 0xc4201b2390, CONNECTING</span><br><span class="line">2018-11-07 03:19:54.846 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 049 pickfirstBalancer: HandleSubConnStateChange: 0xc4201b2390, READY</span><br><span class="line">2018-11-07 03:19:54.847 UTC [msp/identity] Sign -&gt; DEBU 04a Sign: plaintext: 0AAB070A6B08031A0C08DAB389DF0510...6E766F6B650A01410A01420A03313030 </span><br><span class="line">2018-11-07 03:19:54.847 UTC [msp/identity] Sign -&gt; DEBU 04b Sign: digest: E9E5E9E5DC7C48C05F60D8314820AB7160C5303A4B037BAD03EE061AB056FC10 </span><br><span class="line">2018-11-07 03:19:54.863 UTC [msp/identity] Sign -&gt; DEBU 04c Sign: plaintext: 0AAB070A6B08031A0C08DAB389DF0510...52C77A337E38F86AFD2A4A02F3E9D10F </span><br><span class="line">2018-11-07 03:19:54.863 UTC [msp/identity] Sign -&gt; DEBU 04d Sign: digest: 74B9DE72CE632AC6CA283A39CF95AADD3A252CC71EF5C213E21A14CFDAC07589 </span><br><span class="line">2018-11-07 03:19:54.872 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; DEBU 04e ESCC invoke result: version:1 response:&lt;status:200 &gt; payload:&quot;\n MM7\026q4R\244\332\217i^\345\&quot;2L\227\336\336G`_m3m\233f$\206/\226\025\022d\nL\0220\n\010example2\022$\n\007\n\001A\022\002\010\001\n\007\n\001B\022\002\010\001\032\006\n\001A\032\0010\032\010\n\001B\032\003150\022\030\n\004lscc\022\020\n\016\n\010example2\022\002\010\001\032\003\010\310\001\&quot;\017\022\010example2\032\0031.0&quot; endorsement:&lt;endorser:&quot;\n\007Org2MSP\022\216\006-----BEGIN CERTIFICATE-----\nMIICFDCCAbqgAwIBAgIRANsTa6zjKyWSP3Tjh+32N5UwCgYIKoZIzj0EAwIwZzEL\nMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzERMA8GA1UEBxMIU2hlblpo\nZW4xFjAUBgNVBAoTDW9yZzIuamlja2kubWUxGTAXBgNVBAMTEGNhLm9yZzIuamlj\na2kubWUwHhcNMTgxMTA1MDM0OTAwWhcNMjgxMTAyMDM0OTAwWjBhMQswCQYDVQQG\nEwJDTjESMBAGA1UECBMJR3VhbmdEb25nMREwDwYDVQQHEwhTaGVuWmhlbjENMAsG\nA1UECxMEcGVlcjEcMBoGA1UEAxMTcGVlcjAub3JnMi5qaWNraS5tZTBZMBMGByqG\nSM49AgEGCCqGSM49AwEHA0IABLB5tlyikwEe9Ec+n7kSYpwOWnsM+IMJ0xa14kdg\nN3N276hLr/EeBEuvfpgPwi7cl3nFnrMmRuT/zQbiafggdmCjTTBLMA4GA1UdDwEB\n/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAILy8haOZJxVQLH5+fSG3\nkmeKnQNmilK7GKDBCGLUUiLDMAoGCCqGSM49BAMCA0gAMEUCIQDd7AZB9w3eY8Ms\nomoKMSYB0T3TS9iGJY+Pr25GLNpcpAIgJzxfN9X7HiPJShC0jYCCAUdCsEXB5t2l\njsWDuxFMujk=\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\257#\&quot;$2\233\032\304Y\245Nk\377`\321W\357\235J\225\r\247\370\030V\313N\314\347+\255\306\002 m\017\205\000\017\236g\217\336\211\357\205\372\006=&amp;R\307z3~8\370j\375*J\002\363\351\321\017&quot; &gt; </span><br><span class="line">2018-11-07 03:19:54.872 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 04f Chaincode invoke successful. result: status:200 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到返回 invoke successful. result: status:200 成功</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># 这里再查询 A 与 B 的账户</span><br><span class="line"></span><br><span class="line"># A 账户余额 </span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]&#125;&apos;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:36:26.574 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:36:26.574 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-05 04:36:26.575 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:26.575 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:26.575 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:26.575 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:26.575 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc42066b6f0, CONNECTING</span><br><span class="line">2018-11-05 04:36:26.577 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42066b6f0, READY</span><br><span class="line">2018-11-05 04:36:26.578 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:26.578 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:26.579 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:26.579 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:26.579 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4206dfdf0, CONNECTING</span><br><span class="line">2018-11-05 04:36:26.579 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4206dfdf0, READY</span><br><span class="line">2018-11-05 04:36:26.580 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:36:26.581 UTC [msp/identity] Sign -&gt; DEBU 044 Sign: plaintext: 0AA7070A6B08031A0C08CA91FFDE0510...706C65321A0A0A0571756572790A0141 </span><br><span class="line">2018-11-05 04:36:26.581 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: digest: 0BA86741E22D8C11EBADBB4C753849CF6EF9E3FFD0AFB713BB8E6DD5C80043D8 </span><br><span class="line">100</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># B 账户余额 </span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]&#125;&apos;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-05 04:36:39.259 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-11-02 03:49:00 +0000 UTC</span><br><span class="line">2018-11-05 04:36:39.259 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-11-05 04:36:39.260 UTC [grpc] DialContext -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:39.260 UTC [grpc] DialContext -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:39.260 UTC [grpc] watcher -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:39.260 UTC [grpc] switchBalancer -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:39.260 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4203b5470, CONNECTING</span><br><span class="line">2018-11-05 04:36:39.261 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4203b5470, READY</span><br><span class="line">2018-11-05 04:36:39.263 UTC [grpc] DialContext -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-11-05 04:36:39.263 UTC [grpc] DialContext -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-11-05 04:36:39.263 UTC [grpc] watcher -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-11-05 04:36:39.263 UTC [grpc] switchBalancer -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-11-05 04:36:39.263 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4205e8d50, CONNECTING</span><br><span class="line">2018-11-05 04:36:39.264 UTC [grpc] HandleSubConnStateChange -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4205e8d50, READY</span><br><span class="line">2018-11-05 04:36:39.265 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-11-05 04:36:39.265 UTC [msp/identity] Sign -&gt; DEBU 044 Sign: plaintext: 0AA6070A6A08031A0B08D791FFDE0510...706C65321A0A0A0571756572790A0142 </span><br><span class="line">2018-11-05 04:36:39.265 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: digest: 6792CE0A74737C90A6ABC66A99C414B11E560D2AFEDBFFCD3C928CCE61B7597B </span><br><span class="line">600</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看 peer0.org1.jicki.me 节点里 生成的容器</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                     COMMAND                  CREATED             STATUS              PORTS                                                                                         NAMES</span><br><span class="line">526b6b46a60e        jicki-peer0.org1.jicki.me-example2-1.0-58e362edb293b97212b572bd603337608795d8168a8a3632d2a14ac12fa6ae70   &quot;chaincode -peer.add…&quot;   About a minute ago   Up About a minute                                                                                                                                            jicki-peer0.org1.jicki.me-example2-1.0</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-操作命令">Hyperledger Fabric 操作命令</span></h2>
<h3><span id="peer-命令">peer 命令</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode          # 对链进行操作</span><br><span class="line">peer channel            # channel相关操作</span><br><span class="line">peer logging            # 设置日志级别</span><br><span class="line">peer node               # 启动、管理节点</span><br><span class="line">peer version            # 查看版本信息</span><br></pre></td></tr></table></figure>
<blockquote>
<p>upgrade 更新合约 更新合约相当于将合约重新实例化，并带有一个新的版本号。</p>
<p>更新合约之前，需要在所有的 peer节点 上安装(install)最新的合约，并使用新的版本号。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 更新合约</span><br><span class="line"></span><br><span class="line"># 首先安装(install)新的合约, 以本文为例, chaincode_example02, 初次安装版本号为 1.0 </span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/chaincode_example02 -v 1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更新版本为 1.1 的合约 (未开启认证)</span><br><span class="line">peer chaincode upgrade -o orderer0.jicki.me:7050 -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;100&quot;,&quot;B&quot;,&quot;50&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.1 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更新版本为 1.1 的合约 (开启认证)</span><br><span class="line">peer chaincode upgrade -o orderer0.jicki.me:7050 -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;100&quot;,&quot;B&quot;,&quot;50&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.1 -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 旧版本的合约, 目前，fabric不支持合约的启动与暂停。要暂停或删除合约，只能到peer上手动删除容器。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 查看 已经创建的 通道 (channel)</span><br><span class="line"></span><br><span class="line">peer channel  list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看通道(channel) 的状态 -c(小写) 加 通道名称</span><br><span class="line"></span><br><span class="line">peer channel getinfo -c mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看已经 安装的 智能合约(chincode)</span><br><span class="line"></span><br><span class="line">peer chaincode  list --installed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看已经 实例化的 智能合约(chincode) 需要使用 -C(大写) 加通道名称</span><br><span class="line"></span><br><span class="line">peer chaincode -C mychannel list --instantiated</span><br></pre></td></tr></table></figure>
<h1><span id="配置-hyperledger-fabric-balance-transfer">配置 Hyperledger Fabric balance-transfer</span></h1>
<h2><span id="安装-nodejs">安装 node.js</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 安装NodeJS</span><br><span class="line"> curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -</span><br><span class="line"> </span><br><span class="line"> yum install -y nodejs</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 验证</span><br><span class="line"></span><br><span class="line">node -v</span><br><span class="line">v8.11.4</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">npm -v</span><br><span class="line">5.6.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更改 npm 源为 taobao 源</span><br><span class="line"></span><br><span class="line">npm install node-gyp --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install node-pre-gyp --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install grpc --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm install --registry=https://registry.npm.taobao.org</span><br><span class="line"></span><br><span class="line">npm rebuild</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装一下 jq </span><br><span class="line"></span><br><span class="line"> yum install jq -y</span><br></pre></td></tr></table></figure>
<h2><span id="下载源码">下载源码</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/jicki</span><br><span class="line"></span><br><span class="line">git clone https://github.com/hyperledger/fabric-samples.git</span><br><span class="line"></span><br><span class="line">mv fabric-samples/balance-transfer .</span><br></pre></td></tr></table></figure>
<h2><span id="修改配置文件">修改配置文件</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mv network-config.yaml network-config.yaml-bak</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 增加 network-config 文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">vi network-config.yaml </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">name: &quot;balance-transfer&quot;</span><br><span class="line">x-type: &quot;hlfv1&quot;</span><br><span class="line">description: &quot;Balance Transfer Network&quot;</span><br><span class="line">version: &quot;1.0&quot;</span><br><span class="line">channels:</span><br><span class="line">  mychannel:</span><br><span class="line">    orderers:</span><br><span class="line">      - orderer0.jicki.me</span><br><span class="line">    peers:</span><br><span class="line">      peer0.org1.jicki.me:</span><br><span class="line">        endorsingPeer: true</span><br><span class="line">        chaincodeQuery: true</span><br><span class="line">        ledgerQuery: true</span><br><span class="line">        eventSource: true</span><br><span class="line"></span><br><span class="line">      #peer1.org1.jicki.me:</span><br><span class="line">      #  endorsingPeer: false</span><br><span class="line">      #  chaincodeQuery: true</span><br><span class="line">      #  ledgerQuery: true</span><br><span class="line">      #  eventSource: false</span><br><span class="line"></span><br><span class="line">      peer0.org2.jicki.me:</span><br><span class="line">        endorsingPeer: true</span><br><span class="line">        chaincodeQuery: true</span><br><span class="line">        ledgerQuery: true</span><br><span class="line">        eventSource: true</span><br><span class="line"></span><br><span class="line">      #peer1.org2.jicki.me:</span><br><span class="line">      #  endorsingPeer: false</span><br><span class="line">      #  chaincodeQuery: true</span><br><span class="line">      #  ledgerQuery: true</span><br><span class="line">      #  eventSource: false</span><br><span class="line"></span><br><span class="line">    chaincodes:</span><br><span class="line">      - mycc:v0</span><br><span class="line"></span><br><span class="line">organizations:</span><br><span class="line">  Org1:</span><br><span class="line">    mspid: Org1MSP</span><br><span class="line"></span><br><span class="line">    peers:</span><br><span class="line">      - peer0.org1.jicki.me</span><br><span class="line">      #- peer1.org1.jicki.me</span><br><span class="line"></span><br><span class="line">    certificateAuthorities:</span><br><span class="line">      - ca-org1</span><br><span class="line">    adminPrivateKey:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp/keystore/a9666f561d211e7b7cc170bfe854721431a1038b7914a67555d82dcf6b9eaaf8_sk</span><br><span class="line">    signedCert:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp/signcerts/Admin@org1.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line">  Org2:</span><br><span class="line">    mspid: Org2MSP</span><br><span class="line">    peers:</span><br><span class="line">      - peer0.org2.jicki.me</span><br><span class="line">      #- peer1.org2.jicki.me</span><br><span class="line"></span><br><span class="line">    certificateAuthorities:</span><br><span class="line">      - ca-org2</span><br><span class="line">    adminPrivateKey:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp/keystore/d402b684b807080653511978a51fcd2326668156cd8a10fb612b80bc49c9b354_sk</span><br><span class="line">    signedCert:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp/signcerts/Admin@org2.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line">orderers:</span><br><span class="line">  orderer0.jicki.me:</span><br><span class="line">    url: grpcs://localhost:7050</span><br><span class="line"></span><br><span class="line">    grpcOptions:</span><br><span class="line">      ssl-target-name-override: orderer0.jicki.me</span><br><span class="line"></span><br><span class="line">    tlsCACerts:</span><br><span class="line">      path: artifacts/channel/crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/tls/ca.crt</span><br><span class="line"></span><br><span class="line">peers:</span><br><span class="line">  peer0.org1.jicki.me:</span><br><span class="line">    # this URL is used to send endorsement and query requests</span><br><span class="line">    url: grpcs://localhost:7051</span><br><span class="line"></span><br><span class="line">    grpcOptions:</span><br><span class="line">      ssl-target-name-override: peer0.org1.jicki.me</span><br><span class="line">    tlsCACerts:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line"></span><br><span class="line">  #peer1.org1.jicki.me:</span><br><span class="line">  #  url: grpcs://localhost:7056</span><br><span class="line">  #  grpcOptions:</span><br><span class="line">  #    ssl-target-name-override: peer1.org1.jicki.me</span><br><span class="line">  #  tlsCACerts:</span><br><span class="line">  #    path: artifacts/channel/crypto-config/peerOrganizations/org1.jicki.me/peers/peer1.org1.jicki.me/tls/ca.crt</span><br><span class="line"></span><br><span class="line">  peer0.org2.jicki.me:</span><br><span class="line">    url: grpcs://localhost:8051</span><br><span class="line">    grpcOptions:</span><br><span class="line">      ssl-target-name-override: peer0.org2.jicki.me</span><br><span class="line">    tlsCACerts:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line"></span><br><span class="line">  #peer1.org2.jicki.me:</span><br><span class="line">  #  url: grpcs://localhost:8056</span><br><span class="line">  #  eventUrl: grpcs://localhost:8058</span><br><span class="line">  #  grpcOptions:</span><br><span class="line">  #    ssl-target-name-override: peer1.org2.jicki.me</span><br><span class="line">  #  tlsCACerts:</span><br><span class="line">  #    path: artifacts/channel/crypto-config/peerOrganizations/org2.jicki.me/peers/peer1.org2.jicki.me/tls/ca.crt</span><br><span class="line"></span><br><span class="line">certificateAuthorities:</span><br><span class="line">  ca-org1:</span><br><span class="line">    url: https://localhost:7054</span><br><span class="line">    httpOptions:</span><br><span class="line">      verify: false</span><br><span class="line">    tlsCACerts:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org1.jicki.me/ca/ca.org1.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line">    registrar:</span><br><span class="line">      - enrollId: admin</span><br><span class="line">        enrollSecret: adminpw</span><br><span class="line">    caName: ca-org1</span><br><span class="line"></span><br><span class="line">  ca-org2:</span><br><span class="line">    url: https://localhost:8054</span><br><span class="line">    httpOptions:</span><br><span class="line">      verify: false</span><br><span class="line">    tlsCACerts:</span><br><span class="line">      path: artifacts/channel/crypto-config/peerOrganizations/org2.jicki.me/ca/ca.org2.jicki.me-cert.pem</span><br><span class="line">    registrar:</span><br><span class="line">      - enrollId: admin</span><br><span class="line">        enrollSecret: adminpw</span><br><span class="line">    caName: ca-org2</span><br></pre></td></tr></table></figure>
<h2><span id="拷贝证书文件">拷贝证书文件</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/jicki/balance-transfer/artifacts/</span><br><span class="line"></span><br><span class="line">mv channel channel-bak</span><br><span class="line"></span><br><span class="line">mkdir channel</span><br><span class="line"></span><br><span class="line"># 拷贝自行生成的证书文件以及tx，等文件 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost channel]# ls -lt</span><br><span class="line">总用量 56</span><br><span class="line">-rw-r--r-- 1 root root   281 11月  5 16:40 Org1MSPanchors.tx</span><br><span class="line">-rw-r--r-- 1 root root   281 11月  5 16:40 Org2MSPanchors.tx</span><br><span class="line">-rw-r--r-- 1 root root   346 11月  5 16:40 channel.tx</span><br><span class="line">-rw-r--r-- 1 root root 12479 11月  5 16:40 genesis.block</span><br><span class="line">-rw-r--r-- 1 root root 15407 11月  5 16:39 mychannel.block</span><br><span class="line">-rw-r--r-- 1 root root   645 11月  5 16:39 crypto-config.yaml</span><br><span class="line">-rw-r--r-- 1 root root  3859 11月  5 16:39 configtx.yaml</span><br><span class="line">drwxr-xr-x 4 root root    69 11月  5 16:38 crypto-config</span><br></pre></td></tr></table></figure>
<h2><span id="启动-balance-transfer">启动 balance-transfer</span></h2>
<blockquote>
<p><a href="http://runApp.sh" target="_blank" rel="noopener">runApp.sh</a> 脚本里包含了 启动 ca 节点 以及 peer 节点的docker-compose</p>
<p>如上我们已经启动过了，只需要直接运行 node app 既可，所以不需要用到此脚本</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 安装依赖</span><br><span class="line"></span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 导入环境变量</span><br><span class="line"></span><br><span class="line">PORT=4000 </span><br><span class="line">HOST=192.168.168.100</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line"></span><br><span class="line">node app</span><br></pre></td></tr></table></figure>
<h2><span id="测试-调用-api">测试 调用 API</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 运行 testAPIs.sh 可全部API跑一次</span><br><span class="line"></span><br><span class="line"># 本文中只运行了 2个 peer </span><br><span class="line"></span><br><span class="line"># 所以需要 编辑 testAPIs.sh 修改文件中 删除 peer1.org1.jicki.me  以及 peer1.org2.jicki.me</span><br><span class="line"></span><br><span class="line"># 修改  &quot;channelConfigPath&quot;:&quot;../artifacts/channel/mychannel.tx&quot; 中 mychannel.tx 为 channel.tx</span><br></pre></td></tr></table></figure>
<h3><span id="创建用户">创建用户</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 创建用户</span><br><span class="line"></span><br><span class="line">curl -s -X POST http://localhost:4000/users -H &quot;content-type: application/x-www-form-urlencoded&quot; -d &apos;username=jicki&amp;orgName=Org1&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:true,&quot;secret&quot;:&quot;&quot;,&quot;message&quot;:&quot;jicki enrolled Successfully&quot;,&quot;token&quot;:&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NDE2MTIwNzAsInVzZXJuYW1lIjoiSmltIiwib3JnTmFtZSI6Ik9yZzEiLCJpYXQiOjE1NDE1NzYwNzB9.pQZAqkeRW7vtwvNSrSTy4SKsVt5yFGafzlWTQjjONWE&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注册成功以后~~取 token 部分,配置成环境变量, 如下操作需用使用此 token</span><br><span class="line"></span><br><span class="line">ORG1_TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1NDE2MTIwNzAsInVzZXJuYW1lIjoiSmltIiwib3JnTmFtZSI6Ik9yZzEiLCJpYXQiOjE1NDE1NzYwNzB9.pQZAqkeRW7vtwvNSrSTy4SKsVt5yFGafzlWTQjjONWE</span><br></pre></td></tr></table></figure>
<h3><span id="创建-channel">创建 channel</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 创建 channel </span><br><span class="line"># 此处 channelName 如果存在会失败~ 报如下错误</span><br><span class="line"></span><br><span class="line">response ::&#123;&quot;status&quot;:&quot;BAD_REQUEST&quot;,&quot;info&quot;:&quot;error authorizing update: error validating ReadSet: readset expected key [Group]  /Channel/Application at version 0, but got version 1&quot;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST \</span><br><span class="line">  http://localhost:4000/channels \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot; \</span><br><span class="line">  -d &apos;&#123;</span><br><span class="line">    &quot;channelName&quot;:&quot;mychannel&quot;,</span><br><span class="line">    &quot;channelConfigPath&quot;:&quot;../artifacts/channel/channel.tx&quot;</span><br><span class="line">&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 关于 channelName  需要跟 创建 channel.tx 时的 channelID 对应，否则报如下错误:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2018-11-09 12:03:28.276] [DEBUG] Create-Channel -  response ::&#123;&quot;status&quot;:&quot;BAD_REQUEST&quot;,&quot;info&quot;:&quot;Failing initial channel config creation: mismatched channel IDs: &apos;mychannel&apos; != &apos;youchannel&apos;&quot;&#125;</span><br><span class="line">[2018-11-09 12:03:28.277] [ERROR] Create-Channel - </span><br><span class="line">!!!!!!!!! Failed to create the channel &apos;youchannel&apos; !!!!!!!!!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[2018-11-09 12:03:28.277] [ERROR] Create-Channel - Error: Failed to create the channel &apos;youchannel&apos;</span><br></pre></td></tr></table></figure>
<h3><span id="加入-channel">加入 channel</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 加入 ORG1 加入 channel </span><br><span class="line"></span><br><span class="line"># 如果已加入 channel 报如下错误:</span><br><span class="line"></span><br><span class="line">[DEBUG] Join-Channel - Join Channel R E S P O N S E : [null,[&#123;&quot;status&quot;:500,&quot;payload&quot;:&#123;&quot;type&quot;:&quot;Buffer&quot;,&quot;data&quot;:[]&#125;,&quot;isProposalResponse&quot;:true&#125;]]</span><br><span class="line">[ERROR] Join-Channel - Failed to join peer to the channel mychannel</span><br><span class="line">[ERROR] Join-Channel - Failed to join all peers to channel. cause:Failed to join peer to the channel mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST \</span><br><span class="line">  http://localhost:4000/channels/mychannel/peers \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot; \</span><br><span class="line">  -d &apos;&#123;</span><br><span class="line">    &quot;peers&quot;: [&quot;peer0.org1.jicki.me&quot;]</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3><span id="安装-chaincode">安装 chaincode</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 为 ORG1 安装 chaincode</span><br><span class="line"># 已存在报如下错误:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:10:44.011] [ERROR] install-chaincode - TypeError: proposalResponses.toJSON is not a function</span><br><span class="line">    at Object.installChaincode (/opt/jicki/balance-transfer/app/install-chaincode.js:58:66)</span><br><span class="line">    at &lt;anonymous&gt;</span><br><span class="line">[2018-11-07 16:10:44.011] [ERROR] install-chaincode - Failed to install due to:TypeError: proposalResponses.toJSON is not a function</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST \</span><br><span class="line">  http://localhost:4000/chaincodes \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot; \</span><br><span class="line">  -d &apos;&#123;</span><br><span class="line">    &quot;peers&quot;: [&quot;peer0.org1.jicki.me&quot;],</span><br><span class="line">    &quot;chaincodeName&quot;:&quot;mycc&quot;,</span><br><span class="line">    &quot;chaincodePath&quot;:&quot;github.com/example_cc/go&quot;,</span><br><span class="line">    &quot;chaincodeType&quot;: &quot;golang&quot;,</span><br><span class="line">    &quot;chaincodeVersion&quot;:&quot;v0&quot;</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3><span id="实例化chaincode">实例化chaincode</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 如果已经实例化 报如下错误:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:12:10.040] [ERROR] instantiate-chaincode - instantiate proposal was bad</span><br><span class="line">[2018-11-07 16:12:10.040] [DEBUG] instantiate-chaincode - Failed to send Proposal and receive all good ProposalResponse</span><br><span class="line">[2018-11-07 16:12:10.040] [ERROR] instantiate-chaincode - Failed to instantiate. cause:Failed to send Proposal and receive all good ProposalResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST \</span><br><span class="line">  http://localhost:4000/channels/mychannel/chaincodes \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot; \</span><br><span class="line">  -d &apos;&#123;</span><br><span class="line">    &quot;peers&quot;: [&quot;peer0.org1.jicki.me&quot;],</span><br><span class="line">    &quot;chaincodeName&quot;:&quot;mycc&quot;,</span><br><span class="line">    &quot;chaincodeVersion&quot;:&quot;v0&quot;,</span><br><span class="line">    &quot;chaincodeType&quot;: &quot;golang&quot;,</span><br><span class="line">    &quot;args&quot;:[&quot;a&quot;,&quot;100&quot;,&quot;b&quot;,&quot;200&quot;]</span><br><span class="line">&#125;&apos;</span><br></pre></td></tr></table></figure>
<h3><span id="查询已创建的-channel">查询已创建的 channel</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/channels?peer=peer0.org1.jicki.me&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 返回如下信息:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:19:29.592] [DEBUG] Query - &lt;&lt;&lt; channels &gt;&gt;&gt;</span><br><span class="line">[2018-11-07 16:19:29.592] [DEBUG] Query - [ &apos;channel id: mychannel&apos; ]</span><br></pre></td></tr></table></figure>
<h3><span id="查询-chaincode">查询 chaincode</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#  %5B%22a%22%5D Escape 加密以后 等于 [&quot;a&quot;]</span><br><span class="line">#  %5B%22b%22%5D Escape 加密以后 等于 [&quot;b&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询 a 的值</span><br><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/channels/mychannel/chaincodes/mycc?peer=peer0.org1.jicki.me&amp;fcn=query&amp;args=%5B%22a%22%5D&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-11-07 16:33:29.266] [INFO] Query - a now has 100 after the move</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询 b 的值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/channels/mychannel/chaincodes/mycc?peer=peer0.org1.jicki.me&amp;fcn=query&amp;args=%5B%22b%22%5D&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:34:12.378] [INFO] Query - b now has 200 after the move</span><br></pre></td></tr></table></figure>
<h3><span id="操作交易">操作交易</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"># 从 A账号 转账 10 到 B账号中</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 必须配置 org1 与 org2 节点的 peers 否则报错:</span><br><span class="line"></span><br><span class="line">[2018-11-07 17:17:53.267] [ERROR] invoke-chaincode - The invoke chaincode transaction was invalid, code:ENDORSEMENT_POLICY_FAILURE</span><br><span class="line">[2018-11-07 17:17:53.268] [ERROR] invoke-chaincode - Error: The invoke chaincode transaction was invalid, code:ENDORSEMENT_POLICY_FAILURE</span><br><span class="line">[2018-11-07 17:17:53.268] [ERROR] invoke-chaincode - Failed to invoke chaincode. cause:Error: The invoke chaincode transaction was invalid, code:ENDORSEMENT_POLICY_FAILURE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl -s -X POST \</span><br><span class="line">  http://localhost:4000/channels/mychannel/chaincodes/mycc \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot; \</span><br><span class="line">  -d &apos;&#123;</span><br><span class="line">    &quot;peers&quot;: [&quot;peer0.org1.jicki.me&quot;, &quot;peer0.org2.jicki.me&quot;],</span><br><span class="line">    &quot;fcn&quot;:&quot;move&quot;,</span><br><span class="line">    &quot;args&quot;:[&quot;a&quot;,&quot;b&quot;,&quot;10&quot;]</span><br><span class="line">&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">POST invoke chaincode on peers of Org1 and Org2</span><br><span class="line"></span><br><span class="line">Transaction ID is 70a5157704b950cca09a6a46f5be7fca61355b43ed83f3d9a5b633f3e38b3619</span><br></pre></td></tr></table></figure>
<h3><span id="查询-chaininfo">查询 chainInfo</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/channels/mychannel?peer=peer0.org1.jicki.me&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"># 返回如下信息:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:14:55.648] [DEBUG] Query - &#123; height: Long &#123; low: 5, high: 0, unsigned: true &#125;,</span><br><span class="line">  currentBlockHash: </span><br><span class="line">   ByteBuffer &#123;</span><br><span class="line">     buffer: &lt;Buffer 08 05 12 20 c0 c4 f3 65 a3 8a 66 d4 1e ff a4 45 3e 1c e6 2b 90 d3 38 4f 18 3f d5 b3 38 76 0e 26 30 32 e0 f9 1a 20 da 35 eb d4 1b 11 b2 7f 1a 07 c5 30 ... &gt;,</span><br><span class="line">     offset: 4,</span><br><span class="line">     markedOffset: -1,</span><br><span class="line">     limit: 36,</span><br><span class="line">     littleEndian: true,</span><br><span class="line">     noAssert: false &#125;,</span><br><span class="line">  previousBlockHash: </span><br><span class="line">   ByteBuffer &#123;</span><br><span class="line">     buffer: &lt;Buffer 08 05 12 20 c0 c4 f3 65 a3 8a 66 d4 1e ff a4 45 3e 1c e6 2b 90 d3 38 4f 18 3f d5 b3 38 76 0e 26 30 32 e0 f9 1a 20 da 35 eb d4 1b 11 b2 7f 1a 07 c5 30 ... &gt;,</span><br><span class="line">     offset: 38,</span><br><span class="line">     markedOffset: -1,</span><br><span class="line">     limit: 70,</span><br><span class="line">     littleEndian: true,</span><br><span class="line">     noAssert: false &#125; &#125;</span><br></pre></td></tr></table></figure>
<h3><span id="查询已安装-chaincode">查询已安装 chaincode</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/chaincodes?peer=peer0.org1.jicki.me&amp;type=installed&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 返回如下信息:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:17:01.758] [DEBUG] Query - &lt;&lt;&lt; Installed Chaincodes &gt;&gt;&gt;</span><br><span class="line">[2018-11-07 16:17:01.758] [DEBUG] Query - name: mycc, version: v0, path: github.com/example_cc/go</span><br></pre></td></tr></table></figure>
<h3><span id="查询实例化-chaincode">查询实例化 chaincode</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">curl -s -X GET \</span><br><span class="line">  &quot;http://localhost:4000/chaincodes?peer=peer0.org1.jicki.me&amp;type=instantiated&quot; \</span><br><span class="line">  -H &quot;authorization: Bearer $ORG1_TOKEN&quot; \</span><br><span class="line">  -H &quot;content-type: application/json&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 返回如下信息:</span><br><span class="line"></span><br><span class="line">[2018-11-07 16:18:06.494] [DEBUG] Query - &lt;&lt;&lt; Installed Chaincodes &gt;&gt;&gt;</span><br><span class="line">[2018-11-07 16:18:06.494] [DEBUG] Query - name: mycc, version: v0, path: github.com/example_cc/go</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/01/30/2018-12-04-Certbot/" data-toggle="tooltip" data-placement="top" title="Let's Encrypt 证书 申请">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/01/30/2018-10-09-kubernetes-1.12.1/" data-toggle="tooltip" data-placement="top" title="kubernetes 1.12.1">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share" data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">部署 hyperledger-fabric v1.3</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">环境规划</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">官方地址</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">环境准备</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">Hyperledger Fabric 源码</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">生成 Hyperledger Fabric 证书</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">生成 Hyperledger Fabric 创世区块</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">配置 Zookeeper Kafka 集群</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">配置 Hyperledger Fabric Orderer</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.1.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.9.</span> <span class="toc-nav-text">配置 Hyperledger Fabric ca 节点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.10.</span> <span class="toc-nav-text">配置 Hyperledger Fabric peer</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.10.1.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.11.</span> <span class="toc-nav-text">配置 Hyperledger Fabric cli 客户端</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.11.1.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.12.</span> <span class="toc-nav-text">Hyperledger Fabric 创建 Channel</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.13.</span> <span class="toc-nav-text">Hyperledger Fabric 加入 Channel</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.14.</span> <span class="toc-nav-text">Hyperledger Fabric 实例化测试</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.14.1.</span> <span class="toc-nav-text">安装智能合约</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.14.2.</span> <span class="toc-nav-text">实例化 Chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.14.3.</span> <span class="toc-nav-text">操作智能合约</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.15.</span> <span class="toc-nav-text">Hyperledger Fabric 操作命令</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.15.1.</span> <span class="toc-nav-text">peer 命令</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">配置 Hyperledger Fabric balance-transfer</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">安装 node.js</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">下载源码</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">修改配置文件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">拷贝证书文件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">启动 balance-transfer</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">测试 调用 API</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.1.</span> <span class="toc-nav-text">创建用户</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.2.</span> <span class="toc-nav-text">创建 channel</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.3.</span> <span class="toc-nav-text">加入 channel</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.4.</span> <span class="toc-nav-text">安装 chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.5.</span> <span class="toc-nav-text">实例化chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.6.</span> <span class="toc-nav-text">查询已创建的 channel</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.7.</span> <span class="toc-nav-text">查询 chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.8.</span> <span class="toc-nav-text">操作交易</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.9.</span> <span class="toc-nav-text">查询 chainInfo</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.10.</span> <span class="toc-nav-text">查询已安装 chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.11.</span> <span class="toc-nav-text">查询实例化 chaincode</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#docker" title="docker">docker</a>
                        
                          <a class="tag" href="/tags/#fabric" title="fabric">fabric</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://www.jicki.me" target="_blank">小炒肉</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "jicki";
    var disqus_identifier = "https://www.jicki.me/2019/01/30/2018-11-06-hyperledger-fabric-1.3/";
    var disqus_url = "https://www.jicki.me/2019/01/30/2018-11-06-hyperledger-fabric-1.3/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/jicki234">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/jicki520">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 小炒肉 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.jicki.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-85602329-1';
    var _gaDomain = 'jicki.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '1b38b88e4559c6725330b8c3328e2de3';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.jicki.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
