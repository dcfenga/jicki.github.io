<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Your future depends on your dreams">
    <meta name="keyword" content="小炒肉, 运维工程师, Jicki, DevOps, Docker, Kubernetes">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          kubernetes 1.8.4 to kubespray - 小炒肉 | Blog
        
    </title>

    <link rel="canonical" href="https://www.jicki.me/2019/01/30/2017-12-08-kubernetes-kubespray-1.8.4/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('img/pexels/triangular.jpeg')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>kubernetes 1.8.4 to kubespray</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 小炒肉 on
                            2019-01-30
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">小炒肉</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="kubernetes-184-to-kubespray">kubernetes 1.8.4 to kubespray</span></h1>
<blockquote>
<p>官方 github  <a href="https://github.com/kubernetes-incubator/kubespray" target="_blank" rel="noopener">https://github.com/kubernetes-incubator/kubespray</a></p>
</blockquote>
<h1><span id="环境准备">环境准备</span></h1>
<h2><span id="初始化环境">初始化环境</span></h2>
<table>
<thead>
<tr>
<th>节点</th>
<th>IP</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.16.1.64</td>
<td>node1</td>
</tr>
<tr>
<td>172.16.1.65</td>
<td>node2</td>
</tr>
<tr>
<td>172.16.1.66</td>
<td>node3</td>
</tr>
</tbody>
</table>
<h2><span id="设置hostname">设置hostname</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl --static set-hostname hostname</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>IP</th>
<th>hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.16.1.64</td>
<td>node1</td>
</tr>
<tr>
<td>172.16.1.65</td>
<td>node2</td>
</tr>
<tr>
<td>172.16.1.66</td>
<td>node3</td>
</tr>
</tbody>
</table>
<h2><span id="配置-hosts">配置 hosts</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>IP</th>
<th>hostname</th>
</tr>
</thead>
<tbody>
<tr>
<td>172.16.1.64</td>
<td>node1</td>
</tr>
<tr>
<td>172.16.1.65</td>
<td>node2</td>
</tr>
<tr>
<td>172.16.1.66</td>
<td>node3</td>
</tr>
</tbody>
</table>
<h2><span id="修改内核">修改内核</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line"># docker</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br></pre></td></tr></table></figure>
<h2><span id="配置ssh-key-登陆">配置SSH Key 登陆</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 确保本机也可以 ssh 连接，否则下面部署失败</span><br><span class="line"></span><br><span class="line">ssh-keygen -t rsa -N &quot;&quot;</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub 172.16.1.65</span><br><span class="line"></span><br><span class="line">ssh-copy-id -i /root/.ssh/id_rsa.pub 172.16.1.66</span><br></pre></td></tr></table></figure>
<h1><span id="配置-kubespray">配置 kubespray</span></h1>
<h2><span id="安装基础软件">安装基础软件</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 安装 git</span><br><span class="line">yum -y install git</span><br><span class="line"></span><br><span class="line"># 安装 centos 额外的yum源</span><br><span class="line">yum install -y epel-release</span><br><span class="line"></span><br><span class="line"># make 缓存</span><br><span class="line">yum clean all &amp;&amp; yum makecache</span><br><span class="line"></span><br><span class="line"># 安装 软件</span><br><span class="line">yum install -y python-pip python34 python-netaddr python34-pip ansible</span><br></pre></td></tr></table></figure>
<h2><span id="下载源码">下载源码</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># git clone</span><br><span class="line">git clone https://github.com/kubernetes-incubator/kubespray</span><br></pre></td></tr></table></figure>
<h2><span id="下载镜像">下载镜像</span></h2>
<blockquote>
<p>老问题，国外镜像被墙, 我已经上传至 docker 官方的 hub 中, 这里需要自行安装 docker .</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">jicki/hyperkube:v1.8.4_coreos.0</span><br><span class="line">jicki/flannel:v0.9.1</span><br><span class="line">jicki/flannel-cni:v0.3.0</span><br><span class="line">jicki/etcd:v3.2.4</span><br><span class="line">jicki/routereflector:v0.4.0</span><br><span class="line">jicki/cluster-proportional-autoscaler-amd64:1.1.1</span><br><span class="line">jicki/k8s-dns-sidecar-amd64:1.14.7 </span><br><span class="line">jicki/k8s-dns-kube-dns-amd64:1.14.7 </span><br><span class="line">jicki/k8s-dns-dnsmasq-nanny-amd64:1.14.7</span><br><span class="line">jicki/kubernetes-dashboard-init-amd64:v1.0.1</span><br><span class="line">jicki/kubernetes-dashboard-amd64:v1.7.1</span><br><span class="line">jicki/pause-amd64:3.0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">images=(cluster-proportional-autoscaler-amd64:1.1.1 k8s-dns-sidecar-amd64:1.14.7 k8s-dns-kube-dns-amd64:1.14.7 k8s-dns-dnsmasq-nanny-amd64:1.14.7 pause-amd64:3.0 hyperkube:v1.8.4_coreos.0 flannel-cni:v0.3.0 flannel:v0.9.1 etcd:v3.2.4 routereflector:v0.4.0 kubernetes-dashboard-init-amd64:v1.0.1 kubernetes-dashboard-amd64:v1.7.1)</span><br><span class="line">for imageName in $&#123;images[@]&#125; ; do</span><br><span class="line">  docker pull jicki/$imageName</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2><span id="修改配置">修改配置</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">cd kubespray/inventory/group_vars</span><br><span class="line"></span><br><span class="line">vi k8s-cluster.yml</span><br><span class="line"></span><br><span class="line"># k8s-cluster 为控制一些基础信息的配置文件。</span><br><span class="line"></span><br><span class="line"># all.yml 控制一些需要详细配置的信息 </span><br><span class="line"></span><br><span class="line">#  这里打开  kubelet_load_modules: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># API 负载均衡，否在默认都连接到第一台master (坑爹)</span><br><span class="line">loadbalancer_apiserver_localhost: true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改 api 密码</span><br><span class="line"></span><br><span class="line">vi roles/kubespray-defaults/defaults/main.yaml</span><br><span class="line"></span><br><span class="line">kube_api_pwd: xxxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改 flannel 网络的模式 默认是 vxlan 修改为 host-gw</span><br><span class="line"># 注 host-gw 模式 服务器必须 二层互通</span><br><span class="line"></span><br><span class="line">vi roles/network_plugin/flannel/defaults/main.yml</span><br><span class="line"></span><br><span class="line">flannel_backend_type: &quot;vxlan&quot;</span><br><span class="line"></span><br><span class="line">修改</span><br><span class="line"></span><br><span class="line">flannel_backend_type: &quot;host-gw&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 修改 证书过期时间  -days xxxx</span><br><span class="line"></span><br><span class="line">vi /opt/kubespray/roles/kubernetes/secrets/files/make-ssl.sh</span><br><span class="line"></span><br><span class="line">openssl req -x509 -new -nodes -key ca-key.pem -days 10000 -out ca.pem -subj &quot;/CN=kube-ca&quot; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">openssl x509 -req -in $&#123;name&#125;.csr -CA ca.pem -CAkey ca-key.pem -CAcreateserial -out $&#123;name&#125;.pem -days 3650 -extensions v3_req -extfile $&#123;CONFIG&#125; &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 修改所有 images 的地址为个人的仓库地址</span><br><span class="line"></span><br><span class="line">roles/download/defaults/main.yml</span><br><span class="line">roles/dnsmasq/templates/dnsmasq-autoscaler.yml.j2</span><br><span class="line">roles/kubernetes-apps/ansible/defaults/main.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -i &apos;s/gcr\.io\/google_containers/jicki/g&apos; roles/download/defaults/main.yml</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/gcr\.io\/google_containers/jicki/g&apos; roles/dnsmasq/templates/dnsmasq-autoscaler.yml.j2</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/gcr\.io\/google_containers/jicki/g&apos; roles/kubernetes-apps/ansible/defaults/main.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">roles/download/defaults/main.yml</span><br><span class="line">roles/kubernetes-apps/local_volume_provisioner/defaults/main.yml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sed -i &apos;s/quay\.io\/coreos/jicki/g&apos; roles/download/defaults/main.yml</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/quay\.io\/calico/jicki/g&apos; roles/download/defaults/main.yml</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/quay\.io\/external_storage/jicki/g&apos; roles/kubernetes-apps/local_volume_provisioner/defaults/main.yml</span><br></pre></td></tr></table></figure>
<h2><span id="初始化">初始化</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd kubespray</span><br><span class="line"></span><br><span class="line">CONFIG_FILE=inventory/inventory.cfg python3 contrib/inventory_builder/inventory.py 172.16.1.64 172.16.1.65 172.16.1.66</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 初始化以后会生成一个 inventory.cfg 文件，如果SSH 端口不同，需要打开修改</span><br><span class="line"></span><br><span class="line">cd kubespray/inventory</span><br><span class="line"></span><br><span class="line">vi inventory.cfg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[all]</span><br><span class="line">node1    ansible_host=172.16.1.64 ansible_port=33 ip=172.16.1.64</span><br><span class="line">node2    ansible_host=172.16.1.65 ansible_port=33 ip=172.16.1.65</span><br><span class="line">node3    ansible_host=172.16.1.66 ansible_port=33 ip=172.16.1.66</span><br><span class="line"></span><br><span class="line">[kube-master]</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line"></span><br><span class="line">[kube-node]</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">node3</span><br><span class="line"></span><br><span class="line">[etcd]</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">node3</span><br><span class="line"></span><br><span class="line">[k8s-cluster:children]</span><br><span class="line">kube-node</span><br><span class="line">kube-master</span><br><span class="line"></span><br><span class="line">[calico-rr]</span><br><span class="line"></span><br><span class="line">[vault]</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line">node3</span><br></pre></td></tr></table></figure>
<h2><span id="部署集群">部署集群</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i inventory/inventory.cfg cluster.yml -b -v --private-key=~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PLAY RECAP ***************************************************************************************************************************************************************</span><br><span class="line">localhost                  : ok=2    changed=0    unreachable=0    failed=0   </span><br><span class="line">node1                      : ok=289  changed=24   unreachable=0    failed=0   </span><br><span class="line">node2                      : ok=242  changed=13   unreachable=0    failed=0   </span><br><span class="line">node3                      : ok=216  changed=0    unreachable=0    failed=0   </span><br><span class="line"></span><br><span class="line">Friday 08 December 2017  14:52:54 +0800 (0:00:00.039)       0:05:44.482 *******</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 查看 flannel 模式 FLANNEL_MTU = 1450 是 vxlan FLANNEL_MTU = 1500 是 host-gw</span><br><span class="line"></span><br><span class="line">[root@node1 kubespray]# cat /var/run/flannel/subnet.env </span><br><span class="line">FLANNEL_NETWORK=10.233.64.0/18</span><br><span class="line">FLANNEL_SUBNET=10.233.66.1/24</span><br><span class="line">FLANNEL_MTU=1500</span><br><span class="line">FLANNEL_IPMASQ=true</span><br></pre></td></tr></table></figure>
<h2><span id="查看集群">查看集群</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 kubespray]# kubectl get nodes</span><br><span class="line">NAME      STATUS    ROLES         AGE       VERSION</span><br><span class="line">node1     Ready     master,node   6m        v1.8.4+coreos.0</span><br><span class="line">node2     Ready     master,node   6m        v1.8.4+coreos.0</span><br><span class="line">node3     Ready     node          6m        v1.8.4+coreos.0</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 kubespray]# kubectl get pods -n kube-system</span><br><span class="line">NAME                                    READY     STATUS    RESTARTS   AGE</span><br><span class="line">kube-apiserver-node1                    1/1       Running   0          22m</span><br><span class="line">kube-apiserver-node2                    1/1       Running   0          22m</span><br><span class="line">kube-controller-manager-node1           1/1       Running   0          18m</span><br><span class="line">kube-controller-manager-node2           1/1       Running   0          18m</span><br><span class="line">kube-dns-7ff67768b6-mx28d               3/3       Running   0          17m</span><br><span class="line">kube-dns-7ff67768b6-xkjl5               3/3       Running   0          17m</span><br><span class="line">kube-flannel-9fmr4                      2/2       Running   0          17m</span><br><span class="line">kube-flannel-l9w4s                      2/2       Running   0          17m</span><br><span class="line">kube-flannel-vktd9                      2/2       Running   0          17m</span><br><span class="line">kube-proxy-node1                        1/1       Running   0          22m</span><br><span class="line">kube-proxy-node2                        1/1       Running   0          22m</span><br><span class="line">kube-proxy-node3                        1/1       Running   0          22m</span><br><span class="line">kube-scheduler-node1                    1/1       Running   0          18m</span><br><span class="line">kube-scheduler-node2                    1/1       Running   0          18m</span><br><span class="line">kubedns-autoscaler-dcb9b446b-m87sx      1/1       Running   0          17m</span><br><span class="line">kubernetes-dashboard-77c965686c-tq4zw   1/1       Running   0          17m</span><br><span class="line">nginx-proxy-node3                       1/1       Running   0          21m</span><br></pre></td></tr></table></figure>
<h2><span id="测试集群">测试集群</span></h2>
<blockquote>
<p>验证 dns 服务，以及 网络</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个 deployment</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">apiVersion: extensions/v1beta1 </span><br><span class="line">kind: Deployment </span><br><span class="line">metadata: </span><br><span class="line">  name: nginx-dm</span><br><span class="line">spec: </span><br><span class="line">  replicas: 3</span><br><span class="line">  template: </span><br><span class="line">    metadata: </span><br><span class="line">      labels: </span><br><span class="line">        name: nginx </span><br><span class="line">    spec: </span><br><span class="line">      containers: </span><br><span class="line">        - name: nginx </span><br><span class="line">          image: nginx:alpine </span><br><span class="line">          imagePullPolicy: IfNotPresent</span><br><span class="line">          ports: </span><br><span class="line">            - containerPort: 80</span><br><span class="line">            </span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: Service</span><br><span class="line">metadata: </span><br><span class="line">  name: nginx-svc</span><br><span class="line">spec: </span><br><span class="line">  ports: </span><br><span class="line">    - port: 80</span><br><span class="line">      targetPort: 80</span><br><span class="line">      protocol: TCP </span><br><span class="line">  selector: </span><br><span class="line">    name: nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yaml]# kubectl apply -f nginx-deployment.yaml </span><br><span class="line">deployment &quot;nginx-dm&quot; created</span><br><span class="line">service &quot;nginx-svc&quot; created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 yaml]# kubectl get pods -o wide</span><br><span class="line">NAME                        READY     STATUS    RESTARTS   AGE       IP             NODE</span><br><span class="line">nginx-dm-55b58f68b6-7l5qr   1/1       Running   0          27s       10.233.65.3    node2</span><br><span class="line">nginx-dm-55b58f68b6-dkhvl   1/1       Running   0          27s       10.233.64.17   node1</span><br><span class="line">nginx-dm-55b58f68b6-xsvmr   1/1       Running   0          27s       10.233.66.3    node3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 yaml]# kubectl get svc -o wide</span><br><span class="line">NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE       SELECTOR</span><br><span class="line">kubernetes   ClusterIP   10.233.0.1      &lt;none&gt;        443/TCP   30m       &lt;none&gt;</span><br><span class="line">nginx-svc    ClusterIP   10.233.38.166   &lt;none&gt;        80/TCP    1m        name=nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yaml]# curl 10.233.38.166</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个 pods</span><br><span class="line"></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: alpine</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - name: alpine</span><br><span class="line">    image: alpine</span><br><span class="line">    command:</span><br><span class="line">    - sh</span><br><span class="line">    - -c</span><br><span class="line">    - while true; do sleep 1; done</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yaml]# kubectl apply -f alpine-pods.yaml </span><br><span class="line">pod &quot;alpine&quot; created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 yaml]# kubectl get pods</span><br><span class="line">NAME                        READY     STATUS    RESTARTS   AGE</span><br><span class="line">alpine                      1/1       Running   0          19s</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yaml]# kubectl exec -it alpine nslookup nginx-svc</span><br><span class="line">nslookup: can&apos;t resolve &apos;(null)&apos;: Name does not resolve</span><br><span class="line"></span><br><span class="line">Name:      nginx-svc</span><br><span class="line">Address 1: 10.233.38.166 nginx-svc.default.svc.cluster.local</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 yaml]# kubectl exec -it alpine nslookup kubernetes</span><br><span class="line">nslookup: can&apos;t resolve &apos;(null)&apos;: Name does not resolve</span><br><span class="line"></span><br><span class="line">Name:      kubernetes</span><br><span class="line">Address 1: 10.233.0.1 kubernetes.default.svc.cluster.local</span><br></pre></td></tr></table></figure>
<h2><span id="部署-ingress">部署 ingress</span></h2>
<blockquote>
<p>Kubernetes 暴露服务的方式目前只有三种：LoadBlancer Service、NodePort Service、Ingress； 什么是 Ingress ? Ingress 就是利用 Nginx Haproxy 等负载均衡工具来暴露 Kubernetes 服务。<br>
官方 Nginx Ingress github <a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener">https://github.com/kubernetes/ingress-nginx</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 下载镜像</span><br><span class="line"></span><br><span class="line">jicki/nginx-ingress-controller:0.9.0</span><br><span class="line">jicki/defaultbackend:1.4</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 下载 yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/namespace.yaml </span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/default-backend.yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/configmap.yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/tcp-services-configmap.yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/udp-services-configmap.yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/rbac.yaml</span><br><span class="line"></span><br><span class="line">wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/with-rbac.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#  查看下载</span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# ls -lt</span><br><span class="line">总用量 28</span><br><span class="line">-rw-r--r--. 1 root root   89 12月  8 15:36 udp-services-configmap.yaml</span><br><span class="line">-rw-r--r--. 1 root root 1865 12月  8 15:36 with-rbac.yaml</span><br><span class="line">-rw-r--r--. 1 root root   63 12月  8 15:36 namespace.yaml</span><br><span class="line">-rw-r--r--. 1 root root 2385 12月  8 15:36 rbac.yaml</span><br><span class="line">-rw-r--r--. 1 root root   89 12月  8 15:36 tcp-services-configmap.yaml</span><br><span class="line">-rw-r--r--. 1 root root  129 12月  8 15:36 configmap.yaml</span><br><span class="line">-rw-r--r--. 1 root root 1131 12月  8 15:36 default-backend.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改 镜像下载地址</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/gcr\.io\/google_containers/jicki/g&apos; *</span><br><span class="line">sed -i &apos;s/quay\.io\/kubernetes-ingress-controller/jicki/g&apos; *</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 为 node2  node3 打上相同的 label</span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# kubectl label nodes node2 ingress=nginx </span><br><span class="line">node &quot;node2&quot; labeled</span><br><span class="line">[root@node1 nginx-ingress]# kubectl label nodes node3 ingress=nginx</span><br><span class="line">node &quot;node3&quot; labeled</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 删除 label</span><br><span class="line"></span><br><span class="line">kubectl label node node2 ingress-</span><br><span class="line"></span><br><span class="line">kubectl label node node3 ingress-</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看 label</span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# kubectl get nodes --show-labels</span><br><span class="line">NAME      STATUS    ROLES         AGE       VERSION           LABELS</span><br><span class="line">node1     Ready     master,node   1h        v1.8.4+coreos.0   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/hostname=node1,node-role.kubernetes.io/master=true,node-role.kubernetes.io/node=true</span><br><span class="line">node2     Ready     master,node   1h        v1.8.4+coreos.0   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,ingress=proxy,kubernetes.io/hostname=node2,node-role.kubernetes.io/master=true,node-role.kubernetes.io/node=true</span><br><span class="line">node3     Ready     node          59m       v1.8.4+coreos.0   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,ingress=proxy,kubernetes.io/hostname=node3,node-role.kubernetes.io/node=true</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 修改相关配置</span><br><span class="line"></span><br><span class="line">vi with-rbac.yaml</span><br><span class="line"></span><br><span class="line"># 这里配置 replicas: 2 , 上面配置了2个 labels</span><br><span class="line"># 修改 yaml 文件 增加 hostNetwork   和 nodeSelector, 第二个 spec 下 增加。</span><br><span class="line"></span><br><span class="line">    spec:</span><br><span class="line">      hostNetwork: true</span><br><span class="line">      serviceAccountName: nginx-ingress-serviceaccount</span><br><span class="line">      nodeSelector:</span><br><span class="line">        ingress: nginx</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 导入 yaml</span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# kubectl apply -f namespace.yaml </span><br><span class="line">namespace &quot;ingress-nginx&quot; created</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# kubectl apply -f .</span><br><span class="line">serviceaccount &quot;nginx-ingress-serviceaccount&quot; created</span><br><span class="line">clusterrole &quot;nginx-ingress-clusterrole&quot; created</span><br><span class="line">role &quot;nginx-ingress-role&quot; created</span><br><span class="line">rolebinding &quot;nginx-ingress-role-nisa-binding&quot; created</span><br><span class="line">clusterrolebinding &quot;nginx-ingress-clusterrole-nisa-binding&quot; created</span><br><span class="line">configmap &quot;tcp-services&quot; created</span><br><span class="line">configmap &quot;udp-services&quot; created</span><br><span class="line">deployment &quot;nginx-ingress-controller&quot; created</span><br><span class="line">configmap &quot;nginx-configuration&quot; created</span><br><span class="line">deployment &quot;default-http-backend&quot; created</span><br><span class="line">service &quot;default-http-backend&quot; created</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#  查看服务</span><br><span class="line"></span><br><span class="line">[root@node1 nginx-ingress]# kubectl get pods -n ingress-nginx</span><br><span class="line">NAME                                       READY     STATUS    RESTARTS   AGE</span><br><span class="line">default-http-backend-7f47b7d69b-wdj5j      1/1       Running   0          11s</span><br><span class="line">nginx-ingress-controller-c646dfddc-6cw29   1/1       Running   0          11s</span><br><span class="line">nginx-ingress-controller-c646dfddc-g9krl   1/1       Running   0          11s</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 编写 ingress yaml</span><br><span class="line"></span><br><span class="line">apiVersion: extensions/v1beta1</span><br><span class="line">kind: Ingress</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-ingress</span><br><span class="line">spec:</span><br><span class="line">  rules:</span><br><span class="line">  - host: nginx.jicki.me</span><br><span class="line">    http:</span><br><span class="line">      paths:</span><br><span class="line">      - backend:</span><br><span class="line">          serviceName: nginx-svc</span><br><span class="line">          servicePort: 80</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看服务</span><br><span class="line"></span><br><span class="line">[root@node1 yaml]# kubectl get ingress</span><br><span class="line">NAME            HOSTS            ADDRESS   PORTS     AGE</span><br><span class="line">nginx-ingress   nginx.jicki.me             80        1m</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 yaml]# curl nginx.jicki.me</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h1><span id="faq-报错">FAQ 报错</span></h1>
<h2><span id="equalto-错误">equalto 错误</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 升级 Jinja2</span><br><span class="line"></span><br><span class="line">pip install --upgrade Jinja2</span><br></pre></td></tr></table></figure>
<h2><span id="stop-if-swap-enabled">Stop if swap enabled</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"># 报如下错误:</span><br><span class="line"></span><br><span class="line">TASK [kubernetes/preinstall : Stop if swap enabled] **********************************************************************************************************************</span><br><span class="line">Wednesday 06 December 2017  15:40:29 +0800 (0:00:00.064)       0:00:10.135 **** </span><br><span class="line">fatal: [node1]: FAILED! =&gt; &#123;</span><br><span class="line">    &quot;assertion&quot;: &quot;ansible_swaptotal_mb == 0&quot;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;evaluated_to&quot;: false, </span><br><span class="line">    &quot;failed&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">fatal: [node2]: FAILED! =&gt; &#123;</span><br><span class="line">    &quot;assertion&quot;: &quot;ansible_swaptotal_mb == 0&quot;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;evaluated_to&quot;: false, </span><br><span class="line">▽   &quot;failed&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">fatal: [node3]: FAILED! =&gt; &#123;</span><br><span class="line">    &quot;assertion&quot;: &quot;ansible_swaptotal_mb == 0&quot;, </span><br><span class="line">    &quot;changed&quot;: false, </span><br><span class="line">    &quot;evaluated_to&quot;: false, </span><br><span class="line">    &quot;failed&quot;: true</span><br><span class="line">&#125;</span><br><span class="line">        to retry, use: --limit @/opt/kubespray/cluster.retry</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 解决方法</span><br><span class="line"></span><br><span class="line"># 在配置服务器上执行</span><br><span class="line"></span><br><span class="line">cd /tmp</span><br><span class="line"></span><br><span class="line">rm -rf node*</span><br><span class="line"></span><br><span class="line"># 在每台服务器上执行</span><br><span class="line"></span><br><span class="line">swapoff -a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 永久关闭 swap</span><br><span class="line"></span><br><span class="line">修改 /etc/fstab  里面 swap 的相关 mount</span><br></pre></td></tr></table></figure>
<h2><span id="清理集群">清理集群</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ansible-playbook -i inventory/inventory.cfg reset.yml -b -v --private-key=~/.ssh/id_rsa</span><br><span class="line"></span><br><span class="line">rm -rf /etc/kubernetes/</span><br><span class="line">rm -rf /var/lib/kubelet</span><br><span class="line">rm -rf /var/lib/etcd</span><br><span class="line">rm -rf /var/lib/cni</span><br><span class="line">rm -rf /usr/local/bin/kubectl</span><br><span class="line">rm -rf /opt/cni</span><br><span class="line">rm -rf /var/log/containers/</span><br><span class="line">rm -rf /etc/systemd/system/calico-node.service</span><br><span class="line">rm -rf /etc/systemd/system/kubelet.service</span><br><span class="line">rm -rf /tmp/node*</span><br><span class="line">rm -rf /usr/libexec/kubernetes</span><br><span class="line">systemctl stop etcd.service</span><br><span class="line">systemctl disable etcd.service</span><br><span class="line">systemctl stop calico-node.service</span><br><span class="line">systemctl disable calico-node.service</span><br><span class="line">systemctl stop docker</span><br><span class="line">rm -rf /opt/docker</span><br><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/01/30/2018-01-09-openshift-3.7.0/" data-toggle="tooltip" data-placement="top" title="openshift origin 3.7">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/01/30/2017-12-20-kubernetes-1.9-ipvs/" data-toggle="tooltip" data-placement="top" title="kubernetes 1.9.0 ipvs coreDNS">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share" data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">kubernetes 1.8.4 to kubespray</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">环境准备</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">初始化环境</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">设置hostname</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">配置 hosts</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">修改内核</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">配置SSH Key 登陆</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">配置 kubespray</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">安装基础软件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">下载源码</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">下载镜像</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">修改配置</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.5.</span> <span class="toc-nav-text">初始化</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.6.</span> <span class="toc-nav-text">部署集群</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.7.</span> <span class="toc-nav-text">查看集群</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.8.</span> <span class="toc-nav-text">测试集群</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.9.</span> <span class="toc-nav-text">部署 ingress</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">FAQ 报错</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">equalto 错误</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">Stop if swap enabled</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">清理集群</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://www.jicki.me" target="_blank">小炒肉</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "jicki";
    var disqus_identifier = "https://www.jicki.me/2019/01/30/2017-12-08-kubernetes-kubespray-1.8.4/";
    var disqus_url = "https://www.jicki.me/2019/01/30/2017-12-08-kubernetes-kubespray-1.8.4/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/jicki234">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/jicki520">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 小炒肉 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.jicki.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-85602329-1';
    var _gaDomain = 'jicki.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '1b38b88e4559c6725330b8c3328e2de3';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.jicki.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
