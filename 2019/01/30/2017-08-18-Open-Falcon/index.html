<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Your future depends on your dreams">
    <meta name="keyword" content="小炒肉, 运维工程师, Jicki, DevOps, Docker, Kubernetes">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          Open-Falcon 监控 - 小炒肉 | Blog
        
    </title>

    <link rel="canonical" href="https://www.jicki.me/2019/01/30/2017-08-18-Open-Falcon/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('img/pexels/triangular.jpeg')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>Open-Falcon 监控</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 小炒肉 on
                            2019-01-30
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">小炒肉</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="环境准备">环境准备</span></h1>
<blockquote>
<p>官方文档 <a href="https://book.open-falcon.org/zh_0_2" target="_blank" rel="noopener">https://book.open-falcon.org/zh_0_2</a></p>
</blockquote>
<h2><span id="安装-golang">安装 golang</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">wget https://storage.googleapis.com/golang/go1.6.4.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf go1.6.4.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line">mv go /opt/local/</span><br><span class="line"></span><br><span class="line"># 增加环境变量</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Golang ENV</span><br><span class="line">export GOROOT=/opt/local/go</span><br><span class="line">export PATH=$PATH:$GOROOT/bin</span><br><span class="line">export GOPATH=/opt/local/golang</span><br><span class="line"></span><br><span class="line">go version</span><br><span class="line">go version go1.6.4 linux/amd64</span><br></pre></td></tr></table></figure>
<h2><span id="安装-mysql-57">安装 Mysql 5.7</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line"># 初始化依赖</span><br><span class="line"></span><br><span class="line">yum -y install cmake ncurses ncurses-devel bison bison-devel boost boost-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建 mysql 用户以及相关目录</span><br><span class="line"></span><br><span class="line">/usr/sbin/groupadd mysql</span><br><span class="line">/usr/sbin/useradd -g mysql mysql</span><br><span class="line">mkdir -p /opt/local/mysql/data</span><br><span class="line">mkdir -p /opt/local/mysql/binlog</span><br><span class="line">mkdir -p  /opt/local/mysql/logs</span><br><span class="line">mkdir -p /opt/local/mysql/relaylog</span><br><span class="line">mkdir -p /var/lib/mysql</span><br><span class="line">mkdir -p /opt/local/mysql/etc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 下载 源码包</span><br><span class="line"></span><br><span class="line">wget ftp://ftp.mirrorservice.org/sites/ftp.mysql.com/Downloads/MySQL-5.7/mysql-5.7.19.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf mysql-5.7.19.tar.gz</span><br><span class="line"></span><br><span class="line">cd mysql-5.7.19</span><br><span class="line"></span><br><span class="line">cmake -DCMAKE_INSTALL_PREFIX=&quot;/opt/local/mysql&quot; -DDEFAULT_CHARSET=utf8 \</span><br><span class="line">-DMYSQL_DATADIR=&quot;/opt/local/mysql/data/&quot; -DCMAKE_INSTALL_PREFIX=&quot;/opt/local/mysql&quot; \</span><br><span class="line">-DINSTALL_PLUGINDIR=plugin -DWITH_INNOBASE_STORAGE_ENGINE=1 -DDEFAULT_COLLATION=utf8_general_ci \</span><br><span class="line">-DENABLED_LOCAL_INFILE=1 -DENABLED_PROFILING=1 -DWITH_ZLIB=system \</span><br><span class="line">-DWITH_EXTRA_CHARSETS=none -DMYSQL_MAINTAINER_MODE=OFF -DEXTRA_CHARSETS=all \</span><br><span class="line">-DWITH_PERFSCHEMA_STORAGE_ENGINE=1 -DWITH_MYISAM_STORAGE_ENGINE=1 \</span><br><span class="line">-DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">make -j `cat /proc/cpuinfo | grep processor| wc -l`</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建相关目录，授权</span><br><span class="line"></span><br><span class="line">chmod +w /opt/local/mysql</span><br><span class="line">chown -R mysql:mysql /opt/local/mysql</span><br><span class="line">chmod +w /var/lib/mysql</span><br><span class="line">chown -R mysql:mysql /var/lib/mysql</span><br><span class="line">cp /opt/local/mysql/support-files/mysql.server  /etc/init.d/mysqld</span><br><span class="line">chmod 755 /etc/init.d/mysqld</span><br><span class="line">echo &apos;basedir=/opt/local/mysql/&apos; &gt;&gt; /etc/init.d/mysqld</span><br><span class="line">echo &apos;datadir=/opt/local/mysql/data&apos; &gt;&gt;/etc/init.d/mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建关联</span><br><span class="line"></span><br><span class="line">ln -s /opt/local/mysql/lib/mysql /usr/lib/mysql</span><br><span class="line">ln -s /opt/local/mysql/include/mysql /usr/include/mysql</span><br><span class="line">ln -s /opt/local/mysql/bin/mysql /usr/bin/mysql</span><br><span class="line">ln -s /opt/local/mysql/bin/mysqldump /usr/bin/mysqldump</span><br><span class="line">ln -s /opt/local/mysql/bin/myisamchk /usr/bin/myisamchk</span><br><span class="line">ln -s /opt/local/mysql/bin/mysqld_safe /usr/bin/mysqld_safe</span><br><span class="line">ln -s /tmp/mysql.sock /var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 初始化数据库</span><br><span class="line"></span><br><span class="line">vi /opt/local/mysql/etc/my.cnf</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8mb4</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">########basic settings########</span><br><span class="line">server-id = 1</span><br><span class="line">port = 3306</span><br><span class="line">user = mysql</span><br><span class="line">bind_address = 127.0.0.1</span><br><span class="line">autocommit = 1</span><br><span class="line">character_set_server=utf8mb4</span><br><span class="line">collation-server=utf8mb4_unicode_ci</span><br><span class="line">skip-character-set-client-handshake</span><br><span class="line">init_connect=&apos;SET collation_connection = utf8mb4_unicode_ci&apos;</span><br><span class="line">init_connect=&apos;SET NAMES utf8mb4&apos;</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">max_connections = 800</span><br><span class="line">max_connect_errors = 1000</span><br><span class="line">datadir = /opt/local/mysql/data</span><br><span class="line">pid-file = /opt/local/mysql/mysql.pid</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line">explicit_defaults_for_timestamp = 1</span><br><span class="line">join_buffer_size = 134217728</span><br><span class="line">tmp_table_size = 67108864</span><br><span class="line">tmpdir = /tmp</span><br><span class="line">max_allowed_packet = 16777216</span><br><span class="line">sql_mode = &quot;STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER&quot;</span><br><span class="line">interactive_timeout = 1800</span><br><span class="line">wait_timeout = 1800</span><br><span class="line">read_buffer_size = 16777216</span><br><span class="line">read_rnd_buffer_size = 33554432</span><br><span class="line">sort_buffer_size = 33554432</span><br><span class="line">########log settings########</span><br><span class="line">log_error = /opt/local/mysql/logs/mysqld.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = /opt/local/mysql/logs/slow.log</span><br><span class="line">log_queries_not_using_indexes = 1</span><br><span class="line">log_slow_admin_statements = 1</span><br><span class="line">log_slow_slave_statements = 1</span><br><span class="line">log_throttle_queries_not_using_indexes = 10</span><br><span class="line">expire_logs_days = 90</span><br><span class="line">long_query_time = 2</span><br><span class="line">min_examined_row_limit = 100</span><br><span class="line">########replication settings########</span><br><span class="line">master_info_repository = TABLE</span><br><span class="line">relay_log_info_repository = TABLE</span><br><span class="line">log_bin = /opt/local/mysql/binlog/mysql-bin</span><br><span class="line">sync_binlog = 1</span><br><span class="line">gtid_mode = on</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line">log_slave_updates</span><br><span class="line">binlog_format = row</span><br><span class="line">relay_log = /opt/local/mysql/relaylog/relay-bin</span><br><span class="line">relay_log_recovery = 1</span><br><span class="line">binlog_gtid_simple_recovery = 1</span><br><span class="line">slave_skip_errors = ddl_exist_errors</span><br><span class="line">########innodb settings########</span><br><span class="line">innodb_page_size = 16384</span><br><span class="line">innodb_buffer_pool_size = 8G</span><br><span class="line">innodb_buffer_pool_instances = 8</span><br><span class="line">innodb_buffer_pool_load_at_startup = 1</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown = 1</span><br><span class="line">innodb_lru_scan_depth = 2000</span><br><span class="line">innodb_lock_wait_timeout = 5</span><br><span class="line">innodb_io_capacity = 4000</span><br><span class="line">innodb_io_capacity_max = 8000</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_file_format = Barracuda</span><br><span class="line">innodb_file_format_max = Barracuda</span><br><span class="line">innodb_log_group_home_dir = /opt/local/mysql/relaylog</span><br><span class="line">innodb_undo_directory = /opt/local/mysql/binlog</span><br><span class="line">innodb_undo_logs = 128</span><br><span class="line">innodb_undo_tablespaces = 3</span><br><span class="line">innodb_flush_neighbors = 1</span><br><span class="line">innodb_log_file_size = 4G</span><br><span class="line">innodb_log_buffer_size = 16777216</span><br><span class="line">innodb_purge_threads = 4</span><br><span class="line">innodb_large_prefix = 1</span><br><span class="line">innodb_thread_concurrency = 64</span><br><span class="line">innodb_print_all_deadlocks = 1</span><br><span class="line">innodb_strict_mode = 1</span><br><span class="line">innodb_sort_buffer_size = 67108864</span><br><span class="line">############mysql 5.7 ##################</span><br><span class="line">innodb_buffer_pool_dump_pct = 40</span><br><span class="line">innodb_page_cleaners = 4</span><br><span class="line">innodb_undo_log_truncate = 1</span><br><span class="line">innodb_max_undo_log_size = 2G</span><br><span class="line">innodb_purge_rseg_truncate_frequency = 128</span><br><span class="line">binlog_gtid_simple_recovery=1</span><br><span class="line">log_timestamps=system</span><br><span class="line">transaction_write_set_extraction=MURMUR32</span><br><span class="line">show_compatibility_56=on</span><br><span class="line">########semi sync replication settings########</span><br><span class="line">#plugin_dir=/opt/local/mysql/lib/plugin</span><br><span class="line">#plugin_load = &quot;rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so&quot;</span><br><span class="line">#loose_rpl_semi_sync_master_enabled = 1</span><br><span class="line">#loose_rpl_semi_sync_slave_enabled = 1</span><br><span class="line">#loose_rpl_semi_sync_master_timeout = 5000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rm -rf /etc/my.cnf</span><br><span class="line"></span><br><span class="line">cd /opt/local/mysql/bin/</span><br><span class="line"></span><br><span class="line">/opt/local/mysql/bin/mysqld --initialize --user=mysql --basedir=/opt/local/mysql --datadir=/opt/local/mysql/data</span><br><span class="line"></span><br><span class="line"># 查看 mysql 密码</span><br><span class="line"></span><br><span class="line">cat /opt/local/mysql/logs/mysqld.log |grep password</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动 mysql</span><br><span class="line"></span><br><span class="line">service mysqld start</span><br><span class="line"></span><br><span class="line">chkconfig mysqld on</span><br><span class="line"></span><br><span class="line"># 设置安全配置</span><br><span class="line"></span><br><span class="line">/opt/local/mysql/bin/mysql_secure_installation -uroot -p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 登陆 mysql</span><br><span class="line"></span><br><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>
<h2><span id="安装-redis">安装 redis</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"># 下载 redis</span><br><span class="line"></span><br><span class="line">wget http://download.redis.io/releases/redis-3.2.10.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf redis-3.2.10.tar.gz </span><br><span class="line"></span><br><span class="line">cd redis-3.2.10</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">cd  utils</span><br><span class="line"></span><br><span class="line">./install_server.sh</span><br><span class="line"></span><br><span class="line">...... 输入相关信息 ......</span><br><span class="line"></span><br><span class="line">cd /etc/init.d/</span><br><span class="line"></span><br><span class="line">mv redis_6379  redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建 目录</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/local/redis/&#123;data,logs,conf&#125;</span><br><span class="line"></span><br><span class="line">cd /opt/local/redis/conf</span><br><span class="line"></span><br><span class="line">vi redis.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bind 127.0.0.1</span><br><span class="line">protected-mode yes</span><br><span class="line">port 6379</span><br><span class="line">tcp-backlog 2048</span><br><span class="line">timeout 0</span><br><span class="line">tcp-keepalive 300</span><br><span class="line">daemonize yes</span><br><span class="line">supervised no</span><br><span class="line">pidfile /var/run/redis.pid</span><br><span class="line">loglevel notice</span><br><span class="line">logfile &quot;/opt/local/redis/logs/redis.log&quot;</span><br><span class="line">maxmemory 10gb</span><br><span class="line">databases 16</span><br><span class="line">save 900 1</span><br><span class="line">save 300 10</span><br><span class="line">save 60 10000</span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line">dbfilename redis_dump.rdb</span><br><span class="line">dir /opt/local/redis/data</span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line">slave-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay 5</span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">slave-priority 100</span><br><span class="line">appendonly no</span><br><span class="line">appendfilename &quot;appendonly.aof&quot;</span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">lua-time-limit 5000</span><br><span class="line">slowlog-log-slower-than 10000</span><br><span class="line">slowlog-max-len 128</span><br><span class="line">latency-monitor-threshold 0</span><br><span class="line">notify-keyspace-events &quot;&quot;</span><br><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br><span class="line">list-max-ziplist-size -2</span><br><span class="line">list-compress-depth 0</span><br><span class="line">set-max-intset-entries 512</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">hll-sparse-max-bytes 3000</span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal 0 0 0</span><br><span class="line">client-output-buffer-limit slave 256mb 64mb 60</span><br><span class="line">client-output-buffer-limit pubsub 32mb 8mb 60</span><br><span class="line">hz 10</span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动 redis</span><br><span class="line"></span><br><span class="line">chkconfig redis on</span><br><span class="line"></span><br><span class="line">service redis start</span><br></pre></td></tr></table></figure>
<h1><span id="配置-open-falcon">配置 Open-Falcon</span></h1>
<h2><span id="初始化环境">初始化环境</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $GOPATH/src/github.com/open-falcon</span><br><span class="line">cd $GOPATH/src/github.com/open-falcon</span><br><span class="line">git clone https://github.com/open-falcon/falcon-plus.git</span><br></pre></td></tr></table></figure>
<h2><span id="导入数据库">导入数据库</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/open-falcon/falcon-plus/scripts/mysql/db_schema/</span><br><span class="line">mysql -u root -p &lt; 1_uic-db-schema.sql</span><br><span class="line">mysql -u root -p &lt; 2_portal-db-schema.sql</span><br><span class="line">mysql -u root -p &lt; 3_dashboard-db-schema.sql</span><br><span class="line">mysql -u root -p &lt; 4_graph-db-schema.sql</span><br><span class="line">mysql -u root -p &lt; 5_alarms-db-schema.sql</span><br></pre></td></tr></table></figure>
<h2><span id="编译-程序">编译 程序</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cd $GOPATH/src/github.com/open-falcon/falcon-plus/</span><br><span class="line"></span><br><span class="line"># 编译所有的模块</span><br><span class="line">make all</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 编译指定模块</span><br><span class="line">make agent</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 打包</span><br><span class="line">make pack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建目录</span><br><span class="line"></span><br><span class="line">mkdir /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">mv open-falcon-v0.2.1.tar.gz /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">cd /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">tar zxvf open-falcon-v0.2.1.tar.gz </span><br><span class="line"></span><br><span class="line">[root@localhost open-falcon]# ls</span><br><span class="line">agent  aggregator  alarm  api  gateway  graph  hbs  judge  nodata  open-falcon  plugins  public  transfer</span><br></pre></td></tr></table></figure>
<h2><span id="配置-transfer">配置 Transfer</span></h2>
<blockquote>
<p>transfer是数据转发服务。它接收agent上报的数据，然后按照哈希规则进行数据分片、并将分片后的数据分别push给graph&amp;judge等组件。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/transfer/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;minStep&quot;: 30,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6060&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rpc&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:8433&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;socket&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:4444&quot;,</span><br><span class="line">        &quot;timeout&quot;: 3600</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;judge&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;batch&quot;: 200,</span><br><span class="line">        &quot;connTimeout&quot;: 1000,</span><br><span class="line">        &quot;callTimeout&quot;: 5000,</span><br><span class="line">        &quot;maxConns&quot;: 32,</span><br><span class="line">        &quot;maxIdle&quot;: 32,</span><br><span class="line">        &quot;replicas&quot;: 500,</span><br><span class="line">        &quot;cluster&quot;: &#123;</span><br><span class="line">            &quot;judge-00&quot; : &quot;127.0.0.1:6080&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;graph&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;batch&quot;: 200,</span><br><span class="line">        &quot;connTimeout&quot;: 1000,</span><br><span class="line">        &quot;callTimeout&quot;: 5000,</span><br><span class="line">        &quot;maxConns&quot;: 32,</span><br><span class="line">        &quot;maxIdle&quot;: 32,</span><br><span class="line">        &quot;replicas&quot;: 500,</span><br><span class="line">        &quot;cluster&quot;: &#123;</span><br><span class="line">            &quot;graph-00&quot; : &quot;127.0.0.1:6070&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;tsdb&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;batch&quot;: 200,</span><br><span class="line">        &quot;connTimeout&quot;: 1000,</span><br><span class="line">        &quot;callTimeout&quot;: 5000,</span><br><span class="line">        &quot;maxConns&quot;: 32,</span><br><span class="line">        &quot;maxIdle&quot;: 32,</span><br><span class="line">        &quot;retry&quot;: 3,</span><br><span class="line">        &quot;address&quot;: &quot;127.0.0.1:8088&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="配置-graph">配置 Graph</span></h2>
<blockquote>
<p>graph是存储绘图数据的组件。graph组件 接收transfer组件推送上来的监控数据，同时处理api组件的查询请求、返回绘图数据。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 创建数据 目录</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/data/6070</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /opt/local/open-falcon/graph/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: false,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6071&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rpc&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6070&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rrd&quot;: &#123;</span><br><span class="line">        &quot;storage&quot;: &quot;/opt/data/6070&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;db&quot;: &#123;</span><br><span class="line">        &quot;dsn&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/graph?loc=Local&amp;parseTime=true&quot;,</span><br><span class="line">        &quot;maxIdle&quot;: 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;callTimeout&quot;: 5000,</span><br><span class="line">    &quot;migrate&quot;: &#123;</span><br><span class="line">            &quot;enabled&quot;: false,</span><br><span class="line">            &quot;concurrency&quot;: 2,</span><br><span class="line">            &quot;replicas&quot;: 500,</span><br><span class="line">            &quot;cluster&quot;: &#123;</span><br><span class="line">                    &quot;graph-00&quot; : &quot;127.0.0.1:6070&quot;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="配置-api-组件">配置 Api 组件</span></h2>
<blockquote>
<p>api组件，提供统一的restAPI操作接口。比如：api组件接收查询请求，根据一致性哈希算法去相应的graph实例查询不同metric的数据，然后汇总拿到的数据，最后统一返回给用户。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/api/config</span><br><span class="line"></span><br><span class="line">vi cfg.json </span><br><span class="line"># 主要修改 &quot;salt&quot;: &quot;&quot; 为加密字串</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">        &quot;log_level&quot;: &quot;debug&quot;,</span><br><span class="line">        &quot;db&quot;: &#123;</span><br><span class="line">                &quot;falcon_portal&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/falcon_portal?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">                &quot;graph&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/graph?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">                &quot;uic&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/uic?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">                &quot;dashboard&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/dashboard?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">                &quot;alarms&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/alarms?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;,</span><br><span class="line">                &quot;db_bug&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;graphs&quot;: &#123;</span><br><span class="line">                &quot;cluster&quot;: &#123;</span><br><span class="line">                        &quot;graph-00&quot;: &quot;127.0.0.1:6070&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;max_conns&quot;: 100,</span><br><span class="line">                &quot;max_idle&quot;: 100,</span><br><span class="line">                &quot;conn_timeout&quot;: 1000,</span><br><span class="line">                &quot;call_timeout&quot;: 5000,</span><br><span class="line">                &quot;numberOfReplicas&quot;: 500</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;metric_list_file&quot;: &quot;./api/data/metric&quot;,</span><br><span class="line">        &quot;web_port&quot;: &quot;0.0.0.0:8080&quot;,</span><br><span class="line">        &quot;access_control&quot;: true,</span><br><span class="line">        &quot;signup_disable&quot;: false,</span><br><span class="line">        &quot;salt&quot;: &quot;pleaseinputwhichyouareusingnow&quot;,</span><br><span class="line">        &quot;skip_auth&quot;: false,</span><br><span class="line">        &quot;default_token&quot;: &quot;default-token-used-in-server-side&quot;,</span><br><span class="line">        &quot;gen_doc&quot;: false,</span><br><span class="line">        &quot;gen_doc_path&quot;: &quot;doc/module.html&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="部署-heartbeat-服务">部署 Heartbeat 服务</span></h2>
<blockquote>
<p>心跳服务器，所有agent都会连到HBS，每分钟发一次心跳请求。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/hbs/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;database&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&quot;,</span><br><span class="line">    &quot;hosts&quot;: &quot;&quot;,</span><br><span class="line">    &quot;maxConns&quot;: 20,</span><br><span class="line">    &quot;maxIdle&quot;: 15,</span><br><span class="line">    &quot;listen&quot;: &quot;:6030&quot;,</span><br><span class="line">    &quot;trustable&quot;: [&quot;&quot;],</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6031&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="部署-judge-服务">部署 Judge 服务</span></h2>
<blockquote>
<p>Judge用于告警判断，agent将数据push给Transfer，Transfer不但会转发给Graph组件来绘图，还会转发给Judge用于判断是否触发告警。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/judge/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;debugHost&quot;: &quot;nil&quot;,</span><br><span class="line">    &quot;remain&quot;: 11,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6081&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;rpc&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6080&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;hbs&quot;: &#123;</span><br><span class="line">        &quot;servers&quot;: [&quot;127.0.0.1:6030&quot;],</span><br><span class="line">        &quot;timeout&quot;: 300,</span><br><span class="line">        &quot;interval&quot;: 60</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;alarm&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;minInterval&quot;: 300,</span><br><span class="line">        &quot;queuePattern&quot;: &quot;event:p%v&quot;,</span><br><span class="line">        &quot;redis&quot;: &#123;</span><br><span class="line">            &quot;dsn&quot;: &quot;127.0.0.1:6379&quot;,</span><br><span class="line">            &quot;maxIdle&quot;: 5,</span><br><span class="line">            &quot;connTimeout&quot;: 5000,</span><br><span class="line">            &quot;readTimeout&quot;: 5000,</span><br><span class="line">            &quot;writeTimeout&quot;: 5000</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="部署一个-mail-服务">部署一个 mail 服务</span></h2>
<blockquote>
<p>发送警告邮件需要部署一个 mail 服务  用于发送邮件, 这里边部署一个简单的<br>
mail-provider 地址 <a href="https://github.com/zzlyzq/mail-provider" target="_blank" rel="noopener">https://github.com/zzlyzq/mail-provider</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># 下载 依赖模块</span><br><span class="line"></span><br><span class="line">cd /opt/local/golang/src/github.com/open-falcon</span><br><span class="line"></span><br><span class="line">git clone https://github.com/zzlyzq/mail-provider</span><br><span class="line"></span><br><span class="line">cd /opt/local/golang/src/github.com/open-falcon/mail-provider</span><br><span class="line"></span><br><span class="line"># 下载依赖</span><br><span class="line">go get </span><br><span class="line"></span><br><span class="line">./control build (编译)</span><br><span class="line"></span><br><span class="line">./control pack (打包)</span><br><span class="line"></span><br><span class="line">mkdir /opt/local/open-falcon/mail-provider</span><br><span class="line"></span><br><span class="line">mv falcon-mail-provider-0.0.1.tar.gz /opt/local/open-falcon/mail-provider</span><br><span class="line"></span><br><span class="line">cd /opt/local/open-falcon/mail-provider</span><br><span class="line"></span><br><span class="line">tar zxvf falcon-mail-provider-0.0.1.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改配置文件 里的 smtp 为自己的地址</span><br><span class="line"># QQ邮箱，请开启 smtp 的功能，在QQ邮箱后台开启</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:4000&quot;,</span><br><span class="line">        &quot;token&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;smtp&quot;: &#123;</span><br><span class="line">        &quot;addr&quot;: &quot;smtp.qq.com:587&quot;,</span><br><span class="line">        &quot;username&quot;: &quot;jicki@qq.com&quot;,</span><br><span class="line">        &quot;password&quot;: &quot;123456&quot;,</span><br><span class="line">        &quot;from&quot;: &quot;jicki@qq.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 运行程序</span><br><span class="line"></span><br><span class="line">./control start</span><br><span class="line"></span><br><span class="line"># 查看日志</span><br><span class="line">./control tail</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 测试, 在测试时 token 暂时设置为空</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl http://127.0.0.1:4000/sender/mail -d &quot;tos=jicki@qq.com&amp;subject=xx&amp;content=yy&quot;</span><br></pre></td></tr></table></figure>
<h2><span id="部署一个-微信网关">部署一个 微信网关</span></h2>
<blockquote>
<p>微信网关 git  <a href="https://github.com/Yanjunhui/chat" target="_blank" rel="noopener">https://github.com/Yanjunhui/chat</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">git clone https://github.com/Yanjunhui/chat</span><br><span class="line"></span><br><span class="line">cd chat/</span><br><span class="line"></span><br><span class="line">chmod +x control.sh</span><br><span class="line"></span><br><span class="line"># 需要修改 配置文件</span><br><span class="line"></span><br><span class="line">cat config.conf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#http 服务端口</span><br><span class="line">[http]</span><br><span class="line">port = 4567</span><br><span class="line"></span><br><span class="line">#微信接口信息</span><br><span class="line">[weixin]</span><br><span class="line">CorpID = ww6424d33203e90e20</span><br><span class="line">AgentId = 1000002</span><br><span class="line">Secret = FoST_8RQSTjZwH_CN3aQW6UKksjCSI9mizFqD7HKhrw</span><br><span class="line">EncodingAESKey = K2M3WMhRHIOH4I1Ww5jxpllGrgY01nvBjUgTvcJEEHX</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动</span><br><span class="line">./control.sh start</span><br><span class="line">./control.sh status</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 注意: </span><br><span class="line"></span><br><span class="line">要收到 im 报警信息，必须要在 个人用户里面 填写 微信相关资料</span><br><span class="line"></span><br><span class="line">微信相关帐号是  登陆微信公众号 --&gt; 通讯里， 里面用户的 帐号</span><br><span class="line"></span><br><span class="line">不是个人微信帐号，填写个人帐号，是收不到报警的。</span><br></pre></td></tr></table></figure>
<h2><span id="部署-alarm-服务">部署 Alarm 服务</span></h2>
<blockquote>
<p>alarm模块是处理报警event的，judge产生的报警event写入redis，alarm从redis读取处理，并进行不同渠道的发送。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/alarm/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;log_level&quot;: &quot;debug&quot;,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:9912&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;redis&quot;: &#123;</span><br><span class="line">        &quot;addr&quot;: &quot;127.0.0.1:6379&quot;,</span><br><span class="line">        &quot;maxIdle&quot;: 5,</span><br><span class="line">        &quot;highQueues&quot;: [</span><br><span class="line">            &quot;event:p0&quot;,</span><br><span class="line">            &quot;event:p1&quot;,</span><br><span class="line">            &quot;event:p2&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;lowQueues&quot;: [</span><br><span class="line">            &quot;event:p3&quot;,</span><br><span class="line">            &quot;event:p4&quot;,</span><br><span class="line">            &quot;event:p5&quot;,</span><br><span class="line">            &quot;event:p6&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;userIMQueue&quot;: &quot;/queue/user/im&quot;,</span><br><span class="line">        &quot;userSmsQueue&quot;: &quot;/queue/user/sms&quot;,</span><br><span class="line">        &quot;userMailQueue&quot;: &quot;/queue/user/mail&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;api&quot;: &#123;</span><br><span class="line">        &quot;im&quot;: &quot;http://127.0.0.1:4567/send&quot;,</span><br><span class="line">        &quot;sms&quot;: &quot;http://127.0.0.1:10086/sms&quot;,</span><br><span class="line">        &quot;mail&quot;: &quot;http://127.0.0.1:4000/sender/mail&quot;,</span><br><span class="line">        &quot;dashboard&quot;: &quot;http://127.0.0.1:8081&quot;,</span><br><span class="line">        &quot;plus_api&quot;:&quot;http://127.0.0.1:8080&quot;,</span><br><span class="line">        &quot;plus_api_token&quot;: &quot;default-token-used-in-server-side&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;falcon_portal&quot;: &#123;</span><br><span class="line">        &quot;addr&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/alarms?charset=utf8&amp;loc=Asia%2FChongqing&quot;,</span><br><span class="line">        &quot;idle&quot;: 10,</span><br><span class="line">        &quot;max&quot;: 100</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;worker&quot;: &#123;</span><br><span class="line">        &quot;im&quot;: 10,</span><br><span class="line">        &quot;sms&quot;: 10,</span><br><span class="line">        &quot;mail&quot;: 50</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;housekeeper&quot;: &#123;</span><br><span class="line">        &quot;event_retention_days&quot;: 7,</span><br><span class="line">        &quot;event_delete_batch&quot;: 100</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="配置-nodata-服务">配置 Nodata 服务</span></h2>
<blockquote>
<p>nodata用于检测监控数据的上报异常。nodata和实时报警judge模块协同工作，过程为: 配置了nodata的采集项超时未上报数据，nodata生成一条默认的模拟数据；用户配置相应的报警策略，收到mock数据就产生报警。采集项上报异常检测，作为judge模块的一个必要补充，能够使judge的实时报警功能更加可靠、完善。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/nodata/config</span><br><span class="line"></span><br><span class="line">vi cfg.json </span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6090&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;plus_api&quot;:&#123;</span><br><span class="line">        &quot;connectTimeout&quot;: 500,</span><br><span class="line">        &quot;requestTimeout&quot;: 2000,</span><br><span class="line">        &quot;addr&quot;: &quot;http://127.0.0.1:8080&quot;,</span><br><span class="line">        &quot;token&quot;: &quot;default-token-used-in-server-side&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;config&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;dsn&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&amp;wait_timeout=604800&quot;,</span><br><span class="line">        &quot;maxIdle&quot;: 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collector&quot;:&#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;batch&quot;: 200,</span><br><span class="line">        &quot;concurrent&quot;: 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;sender&quot;:&#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;connectTimeout&quot;: 500,</span><br><span class="line">        &quot;requestTimeout&quot;: 2000,</span><br><span class="line">        &quot;transferAddr&quot;: &quot;127.0.0.1:6060&quot;,</span><br><span class="line">        &quot;batch&quot;: 500</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="配置-aggregator-服务">配置 Aggregator 服务</span></h2>
<blockquote>
<p>集群聚合模块。聚合某集群下的所有机器的某个指标的值，提供一种集群视角的监控体验。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon/aggregator/config</span><br><span class="line"></span><br><span class="line">vi cfg.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;listen&quot;: &quot;0.0.0.0:6055&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;database&quot;: &#123;</span><br><span class="line">        &quot;addr&quot;: &quot;root:123456@tcp(127.0.0.1:3306)/falcon_portal?loc=Local&amp;parseTime=true&quot;,</span><br><span class="line">        &quot;idle&quot;: 10,</span><br><span class="line">        &quot;ids&quot;: [1, -1],</span><br><span class="line">        &quot;interval&quot;: 55</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;api&quot;: &#123;</span><br><span class="line">        &quot;connect_timeout&quot;: 500,</span><br><span class="line">        &quot;request_timeout&quot;: 2000,</span><br><span class="line">        &quot;plus_api&quot;: &quot;http://127.0.0.1:8080&quot;,</span><br><span class="line">        &quot;plus_api_token&quot;: &quot;default-token-used-in-server-side&quot;,</span><br><span class="line">        &quot;push_api&quot;: &quot;http://127.0.0.1:1988/v1/push&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="启动所有服务">启动所有服务</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">./open-falcon start</span><br><span class="line"></span><br><span class="line">./open-falcon check</span><br><span class="line">        falcon-graph         UP           71646 </span><br><span class="line">          falcon-hbs         UP           71658 </span><br><span class="line">        falcon-judge         UP           71670 </span><br><span class="line">     falcon-transfer         UP           71678 </span><br><span class="line">       falcon-nodata         UP           71686 </span><br><span class="line">   falcon-aggregator         UP           71695 </span><br><span class="line">        falcon-agent         UP           71706 </span><br><span class="line">      falcon-gateway         UP           71715 </span><br><span class="line">          falcon-api         UP           71724 </span><br><span class="line">        falcon-alarm         UP           71738</span><br></pre></td></tr></table></figure>
<h1><span id="配置-agent">配置 Agent</span></h1>
<blockquote>
<p>agent用于采集机器负载监控指标，比如cpu.idle、load.1min、disk.io.util等等，每隔60秒push给Transfer。agent与Transfer建立了长连接，数据发送速度比较快，agent提供了一个http接口/v1/push用于接收用户手工push的一些数据，然后通过长连接迅速转发给Transfer。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cd /opt/local/open-falcon/agent/config</span><br><span class="line"></span><br><span class="line"># Agent 配置文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;debug&quot;: true,</span><br><span class="line">    &quot;hostname&quot;: &quot;&quot;,</span><br><span class="line">    &quot;ip&quot;: &quot;&quot;,</span><br><span class="line">    &quot;plugin&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;dir&quot;: &quot;./plugin&quot;,</span><br><span class="line">        &quot;git&quot;: &quot;https://github.com/open-falcon/plugin.git&quot;,</span><br><span class="line">        &quot;logs&quot;: &quot;./logs&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;heartbeat&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;addr&quot;: &quot;127.0.0.1:6030&quot;,</span><br><span class="line">        &quot;interval&quot;: 60,</span><br><span class="line">        &quot;timeout&quot;: 1000</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;transfer&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: true,</span><br><span class="line">        &quot;addrs&quot;: [</span><br><span class="line">            &quot;127.0.0.1:8433&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;interval&quot;: 60,</span><br><span class="line">        &quot;timeout&quot;: 1000</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;http&quot;: &#123;</span><br><span class="line">        &quot;enabled&quot;: false,</span><br><span class="line">        &quot;listen&quot;: &quot;:1988&quot;,</span><br><span class="line">        &quot;backdoor&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;collector&quot;: &#123;</span><br><span class="line">        &quot;ifacePrefix&quot;: [&quot;eth&quot;, &quot;em&quot;],</span><br><span class="line">        &quot;mountPoint&quot;: []</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;default_tags&quot;: &#123;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;ignore&quot;: &#123;</span><br><span class="line">        &quot;cpu.busy&quot;: true,</span><br><span class="line">        &quot;df.bytes.free&quot;: true,</span><br><span class="line">        &quot;df.bytes.total&quot;: true,</span><br><span class="line">        &quot;df.bytes.used&quot;: true,</span><br><span class="line">        &quot;df.bytes.used.percent&quot;: true,</span><br><span class="line">        &quot;df.inodes.total&quot;: true,</span><br><span class="line">        &quot;df.inodes.free&quot;: true,</span><br><span class="line">        &quot;df.inodes.used&quot;: true,</span><br><span class="line">        &quot;df.inodes.used.percent&quot;: true,</span><br><span class="line">        &quot;mem.memtotal&quot;: true,</span><br><span class="line">        &quot;mem.memused&quot;: true,</span><br><span class="line">        &quot;mem.memused.percent&quot;: true,</span><br><span class="line">        &quot;mem.memfree&quot;: true,</span><br><span class="line">        &quot;mem.swaptotal&quot;: true,</span><br><span class="line">        &quot;mem.swapused&quot;: true,</span><br><span class="line">        &quot;mem.swapfree&quot;: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># agent 脚本  添加 hostname = IP</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">mkdir /opt/local</span><br><span class="line">cd /opt/local</span><br><span class="line">wget http://172.16.1.100/agent.tar.gz</span><br><span class="line">tar zxvf agent.tar.gz</span><br><span class="line">rm -rf agent.tar.gz</span><br><span class="line">IPADDR=`ifconfig em1|grep inet|grep -v 127.0.0.1|grep -v inet6|awk &apos;&#123;print $2&#125;&apos;|tr -d &quot;addr:&quot;`</span><br><span class="line">sed -i &apos;s/\&quot;hostname\&quot;\:.*$/\&quot;hostname\&quot;\: \&quot;&apos;$IPADDR&apos;\&quot;\,/g&apos; open-falcon/agent/config/cfg.json</span><br><span class="line">cat open-falcon/agent/config/cfg.json</span><br><span class="line">cd open-falcon</span><br><span class="line">./open-falcon start agent</span><br><span class="line">./open-falcon check agent</span><br></pre></td></tr></table></figure>
<h1><span id="配置前端-dashboard">配置前端 dashboard</span></h1>
<h2><span id="初始化依赖">初始化依赖</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install -y python-virtualenv</span><br><span class="line">yum install -y python-devel</span><br><span class="line">yum install -y openldap-devel</span><br><span class="line">yum install -y mysql-devel</span><br><span class="line">yum groupinstall &quot;Development tools&quot;</span><br></pre></td></tr></table></figure>
<h2><span id="安装配置-dashboard">安装配置 dashboard</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/local/open-falcon</span><br><span class="line"></span><br><span class="line">git clone https://github.com/open-falcon/dashboard.git</span><br><span class="line"></span><br><span class="line">cd dashboard</span><br><span class="line"></span><br><span class="line"># 创建 python 独立运行环境</span><br><span class="line"></span><br><span class="line">virtualenv ./env</span><br><span class="line"></span><br><span class="line"># 安装 python 依赖模块</span><br><span class="line"></span><br><span class="line"># 执行安装</span><br><span class="line"></span><br><span class="line">./env/bin/pip install -r pip_requirements.txt -i http://mirrors.aliyun.com/pypi/simple/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改配置</span><br><span class="line"></span><br><span class="line"># 修改里面的 mysql 配置</span><br><span class="line"></span><br><span class="line">rrd/config.py</span><br><span class="line"></span><br><span class="line">ALARM_DB_PASS</span><br></pre></td></tr></table></figure>
<h2><span id="启动-dashboard">启动 dashboard</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># debug 模式</span><br><span class="line"></span><br><span class="line">./env/bin/python wsgi.py</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 正常模式</span><br><span class="line"></span><br><span class="line">bash control start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看日志</span><br><span class="line">bash control tail</span><br></pre></td></tr></table></figure>
<h2><span id="登陆-web-ui">登陆 WEB UI</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http://172.16.1.100:8081/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注册  root 帐号  为 admin 帐号</span><br></pre></td></tr></table></figure>
<h1><span id="监控报警">监控报警</span></h1>
<h2><span id="配置-报警名单">配置 报警名单</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 首先配置 用户组</span><br><span class="line"></span><br><span class="line">dashboard --&gt; Welcome root --&gt;  Teams </span><br><span class="line"></span><br><span class="line">Add+  -- &gt; Create Team</span><br><span class="line"></span><br><span class="line"># 创建一个 ICT 组</span><br><span class="line"></span><br><span class="line">名称： ICT</span><br><span class="line">简介： 运维组</span><br><span class="line">成员： root</span><br></pre></td></tr></table></figure>
<h2><span id="配置-nodata-监控-agent">配置 nodata 监控 agent</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 创建 HostGrop</span><br><span class="line"></span><br><span class="line">dashboard --&gt; HostGroups</span><br><span class="line"></span><br><span class="line">添加一个名称 dev-server 的 HostGroups</span><br><span class="line"></span><br><span class="line">点击 hosts -- &gt; Add Host  添加  dev 相关服务器</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 创建 nodata</span><br><span class="line"># 监控 client 的 agent ，如果 agent 掉了， 那么无法上传数据，所以直接配置</span><br><span class="line">模板是不行的， 必须配置 nodata 在 agent 抓不到数据的时候 值为 -1 . </span><br><span class="line"></span><br><span class="line">dashboard --&gt; nodata</span><br><span class="line"></span><br><span class="line">Add nodata</span><br><span class="line"></span><br><span class="line">name: nodata.agent</span><br><span class="line"></span><br><span class="line">endpoint选择:   机器分组  ---  dev-server</span><br><span class="line"></span><br><span class="line">metric: agent.alive</span><br><span class="line"></span><br><span class="line">type: GAUGE</span><br><span class="line"></span><br><span class="line">周期: 60</span><br><span class="line"></span><br><span class="line">数据上报中断时，补发如下值: -1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"># 创建 策略配置</span><br><span class="line"></span><br><span class="line">dashboard --&gt; Templates</span><br><span class="line"></span><br><span class="line">创建一个 名称为 agent-alive 的模板</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 模板基础信息:</span><br><span class="line"></span><br><span class="line">name: agent-alive</span><br><span class="line"></span><br><span class="line">模板策略列表:</span><br><span class="line"></span><br><span class="line">metric: agent.alive   note: 无法连接agent</span><br><span class="line"></span><br><span class="line">if [all(#3)] &lt; 0 : alarm(); callback();</span><br><span class="line"></span><br><span class="line">save 保存</span><br><span class="line"></span><br><span class="line"># 模板报警配置:</span><br><span class="line"></span><br><span class="line">之前设置的 ICT</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Save</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 绑定 模板</span><br><span class="line"></span><br><span class="line">dashboard --&gt; HostGroups</span><br><span class="line"></span><br><span class="line">查找  dev-server   点击  templates</span><br><span class="line"></span><br><span class="line">查找  agent-alive   选择 + Bind</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 测试</span><br><span class="line"></span><br><span class="line">关闭一个 agent 的进程</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">等待60秒 查看 Alarm-Dashboard</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">等待收取邮件~</span><br></pre></td></tr></table></figure>
<h2><span id="配置-系统监控指标">配置 系统监控指标</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dashboard --&gt; Templates</span><br><span class="line"></span><br><span class="line">Add 添加一个 系统指标模块</span><br><span class="line"></span><br><span class="line">监控指标如下:</span><br></pre></td></tr></table></figure>
<p><img src="https://jicki.me/img/posts/openfalcon/sys.png" alt="sys.png-60.9kB"></p>
<h1><span id="faq">FAQ</span></h1>
<h2><span id="修改-报警模板">修改 报警模板</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">cd open-falcon/falcon-plus/modules/alarm/cron</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 报警内容:</span><br><span class="line"></span><br><span class="line">cat builder.go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package cron</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">        &quot;fmt&quot;</span><br><span class="line"></span><br><span class="line">        &quot;github.com/open-falcon/falcon-plus/common/model&quot;</span><br><span class="line">        &quot;github.com/open-falcon/falcon-plus/common/utils&quot;</span><br><span class="line">        &quot;github.com/open-falcon/falcon-plus/modules/alarm/g&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">func BuildCommonSMSContent(event *model.Event) string &#123;</span><br><span class="line">        return fmt.Sprintf(</span><br><span class="line">                &quot;[P%d][%s][%s][][%s %s %s %s %s%s%s][O%d %s]&quot;,</span><br><span class="line">                event.Priority(),</span><br><span class="line">                event.Status,</span><br><span class="line">                event.Endpoint,</span><br><span class="line">                event.Note(),</span><br><span class="line">                event.Func(),</span><br><span class="line">                event.Metric(),</span><br><span class="line">                utils.SortedTags(event.PushedTags),</span><br><span class="line">                utils.ReadableFloat(event.LeftValue),</span><br><span class="line">                event.Operator(),</span><br><span class="line">                utils.ReadableFloat(event.RightValue()),</span><br><span class="line">                event.CurrentStep,</span><br><span class="line">                event.FormattedTime(),</span><br><span class="line">        )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BuildCommonIMContent(event *model.Event) string &#123;</span><br><span class="line">        return fmt.Sprintf(</span><br><span class="line">                &quot;[报警级别: %d][报警状态: %s][报警Host: %s][报警内容: %s][报警时间: %s]&quot;,</span><br><span class="line">                event.Priority(),</span><br><span class="line">                event.Status,</span><br><span class="line">                event.Endpoint,</span><br><span class="line">                event.Note(),</span><br><span class="line">                //event.Func(),</span><br><span class="line">                //event.Metric(),</span><br><span class="line">                //utils.SortedTags(event.PushedTags),</span><br><span class="line">                //utils.ReadableFloat(event.LeftValue),</span><br><span class="line">                //event.Operator(),</span><br><span class="line">                //utils.ReadableFloat(event.RightValue()),</span><br><span class="line">                //event.CurrentStep,</span><br><span class="line">                event.FormattedTime(),</span><br><span class="line">        )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func BuildCommonMailContent(event *model.Event) string &#123;</span><br><span class="line">        link := g.Link(event)</span><br><span class="line">        return fmt.Sprintf(</span><br><span class="line">                &quot;报警状态: %s\r\n报警级别: %d\r\n报警Host: %s\r\n报警事件: %s\r\n事件标签: %s\r\n报警表达式: %s: %s%s%s\r\n报警内容: %s\r\n最大报警次数: %d   当前报警次数: %d\r\n报警时间: %s\r\n报警模板: %s\r\n&quot;,</span><br><span class="line">                event.Status,</span><br><span class="line">                event.Priority(),</span><br><span class="line">                event.Endpoint,</span><br><span class="line">                event.Metric(),</span><br><span class="line">                utils.SortedTags(event.PushedTags),</span><br><span class="line">                event.Func(),</span><br><span class="line">                utils.ReadableFloat(event.LeftValue),</span><br><span class="line">                event.Operator(),</span><br><span class="line">                utils.ReadableFloat(event.RightValue()),</span><br><span class="line">                event.Note(),</span><br><span class="line">                event.MaxStep(),</span><br><span class="line">                event.CurrentStep,</span><br><span class="line">                event.FormattedTime(),</span><br><span class="line">                link,</span><br><span class="line">        )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func GenerateSmsContent(event *model.Event) string &#123;</span><br><span class="line">        return BuildCommonSMSContent(event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func GenerateMailContent(event *model.Event) string &#123;</span><br><span class="line">        return BuildCommonMailContent(event)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func GenerateIMContent(event *model.Event) string &#123;</span><br><span class="line">        return BuildCommonIMContent(event)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/01/30/2017-09-11-kubernetes-storageclass/" data-toggle="tooltip" data-placement="top" title="Kubernetes Storage Class">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/01/30/2017-08-08-kubernetes-1.7.3/" data-toggle="tooltip" data-placement="top" title="kubernetes 1.7.3 + calico 多 Master">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share" data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">环境准备</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">安装 golang</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">安装 Mysql 5.7</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">安装 redis</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">配置 Open-Falcon</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">初始化环境</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">导入数据库</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">编译 程序</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">配置 Transfer</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">配置 Graph</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">配置 Api 组件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">部署 Heartbeat 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.8.</span> <span class="toc-nav-text">部署 Judge 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.9.</span> <span class="toc-nav-text">部署一个 mail 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.10.</span> <span class="toc-nav-text">部署一个 微信网关</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.11.</span> <span class="toc-nav-text">部署 Alarm 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.12.</span> <span class="toc-nav-text">配置 Nodata 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.13.</span> <span class="toc-nav-text">配置 Aggregator 服务</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.14.</span> <span class="toc-nav-text">启动所有服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">配置 Agent</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">配置前端 dashboard</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">初始化依赖</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">安装配置 dashboard</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">启动 dashboard</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">4.4.</span> <span class="toc-nav-text">登陆 WEB UI</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">监控报警</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">配置 报警名单</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">配置 nodata 监控 agent</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">5.3.</span> <span class="toc-nav-text">配置 系统监控指标</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">FAQ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">修改 报警模板</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://www.jicki.me" target="_blank">小炒肉</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "jicki";
    var disqus_identifier = "https://www.jicki.me/2019/01/30/2017-08-18-Open-Falcon/";
    var disqus_url = "https://www.jicki.me/2019/01/30/2017-08-18-Open-Falcon/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/jicki234">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/jicki520">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 小炒肉 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.jicki.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-85602329-1';
    var _gaDomain = 'jicki.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '1b38b88e4559c6725330b8c3328e2de3';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.jicki.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
