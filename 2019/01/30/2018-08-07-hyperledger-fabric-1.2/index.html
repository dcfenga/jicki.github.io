<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Your future depends on your dreams">
    <meta name="keyword" content="小炒肉, 运维工程师, Jicki, DevOps, Docker, Kubernetes">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          hyperledger-fabric v 1.2 多机 多节点 - 小炒肉 | Blog
        
    </title>

    <link rel="canonical" href="https://www.jicki.me/2019/01/30/2018-08-07-hyperledger-fabric-1.2/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <link rel="stylesheet" href="/css/beantech.min.css">

    <link rel="stylesheet" href="/css/donate.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('img/pexels/triangular.jpeg')
            /*post*/
        
    }
    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                        </div>
                        <h1>hyperledger-fabric v 1.2 多机 多节点</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by 小炒肉 on
                            2019-01-30
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">小炒肉</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <blockquote>
<p>fabric v1.2 , 多机，多节点，多 Orderer ，生产环境配置。</p>
</blockquote>
<h1><span id="部署-hyperledger-fabric-v12">部署 hyperledger-fabric v1.2</span></h1>
<h2><span id="环境规划">环境规划</span></h2>
<blockquote>
<p>相关hostname 必须配置 dns</p>
<p>关于 orderer 集群</p>
<p>当orderer 向peer节点提交Transaction的时候，peer节点会得到或返回一个读写集结果，该结果会发送给orderer节点进行共识和排序，此时如果orderer节点突然down掉，就会使请求服务失效而引发的数据丢失等问题，且目前的sdk对orderer发送的Transaction的回调会占用极长的时间，当大批量数据导入的时候该回调可认为不可用。</p>
</blockquote>
<table>
<thead>
<tr>
<th>节点标识</th>
<th>hostname</th>
<th>IP</th>
<th>开放端口</th>
<th>系统</th>
</tr>
</thead>
<tbody>
<tr>
<td>orderer0节点</td>
<td><a href="http://orderer0.jicki.me" target="_blank" rel="noopener">orderer0.jicki.me</a></td>
<td>192.168.100.67</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>orderer1节点</td>
<td><a href="http://orderer1.jicki.me" target="_blank" rel="noopener">orderer1.jicki.me</a></td>
<td>192.168.100.15</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>orderer2节点</td>
<td><a href="http://orderer2.jicki.me" target="_blank" rel="noopener">orderer2.jicki.me</a></td>
<td>192.168.100.91</td>
<td>7050</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>peer0节点</td>
<td><a href="http://peer0.org1.jicki.me" target="_blank" rel="noopener">peer0.org1.jicki.me</a></td>
<td>192.168.100.15</td>
<td>7051, 7052, 7053</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>peer0节点</td>
<td><a href="http://peer0.org2.jicki.me" target="_blank" rel="noopener">peer0.org2.jicki.me</a></td>
<td>192.168.100.91</td>
<td>7051, 7052, 7053</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk0节点</td>
<td>zookeeper0</td>
<td>192.168.100.67</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk1节点</td>
<td>zookeeper1</td>
<td>192.168.100.15</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>zk2节点</td>
<td>zookeeper2</td>
<td>192.168.100.91</td>
<td>2181</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka0节点</td>
<td>kafka0</td>
<td>192.168.100.67</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka1节点</td>
<td>kafka1</td>
<td>192.168.100.15</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
<tr>
<td>kafka2节点</td>
<td>kafka2</td>
<td>192.168.100.91</td>
<td>9092</td>
<td>CentOS 7 x64</td>
</tr>
</tbody>
</table>
<blockquote>
<p>所有节点 docker 互为单机，不做网络集群，连接使用 hostname  or  IP</p>
<p>所有需要配置 hosts  域名</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 所有节点均需要配置</span><br><span class="line"></span><br><span class="line">vi /etc/hosts</span><br><span class="line"></span><br><span class="line"># fabric hostname</span><br><span class="line"></span><br><span class="line">192.168.100.67 orderer0.jicki.me</span><br><span class="line">192.168.100.15 orderer1.jicki.me</span><br><span class="line">192.168.100.91 orderer2.jicki.me</span><br><span class="line">192.168.100.15 peer0.org1.jicki.me</span><br><span class="line">192.168.100.91 peer0.org2.jicki.me</span><br><span class="line">192.168.100.67 zookeeper0</span><br><span class="line">192.168.100.15 zookeeper1</span><br><span class="line">192.168.100.91 zookeeper2</span><br><span class="line">192.168.100.67 kafka0</span><br><span class="line">192.168.100.15 kafka1</span><br><span class="line">192.168.100.91 kafka2</span><br><span class="line"></span><br><span class="line"># fabric hostname</span><br></pre></td></tr></table></figure>
<h2><span id="官方地址">官方地址</span></h2>
<blockquote>
<p>文档以官方文档为主 <a href="http://hyperledger-fabric.readthedocs.io/en/release-1.2/prereqs.html" target="_blank" rel="noopener">http://hyperledger-fabric.readthedocs.io/en/release-1.2/prereqs.html</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 官网 github</span><br><span class="line">https://github.com/hyperledger/fabric</span><br></pre></td></tr></table></figure>
<h2><span id="环境准备">环境准备</span></h2>
<blockquote>
<p>所有机器 安装 Docker (用于 fabric 服务启动)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 导入 yum 源</span><br><span class="line"></span><br><span class="line"># 安装 yum-config-manager</span><br><span class="line"></span><br><span class="line">yum -y install yum-utils</span><br><span class="line"></span><br><span class="line"># 导入</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"># 安装 docker</span><br><span class="line"></span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 启动 docker </span><br><span class="line"></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 查看 docker 版本</span><br><span class="line"></span><br><span class="line">docker version</span><br><span class="line">Client:</span><br><span class="line"> Version:           18.06.0-ce</span><br><span class="line"> API version:       1.38</span><br><span class="line"> Go version:        go1.10.3</span><br><span class="line"> Git commit:        0ffa825</span><br><span class="line"> Built:             Wed Jul 18 19:08:18 2018</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Experimental:      false</span><br><span class="line"></span><br><span class="line">Server:</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          18.06.0-ce</span><br><span class="line">  API version:      1.38 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.10.3</span><br><span class="line">  Git commit:       0ffa825</span><br><span class="line">  Built:            Wed Jul 18 19:10:42 2018</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br></pre></td></tr></table></figure>
<ul>
<li>安装 Docker-compose (用于 docker 容器服务统一管理 编排)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 安装 pip</span><br><span class="line"></span><br><span class="line">curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</span><br><span class="line"></span><br><span class="line">python get-pip.py</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 安装 docker-compose</span><br><span class="line"></span><br><span class="line">pip install docker-compose --ignore-installed requests</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-compose version</span><br><span class="line">docker-compose version 1.22.0, build f46880f</span><br><span class="line">docker-py version: 3.4.1</span><br><span class="line">CPython version: 2.7.5</span><br><span class="line">OpenSSL version: OpenSSL 1.0.1e-fips 11 Feb 2013</span><br></pre></td></tr></table></figure>
<ul>
<li>Golang (用于 fabric cli 服务的调用， ca 服务证书生成 )</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/golang</span><br><span class="line">mkdir -p /opt/gopath</span><br><span class="line"></span><br><span class="line"># 国外地址</span><br><span class="line">wget https://storage.googleapis.com/golang/go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"># 国内地址</span><br><span class="line">wget https://studygolang.com/dl/golang/go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 解压</span><br><span class="line">tar zxvf go1.10.linux-amd64.tar.gz</span><br><span class="line"></span><br><span class="line"># 配置环境变量</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line">添加如下</span><br><span class="line"></span><br><span class="line"># golang env</span><br><span class="line">export PATH=$PATH:/opt/golang/go/bin</span><br><span class="line">export GOPATH=/opt/gopath</span><br><span class="line"></span><br><span class="line"># 生效配置</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看配置</span><br><span class="line"></span><br><span class="line">go version</span><br><span class="line">go version go1.10 linux/amd64</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-源码">Hyperledger Fabric 源码</span></h2>
<blockquote>
<p>fabric 源码用于 cli 智能合约安装时的依赖, 这里只用于第一个节点</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"># 下载 Fabric 源码, 源码中 import 的路径为github.com/hyperledger/fabric ,所以我们要按照这个路径</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/gopath/src/github.com/hyperledger</span><br><span class="line"></span><br><span class="line">cd /opt/gopath/src/github.com/hyperledger</span><br><span class="line"></span><br><span class="line">git clone https://github.com/hyperledger/fabric</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/gopath/src</span><br><span class="line"></span><br><span class="line">cp -r github.com /opt/gopath/src</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 文件如下:</span><br><span class="line"></span><br><span class="line">[root@localhost fabric]# ls -lt</span><br><span class="line">总用量 580</span><br><span class="line">drwxr-xr-x  7 root root    138 6月   5 09:29 vendor</span><br><span class="line">-rw-r--r--  1 root root    301 6月   5 09:29 tox.ini</span><br><span class="line">drwxr-xr-x  2 root root     56 6月   5 09:29 unit-test</span><br><span class="line">drwxr-xr-x  7 root root    134 6月   5 09:29 test</span><br><span class="line">drwxr-xr-x  2 root root   4096 6月   5 09:29 scripts</span><br><span class="line">-rw-r--r--  1 root root    316 6月   5 09:29 settings.gradle</span><br><span class="line">drwxr-xr-x  3 root root     91 6月   5 09:29 sampleconfig</span><br><span class="line">drwxr-xr-x  2 root root   4096 6月   5 09:29 release_notes</span><br><span class="line">drwxr-xr-x 11 root root   4096 6月   5 09:29 protos</span><br><span class="line">drwxr-xr-x  3 root root     30 6月   5 09:29 release</span><br><span class="line">drwxr-xr-x  9 root root    154 6月   5 09:29 peer</span><br><span class="line">drwxr-xr-x  3 root root     23 6月   5 09:29 proposals</span><br><span class="line">drwxr-xr-x  6 root root    126 6月   5 09:29 orderer</span><br><span class="line">drwxr-xr-x  6 root root   4096 6月   5 09:29 msp</span><br><span class="line">drwxr-xr-x  9 root root    130 6月   5 09:29 images</span><br><span class="line">drwxr-xr-x  2 root root     29 6月   5 09:29 gotools</span><br><span class="line">drwxr-xr-x  2 root root   4096 6月   5 09:29 idemix</span><br><span class="line">drwxr-xr-x 15 root root   4096 6月   5 09:29 gossip</span><br><span class="line">drwxr-xr-x 10 root root   4096 6月   5 09:29 examples</span><br><span class="line">drwxr-xr-x  4 root root     48 6月   5 09:29 events</span><br><span class="line">drwxr-xr-x  4 root root    137 6月   5 09:29 docs</span><br><span class="line">drwxr-xr-x  4 root root   4096 6月   5 09:29 devenv</span><br><span class="line">-rw-r--r--  1 root root   3356 6月   5 09:29 docker-env.mk</span><br><span class="line">drwxr-xr-x 20 root root   4096 6月   5 09:29 core</span><br><span class="line">drwxr-xr-x 23 root root   4096 6月   5 09:29 common</span><br><span class="line">drwxr-xr-x 10 root root   4096 6月   5 09:29 bddtests</span><br><span class="line">-rw-r--r--  1 root root     13 6月   5 09:29 ci.properties</span><br><span class="line">drwxr-xr-x  8 root root   4096 6月   5 09:29 bccsp</span><br><span class="line">-rw-r--r--  1 root root  11358 6月   5 09:29 LICENSE</span><br><span class="line">-rwxr-xr-x  1 root root  17068 6月   5 09:29 Makefile</span><br><span class="line">-rw-r--r--  1 root root   5678 6月   5 09:29 README.md</span><br><span class="line">-rw-r--r--  1 root root 475471 6月   5 09:29 CHANGELOG.md</span><br><span class="line">-rw-r--r--  1 root root    597 6月   5 09:29 CODE_OF_CONDUCT.md</span><br><span class="line">-rw-r--r--  1 root root    664 6月   5 09:29 CONTRIBUTING.md</span><br></pre></td></tr></table></figure>
<h2><span id="生成-hyperledger-fabric-证书">生成 Hyperledger Fabric 证书</span></h2>
<blockquote>
<p>证书生成只需要生成一次，这里只在第一个节点配置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># 下载官方证书生成软件(均为二进制文件)</span><br><span class="line"># 官方离线下载地址为 https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 选择相应版本 CentOS 选择 linux-amd64-1.2.0  Mac 选择 darwin-amd64-1.2.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 下载地址为: https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir /opt/jicki/</span><br><span class="line"></span><br><span class="line">cd /opt/jicki</span><br><span class="line"></span><br><span class="line">wget https://nexus.hyperledger.org/content/repositories/releases/org/hyperledger/fabric/hyperledger-fabric/linux-amd64-1.2.0/hyperledger-fabric-linux-amd64-1.2.0.tar.gz</span><br><span class="line"></span><br><span class="line">tar zxvf hyperledger-fabric-linux-amd64-1.2.0.tar.gz</span><br><span class="line"></span><br><span class="line"># 解压后是 一个 bin 与 一个 config 目录</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# tree bin/</span><br><span class="line">bin/</span><br><span class="line">├── configtxgen</span><br><span class="line">├── configtxlator</span><br><span class="line">├── cryptogen</span><br><span class="line">├── get-docker-images.sh</span><br><span class="line">├── orderer</span><br><span class="line">└── peer</span><br><span class="line"></span><br><span class="line">0 directories, 6 files</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># 为方便使用 我们配置一个 环境变量</span><br><span class="line"></span><br><span class="line">vi /etc/profile</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># fabric env</span><br><span class="line">export PATH=$PATH:/opt/jicki/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 使文件生效</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 拷贝 configtx.yaml  与 crypto-config.yaml 。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cd /opt/jicki/</span><br><span class="line"></span><br><span class="line">cp /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/crypto-config.yaml .</span><br><span class="line"></span><br><span class="line">cp /opt/gopath/src/github.com/hyperledger/fabric/examples/e2e_cli/configtx.yaml .</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 这里修改相应 jicki.me 为 jicki.me</span><br><span class="line"></span><br><span class="line">sed -i &apos;s/example\.com/jicki\.me/g&apos; *.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 编辑 crypto-config.yaml 增加 orderer 为三个如下:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OrdererOrgs:</span><br><span class="line">  - Name: Orderer</span><br><span class="line">    Domain: jicki.me</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Specs:</span><br><span class="line">      - Hostname: orderer0</span><br><span class="line">      - Hostname: orderer1</span><br><span class="line">      - Hostname: orderer2</span><br><span class="line">      </span><br><span class="line">PeerOrgs:</span><br><span class="line">  - Name: Org1</span><br><span class="line">    Domain: org1.jicki.me</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br><span class="line">  - Name: Org2</span><br><span class="line">    Domain: org2.jicki.me</span><br><span class="line">    EnableNodeOUs: true</span><br><span class="line">    CA:</span><br><span class="line">        Country: CN</span><br><span class="line">        Province: GuangDong</span><br><span class="line">        Locality: ShenZhen</span><br><span class="line">    Template:</span><br><span class="line">      Count: 2</span><br><span class="line">    Users:</span><br><span class="line">      Count: 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br></pre></td><td class="code"><pre><span class="line"># 然后这里使用 cryptogen 软件来生成相应的证书了</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# cryptogen generate --config=./crypto-config.yaml</span><br><span class="line">org1.jicki.me</span><br><span class="line">org2.jicki.me</span><br><span class="line"></span><br><span class="line"># 生成一个 crypto-config 证书目录</span><br><span class="line"></span><br><span class="line">[root@payment jicki]# tree crypto-config</span><br><span class="line">crypto-config</span><br><span class="line">├── ordererOrganizations</span><br><span class="line">│   └── jicki.me</span><br><span class="line">│       ├── ca</span><br><span class="line">│       │   ├── ca.jicki.me-cert.pem</span><br><span class="line">│       │   └── ea7afe99d56e6c2e839113909651f8b3531a6447e4615eed208c7aa86b211ad0_sk</span><br><span class="line">│       ├── msp</span><br><span class="line">│       │   ├── admincerts</span><br><span class="line">│       │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   ├── cacerts</span><br><span class="line">│       │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   └── tlscacerts</span><br><span class="line">│       │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       ├── orderers</span><br><span class="line">│       │   ├── orderer0.jicki.me</span><br><span class="line">│       │   │   ├── msp</span><br><span class="line">│       │   │   │   ├── admincerts</span><br><span class="line">│       │   │   │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── cacerts</span><br><span class="line">│       │   │   │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── keystore</span><br><span class="line">│       │   │   │   │   └── c4ff1a8f55af9e4108596a26471a2a748eeb370b00300abddac692d5c5f72f57_sk</span><br><span class="line">│       │   │   │   ├── signcerts</span><br><span class="line">│       │   │   │   │   └── orderer0.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   └── tlscacerts</span><br><span class="line">│       │   │   │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │   │   └── tls</span><br><span class="line">│       │   │       ├── ca.crt</span><br><span class="line">│       │   │       ├── server.crt</span><br><span class="line">│       │   │       └── server.key</span><br><span class="line">│       │   ├── orderer1.jicki.me</span><br><span class="line">│       │   │   ├── msp</span><br><span class="line">│       │   │   │   ├── admincerts</span><br><span class="line">│       │   │   │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── cacerts</span><br><span class="line">│       │   │   │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   ├── keystore</span><br><span class="line">│       │   │   │   │   └── f057fd116621213b9d06cf05d1b04b3b53057b4df4338ca5bb3b59e36acf074a_sk</span><br><span class="line">│       │   │   │   ├── signcerts</span><br><span class="line">│       │   │   │   │   └── orderer1.jicki.me-cert.pem</span><br><span class="line">│       │   │   │   └── tlscacerts</span><br><span class="line">│       │   │   │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │   │   └── tls</span><br><span class="line">│       │   │       ├── ca.crt</span><br><span class="line">│       │   │       ├── server.crt</span><br><span class="line">│       │   │       └── server.key</span><br><span class="line">│       │   └── orderer2.jicki.me</span><br><span class="line">│       │       ├── msp</span><br><span class="line">│       │       │   ├── admincerts</span><br><span class="line">│       │       │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│       │       │   ├── cacerts</span><br><span class="line">│       │       │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│       │       │   ├── keystore</span><br><span class="line">│       │       │   │   └── a0395ee7823af3ab3ae56fa4569051a5525324f506cd38b0d0dcaa3e484ae084_sk</span><br><span class="line">│       │       │   ├── signcerts</span><br><span class="line">│       │       │   │   └── orderer2.jicki.me-cert.pem</span><br><span class="line">│       │       │   └── tlscacerts</span><br><span class="line">│       │       │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       │       └── tls</span><br><span class="line">│       │           ├── ca.crt</span><br><span class="line">│       │           ├── server.crt</span><br><span class="line">│       │           └── server.key</span><br><span class="line">│       ├── tlsca</span><br><span class="line">│       │   ├── 4164a39aaee758c85e9d4458bae4d51f0d01e58116003cd5782dbbaff68b1545_sk</span><br><span class="line">│       │   └── tlsca.jicki.me-cert.pem</span><br><span class="line">│       └── users</span><br><span class="line">│           └── Admin@jicki.me</span><br><span class="line">│               ├── msp</span><br><span class="line">│               │   ├── admincerts</span><br><span class="line">│               │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│               │   ├── cacerts</span><br><span class="line">│               │   │   └── ca.jicki.me-cert.pem</span><br><span class="line">│               │   ├── keystore</span><br><span class="line">│               │   │   └── 30d0b23ab85ede3d4424a336d839067bf7cad70f538fcf87d2a9c5083b5482f4_sk</span><br><span class="line">│               │   ├── signcerts</span><br><span class="line">│               │   │   └── Admin@jicki.me-cert.pem</span><br><span class="line">│               │   └── tlscacerts</span><br><span class="line">│               │       └── tlsca.jicki.me-cert.pem</span><br><span class="line">│               └── tls</span><br><span class="line">│                   ├── ca.crt</span><br><span class="line">│                   ├── client.crt</span><br><span class="line">│                   └── client.key</span><br><span class="line">└── peerOrganizations</span><br><span class="line">    ├── org1.jicki.me</span><br><span class="line">    │   ├── ca</span><br><span class="line">    │   │   ├── 98671ea7c42ccdeb73327d7c67f759e487497f13349b97a135392f660cf6747f_sk</span><br><span class="line">    │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   ├── msp</span><br><span class="line">    │   │   ├── admincerts</span><br><span class="line">    │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │   ├── cacerts</span><br><span class="line">    │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   ├── config.yaml</span><br><span class="line">    │   │   └── tlscacerts</span><br><span class="line">    │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   ├── peers</span><br><span class="line">    │   │   ├── peer0.org1.jicki.me</span><br><span class="line">    │   │   │   ├── msp</span><br><span class="line">    │   │   │   │   ├── admincerts</span><br><span class="line">    │   │   │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   ├── cacerts</span><br><span class="line">    │   │   │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   ├── config.yaml</span><br><span class="line">    │   │   │   │   ├── keystore</span><br><span class="line">    │   │   │   │   │   └── c99b65a414bc877998bb52c7ba80faf7e01d6512e8e50253daccd93e273bbb24_sk</span><br><span class="line">    │   │   │   │   ├── signcerts</span><br><span class="line">    │   │   │   │   │   └── peer0.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   │   └── tlscacerts</span><br><span class="line">    │   │   │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │   │   └── tls</span><br><span class="line">    │   │   │       ├── ca.crt</span><br><span class="line">    │   │   │       ├── server.crt</span><br><span class="line">    │   │   │       └── server.key</span><br><span class="line">    │   │   └── peer1.org1.jicki.me</span><br><span class="line">    │   │       ├── msp</span><br><span class="line">    │   │       │   ├── admincerts</span><br><span class="line">    │   │       │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   ├── cacerts</span><br><span class="line">    │   │       │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   ├── config.yaml</span><br><span class="line">    │   │       │   ├── keystore</span><br><span class="line">    │   │       │   │   └── f1a8262cd8c78642d0aa50eb9ac2bae98949ce937063fb8e0d0c03fb7b16e4ce_sk</span><br><span class="line">    │   │       │   ├── signcerts</span><br><span class="line">    │   │       │   │   └── peer1.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       │   └── tlscacerts</span><br><span class="line">    │   │       │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   │       └── tls</span><br><span class="line">    │   │           ├── ca.crt</span><br><span class="line">    │   │           ├── server.crt</span><br><span class="line">    │   │           └── server.key</span><br><span class="line">    │   ├── tlsca</span><br><span class="line">    │   │   ├── c4e8130e739a69e6f9628e1e98fa54326ddfdcc93ef8568ffb72ba521069f3d1_sk</span><br><span class="line">    │   │   └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │   └── users</span><br><span class="line">    │       ├── Admin@org1.jicki.me</span><br><span class="line">    │       │   ├── msp</span><br><span class="line">    │       │   │   ├── admincerts</span><br><span class="line">    │       │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   ├── cacerts</span><br><span class="line">    │       │   │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   ├── keystore</span><br><span class="line">    │       │   │   │   └── c8edb858abc7a4589458419d9ca74125830115e1e3544cc85c7a4a91f8b84b52_sk</span><br><span class="line">    │       │   │   ├── signcerts</span><br><span class="line">    │       │   │   │   └── Admin@org1.jicki.me-cert.pem</span><br><span class="line">    │       │   │   └── tlscacerts</span><br><span class="line">    │       │   │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │       │   └── tls</span><br><span class="line">    │       │       ├── ca.crt</span><br><span class="line">    │       │       ├── client.crt</span><br><span class="line">    │       │       └── client.key</span><br><span class="line">    │       └── User1@org1.jicki.me</span><br><span class="line">    │           ├── msp</span><br><span class="line">    │           │   ├── admincerts</span><br><span class="line">    │           │   │   └── User1@org1.jicki.me-cert.pem</span><br><span class="line">    │           │   ├── cacerts</span><br><span class="line">    │           │   │   └── ca.org1.jicki.me-cert.pem</span><br><span class="line">    │           │   ├── keystore</span><br><span class="line">    │           │   │   └── c720e53e25331b60bd8b33f2e19642e1ebef092afcc5f4c07f6efab91eceb298_sk</span><br><span class="line">    │           │   ├── signcerts</span><br><span class="line">    │           │   │   └── User1@org1.jicki.me-cert.pem</span><br><span class="line">    │           │   └── tlscacerts</span><br><span class="line">    │           │       └── tlsca.org1.jicki.me-cert.pem</span><br><span class="line">    │           └── tls</span><br><span class="line">    │               ├── ca.crt</span><br><span class="line">    │               ├── client.crt</span><br><span class="line">    │               └── client.key</span><br><span class="line">    └── org2.jicki.me</span><br><span class="line">        ├── ca</span><br><span class="line">        │   ├── 5e398a55ab9e021cc89f60dfc16ae21def5b35495f0621d8aa55a2463ba051f6_sk</span><br><span class="line">        │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        ├── msp</span><br><span class="line">        │   ├── admincerts</span><br><span class="line">        │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │   ├── cacerts</span><br><span class="line">        │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │   ├── config.yaml</span><br><span class="line">        │   └── tlscacerts</span><br><span class="line">        │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        ├── peers</span><br><span class="line">        │   ├── peer0.org2.jicki.me</span><br><span class="line">        │   │   ├── msp</span><br><span class="line">        │   │   │   ├── admincerts</span><br><span class="line">        │   │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   ├── cacerts</span><br><span class="line">        │   │   │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   ├── config.yaml</span><br><span class="line">        │   │   │   ├── keystore</span><br><span class="line">        │   │   │   │   └── a4eb0cf3769173e73cfcaa74ec938ef2def877b0ae0efe4e95be4a7588621da0_sk</span><br><span class="line">        │   │   │   ├── signcerts</span><br><span class="line">        │   │   │   │   └── peer0.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   │   └── tlscacerts</span><br><span class="line">        │   │   │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        │   │   └── tls</span><br><span class="line">        │   │       ├── ca.crt</span><br><span class="line">        │   │       ├── server.crt</span><br><span class="line">        │   │       └── server.key</span><br><span class="line">        │   └── peer1.org2.jicki.me</span><br><span class="line">        │       ├── msp</span><br><span class="line">        │       │   ├── admincerts</span><br><span class="line">        │       │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">        │       │   ├── cacerts</span><br><span class="line">        │       │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">        │       │   ├── config.yaml</span><br><span class="line">        │       │   ├── keystore</span><br><span class="line">        │       │   │   └── 26e3d15b68a9d2b022e6560607b3556e0150df3526826ff4a81c585714d5d41c_sk</span><br><span class="line">        │       │   ├── signcerts</span><br><span class="line">        │       │   │   └── peer1.org2.jicki.me-cert.pem</span><br><span class="line">        │       │   └── tlscacerts</span><br><span class="line">        │       │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        │       └── tls</span><br><span class="line">        │           ├── ca.crt</span><br><span class="line">        │           ├── server.crt</span><br><span class="line">        │           └── server.key</span><br><span class="line">        ├── tlsca</span><br><span class="line">        │   ├── 0979917773701392b0e7f1924ae711cedfae0dfbb4d82bd5a90c18207855fe8e_sk</span><br><span class="line">        │   └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">        └── users</span><br><span class="line">            ├── Admin@org2.jicki.me</span><br><span class="line">            │   ├── msp</span><br><span class="line">            │   │   ├── admincerts</span><br><span class="line">            │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">            │   │   ├── cacerts</span><br><span class="line">            │   │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">            │   │   ├── keystore</span><br><span class="line">            │   │   │   └── ba8e549c298b47d1889d51d75e3a01724b8d2b068da369c7319f2cd586c49e70_sk</span><br><span class="line">            │   │   ├── signcerts</span><br><span class="line">            │   │   │   └── Admin@org2.jicki.me-cert.pem</span><br><span class="line">            │   │   └── tlscacerts</span><br><span class="line">            │   │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">            │   └── tls</span><br><span class="line">            │       ├── ca.crt</span><br><span class="line">            │       ├── client.crt</span><br><span class="line">            │       └── client.key</span><br><span class="line">            └── User1@org2.jicki.me</span><br><span class="line">                ├── msp</span><br><span class="line">                │   ├── admincerts</span><br><span class="line">                │   │   └── User1@org2.jicki.me-cert.pem</span><br><span class="line">                │   ├── cacerts</span><br><span class="line">                │   │   └── ca.org2.jicki.me-cert.pem</span><br><span class="line">                │   ├── keystore</span><br><span class="line">                │   │   └── e183353072b166455f40b2b65ec168f52518101ee7097345cd8ff8864a71698e_sk</span><br><span class="line">                │   ├── signcerts</span><br><span class="line">                │   │   └── User1@org2.jicki.me-cert.pem</span><br><span class="line">                │   └── tlscacerts</span><br><span class="line">                │       └── tlsca.org2.jicki.me-cert.pem</span><br><span class="line">                └── tls</span><br><span class="line">                    ├── ca.crt</span><br><span class="line">                    ├── client.crt</span><br><span class="line">                    └── client.key</span><br><span class="line"></span><br><span class="line">125 directories, 123 files</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 这里为了方便， 将整个证书目录拷贝到其他节点里去 </span><br><span class="line"># 一般来说只需要拷贝对应的</span><br><span class="line"></span><br><span class="line">scp -r crypto-config 192.168.100.15:/opt/jicki</span><br><span class="line"></span><br><span class="line">scp -r crypto-config 192.168.100.91:/opt/jicki</span><br></pre></td></tr></table></figure>
<h2><span id="生成-hyperledger-fabric-创世区块">生成 Hyperledger Fabric 创世区块</span></h2>
<blockquote>
<p>只在第一个节点配置</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"># 这里使用 configtxgen 来创建 创世区块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 首先需要创建一个文件夹</span><br><span class="line">mkdir -p /opt/jicki/channel-artifacts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 修改 configtx.yaml 文件增加 orderer 多节点 以及 peer 多节点, 删除了 &amp;Org3 节点</span><br><span class="line"></span><br><span class="line"># 完整 configtx.yaml 如下: </span><br><span class="line"># configtx.yaml 文件格式 请千万注意 空格 与 tab 键 里的缩进，否则会报错。</span><br><span class="line"></span><br><span class="line">Organizations:</span><br><span class="line"></span><br><span class="line">    - &amp;OrdererOrg</span><br><span class="line">        Name: OrdererOrg</span><br><span class="line">        ID: OrdererMSP</span><br><span class="line">        MSPDir: crypto-config/ordererOrganizations/jicki.me/msp</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.member&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.member&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;OrdererMSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">    - &amp;Org1</span><br><span class="line">        Name: Org1MSP</span><br><span class="line">        ID: Org1MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org1.jicki.me/msp</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org1.jicki.me</span><br><span class="line">              Port: 7051</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;, &apos;Org1MSP.peer&apos;, &apos;Org1MSP.client&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;, &apos;Org1MSP.client&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org1MSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">    - &amp;Org2</span><br><span class="line">        Name: Org2MSP</span><br><span class="line">        ID: Org2MSP</span><br><span class="line">        MSPDir: crypto-config/peerOrganizations/org2.jicki.me/msp</span><br><span class="line">        AnchorPeers:</span><br><span class="line">            - Host: peer0.org2.jicki.me</span><br><span class="line">              Port: 7051</span><br><span class="line">        Policies:</span><br><span class="line">            Readers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;, &apos;Org2MSP.peer&apos;, &apos;Org2MSP.client&apos;)&quot;</span><br><span class="line">            Writers:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;, &apos;Org2MSP.client&apos;)&quot;</span><br><span class="line">            Admins:</span><br><span class="line">                Type: Signature</span><br><span class="line">                Rule: &quot;OR(&apos;Org2MSP.admin&apos;)&quot;</span><br><span class="line"></span><br><span class="line">Capabilities:</span><br><span class="line">    Global: &amp;ChannelCapabilities</span><br><span class="line">        V1_1: true</span><br><span class="line"></span><br><span class="line">    Orderer: &amp;OrdererCapabilities</span><br><span class="line">        V1_1: true</span><br><span class="line"></span><br><span class="line">    Application: &amp;ApplicationCapabilities</span><br><span class="line">        V1_2: true</span><br><span class="line"></span><br><span class="line">Application: &amp;ApplicationDefaults</span><br><span class="line"></span><br><span class="line">    Organizations:</span><br><span class="line"></span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ApplicationCapabilities</span><br><span class="line"></span><br><span class="line">Orderer: &amp;OrdererDefaults</span><br><span class="line">    OrdererType: kafka</span><br><span class="line">    Addresses:</span><br><span class="line">        - orderer0.jicki.me:7050</span><br><span class="line">        - orderer1.jicki.me:7050</span><br><span class="line">        - orderer2.jicki.me:7050</span><br><span class="line"></span><br><span class="line">    BatchTimeout: 2s</span><br><span class="line">    BatchSize:</span><br><span class="line">        MaxMessageCount: 10</span><br><span class="line">        # 设置最大的区块大小。每个区块最大有Orderer.AbsoluteMaxBytes个字节</span><br><span class="line">        # 假定这里设置的值为 99MB，记住这个值，这会影响怎样配置Kafka代理。</span><br><span class="line">        AbsoluteMaxBytes: 99 MB</span><br><span class="line">        # 设置每个区块建议的大小。Kafka对于相对小的消息提供更高的吞吐量。</span><br><span class="line">        # 区块大小最好不要超过1MB。</span><br><span class="line">        PreferredMaxBytes: 512 KB</span><br><span class="line">    Kafka:</span><br><span class="line">        Brokers:</span><br><span class="line">        # 这里如果非容器内建议使用 [ip:port]配置kafka 集群。</span><br><span class="line">        # 如下为 单机版本集群内的配置。</span><br><span class="line">        # kafka 集群最少为3节点, 建议配置4个以上。</span><br><span class="line">            - kafka0:9092</span><br><span class="line">            - kafka1:9092</span><br><span class="line">            - kafka2:9092</span><br><span class="line">    Organizations:</span><br><span class="line">    </span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line">        BlockValidation:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *OrdererCapabilities</span><br><span class="line"></span><br><span class="line">Channel: &amp;ChannelDefaults</span><br><span class="line"></span><br><span class="line">    Policies:</span><br><span class="line">        Readers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Readers&quot;</span><br><span class="line">        Writers:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;ANY Writers&quot;</span><br><span class="line">        Admins:</span><br><span class="line">            Type: ImplicitMeta</span><br><span class="line">            Rule: &quot;MAJORITY Admins&quot;</span><br><span class="line"></span><br><span class="line">    Capabilities:</span><br><span class="line">        &lt;&lt;: *ChannelCapabilities</span><br><span class="line"></span><br><span class="line">Profiles:</span><br><span class="line"></span><br><span class="line">    TwoOrgsOrdererGenesis:</span><br><span class="line">        &lt;&lt;: *ChannelDefaults</span><br><span class="line">        Orderer:</span><br><span class="line">            &lt;&lt;: *OrdererDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *OrdererOrg</span><br><span class="line">        Consortiums:</span><br><span class="line">            SampleConsortium:</span><br><span class="line">                Organizations:</span><br><span class="line">                    - *Org1</span><br><span class="line">                    - *Org2</span><br><span class="line">    TwoOrgsChannel:</span><br><span class="line">        Consortium: SampleConsortium</span><br><span class="line">        Application:</span><br><span class="line">            &lt;&lt;: *ApplicationDefaults</span><br><span class="line">            Organizations:</span><br><span class="line">                - *Org1</span><br><span class="line">                - *Org2</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 创建 创世区块  TwoOrgsOrdererGenesis 名称为 configtx.yaml 中 Profiles 字段下的</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-07-24 14:17:28.681 CST [common/tools/configtxgen] main -&gt; WARN 001 Omitting the channel ID for configtxgen is deprecated.  Explicitly passing the channel ID will be required in the future, defaulting to &apos;testchainid&apos;.</span><br><span class="line">2018-07-24 14:17:28.681 CST [common/tools/configtxgen] main -&gt; INFO 002 Loading configuration</span><br><span class="line">2018-07-24 14:17:28.726 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs</span><br><span class="line">2018-07-24 14:17:28.727 CST [msp] getMspConfig -&gt; INFO 004 Loading NodeOUs</span><br><span class="line">2018-07-24 14:17:28.727 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 005 Generating genesis block</span><br><span class="line">2018-07-24 14:17:28.728 CST [common/tools/configtxgen] doOutputBlock -&gt; INFO 006 Writing genesis block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创世区块 是在 orderer 服务中使用</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt channel-artifacts/</span><br><span class="line">总用量 16</span><br><span class="line">-rw-r--r-- 1 root root 12484 7月  24 14:17 genesis.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 下面来生成一个 peer 服务 中使用的 tx 文件 TwoOrgsChannel 名称为 configtx.yaml 中 Profiles 字段下的，这里必须指定上面的 channelID</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-07-24 14:18:02.261 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-07-24 14:18:02.306 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx</span><br><span class="line">2018-07-24 14:18:02.307 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs</span><br><span class="line">2018-07-24 14:18:02.308 CST [msp] getMspConfig -&gt; INFO 004 Loading NodeOUs</span><br><span class="line">2018-07-24 14:18:02.311 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Writing new channel tx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt channel-artifacts/</span><br><span class="line">总用量 20</span><br><span class="line">-rw-r--r-- 1 root root   346 7月  24 14:18 channel.tx</span><br><span class="line">-rw-r--r-- 1 root root 12484 7月  24 14:17 genesis.block</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 定义组织 生成锚节点更新文件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Org1MSP</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID mychannel -asOrg Org1MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-07-24 14:18:02.261 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-07-24 14:18:02.306 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 002 Generating new channel configtx</span><br><span class="line">2018-07-24 14:18:02.307 CST [msp] getMspConfig -&gt; INFO 003 Loading NodeOUs</span><br><span class="line">2018-07-24 14:18:02.308 CST [msp] getMspConfig -&gt; INFO 004 Loading NodeOUs</span><br><span class="line">2018-07-24 14:18:02.311 CST [common/tools/configtxgen] doOutputChannelCreateTx -&gt; INFO 005 Writing new channel tx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># Org2MSP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID mychannel -asOrg Org2MSP</span><br><span class="line"></span><br><span class="line">2018-07-24 14:19:21.947 CST [common/tools/configtxgen] main -&gt; INFO 001 Loading configuration</span><br><span class="line">2018-07-24 14:19:21.993 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 002 Generating anchor peer update</span><br><span class="line">2018-07-24 14:19:21.993 CST [common/tools/configtxgen] doOutputAnchorPeersUpdate -&gt; INFO 003 Writing anchor peer update</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 拷贝 channel-artifacts 目录到其他节点</span><br><span class="line"></span><br><span class="line">scp -r channel-artifacts 192.168.100.15:/opt/jicki</span><br><span class="line"></span><br><span class="line">scp -r channel-artifacts 192.168.100.91:/opt/jicki</span><br></pre></td></tr></table></figure>
<h2><span id="配置-zookeeper-kafka-集群">配置 Zookeeper Kafka 集群</span></h2>
<blockquote>
<p>zookeeper 与 kafka 集群 必须在 所有服务器之间启动。</p>
</blockquote>
<h3><span id="第一个节点-19216810067">第一个节点 (192.168.100.67)</span></h3>
<blockquote>
<p>ZOO_SERVERS 本机因为在 docker 里，需要配置为 0.0.0.0:2888:3888</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose-zk-kafka.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  zookeeper0:</span><br><span class="line">    container_name: zookeeper0</span><br><span class="line">    hostname: zookeeper0</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=1</span><br><span class="line">      - ZOO_SERVERS=server.1=0.0.0.0:2888:3888 server.2=zookeeper1:2888:3888 server.3=zookeeper2:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper0/data:/data</span><br><span class="line">    #- ./data/zookeeper0/datalog:/datalog</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.67:2181:2181 </span><br><span class="line">      - 192.168.100.67:2888:2888</span><br><span class="line">      - 192.168.100.67:3888:3888</span><br><span class="line">      extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      </span><br><span class="line">  kafka0:</span><br><span class="line">    container_name: kafka0</span><br><span class="line">    hostname: kafka0</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=1</span><br><span class="line">      # 设置一个M值,数据提交时会写入至少M个副本(这里M=2)（这些数据会被同步并且归属到in-sync 副本集合或ISR）M 必须小于 如下 N 值,并且大于1,既最小为2。</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      # 设置一个N值, N代表着每个channel都保存N个副本的数据到Kafka的代理上。N 必须大于如上 M 值, 既 N 值最小值为 3。</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181</span><br><span class="line">      # 如下99为configtx.yaml中会设置最大的区块大小(参考configtx.yaml中AbsoluteMaxBytes参数)</span><br><span class="line">      # 每个区块最大有Orderer.AbsoluteMaxBytes个字节</span><br><span class="line">      # 99 * 1024 * 1024 B</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      # 每个通道获取的消息的字节数 如上一样</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      # 数据一致性在区块链环境中是至关重要的, 我们不能从in-sync 副本（ISR）集合之外选取channel leader , 否则我们将会面临对于之前的leader产生的offsets覆盖的风险</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      # 关闭基于时间的日志保留方式并且避免分段到期。</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka0/data:/data</span><br><span class="line">    #- ./data/kafka0/data:/logs</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.67:9092:9092</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper0</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      - &quot;kafka0:192.168.100.67&quot;</span><br><span class="line">      - &quot;kafka1:192.168.100.15&quot;</span><br><span class="line">      - &quot;kafka2:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="第二个节点-19216810015">第二个节点 (192.168.100.15)</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose-zk-kafka.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  zookeeper1:</span><br><span class="line">    container_name: zookeeper1</span><br><span class="line">    hostname: zookeeper1</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=2</span><br><span class="line">      - ZOO_SERVERS=server.1=zookeeper0:2888:3888 server.2=0.0.0.0:2888:3888 server.3=zookeeper2:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper1/data:/data</span><br><span class="line">    #- ./data/zookeeper1/datalog:/datalog</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.15:2181:2181</span><br><span class="line">      - 192.168.100.15:2888:2888</span><br><span class="line">      - 192.168.100.15:3888:3888</span><br><span class="line">     extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      </span><br><span class="line">  kafka1:</span><br><span class="line">    container_name: kafka1</span><br><span class="line">    hostname: kafka1</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=2</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka1/data:/data</span><br><span class="line">    #- ./data/kafka1/data:/logs</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.15:9092:9092</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper1</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      - &quot;kafka0:192.168.100.67&quot;</span><br><span class="line">      - &quot;kafka1:192.168.100.15&quot;</span><br><span class="line">      - &quot;kafka2:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="第三个节点-19216810091">第三个节点 (192.168.100.91)</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">vi docker-compose-zk-kafka.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  zookeeper2:</span><br><span class="line">    container_name: zookeeper2</span><br><span class="line">    hostname: zookeeper2</span><br><span class="line">    image: zookeeper</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - ZOO_MY_ID=3</span><br><span class="line">      - ZOO_SERVERS=server.1=zookeeper0:2888:3888 server.2=zookeeper1:2888:3888 server.3=0.0.0.0:2888:3888</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志</span><br><span class="line">    #- ./data/zookeeper2/data:/data</span><br><span class="line">    #- ./data/zookeeper2/datalog:/datalog</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.91:2181:2181</span><br><span class="line">      - 192.168.100.91:2888:2888</span><br><span class="line">      - 192.168.100.91:3888:3888</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      </span><br><span class="line">  kafka2:</span><br><span class="line">    container_name: kafka2</span><br><span class="line">    hostname: kafka2</span><br><span class="line">    image: hyperledger/fabric-kafka</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      - KAFKA_BROKER_ID=3</span><br><span class="line">      - KAFKA_MIN_INSYNC_REPLICAS=2</span><br><span class="line">      - KAFKA_DEFAULT_REPLICATION_FACTOR=3</span><br><span class="line">      - KAFKA_ZOOKEEPER_CONNECT=zookeeper0:2181,zookeeper1:2181,zookeeper2:2181</span><br><span class="line">      - KAFKA_MESSAGE_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_REPLICA_FETCH_MAX_BYTES=103809024</span><br><span class="line">      - KAFKA_UNCLEAN_LEADER_ELECTION_ENABLE=false</span><br><span class="line">      - KAFKA_LOG_RETENTION_MS=-1</span><br><span class="line">    #volumes:</span><br><span class="line">    # 存储数据与日志.</span><br><span class="line">    #- ./data/kafka2/data:/data</span><br><span class="line">    #- ./data/kafka2/data:/logs</span><br><span class="line">    ports:</span><br><span class="line">      - 192.168.100.91:9092:9092</span><br><span class="line">    depends_on:</span><br><span class="line">      - zookeeper2</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      - &quot;kafka0:192.168.100.67&quot;</span><br><span class="line">      - &quot;kafka1:192.168.100.15&quot;</span><br><span class="line">      - &quot;kafka2:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 分别启动服务</span><br><span class="line"></span><br><span class="line">docker-compose -f docker-compose-zk-kafka.yaml up -d</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-orderer">配置 Hyperledger Fabric Orderer</span></h2>
<h3><span id="第一个节点-19216810067">第一个节点 (192.168.100.67)</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># 创建文件 docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"># 创建于 /opt/jicki 目录下</span><br><span class="line"></span><br><span class="line">vi  docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  orderer0.jicki.me:</span><br><span class="line">    container_name: orderer0.jicki.me</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      # - ORDERER_GENERAL_LOGLEVEL=error</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050</span><br><span class="line">      #- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=ram</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=file</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=false</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span><br><span class="line"></span><br><span class="line">      # KAFKA</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGTOTAL=100s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">    - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp:/var/hyperledger/orderer/msp</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      - &quot;kafka0:192.168.100.67&quot;</span><br><span class="line">      - &quot;kafka1:192.168.100.15&quot;</span><br><span class="line">      - &quot;kafka2:192.168.100.91&quot;</span><br><span class="line">      </span><br><span class="line">```      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 第二个节点 (192.168.100.15)</span><br></pre></td></tr></table></figure>
<h1><span id="创建文件-docker-compose-ordereryaml">创建文件 docker-compose-orderer.yaml</span></h1>
<h1><span id="创建于-optjicki-目录下">创建于 /opt/jicki 目录下</span></h1>
<p>vi  docker-compose-orderer.yaml</p>
<p>version: '2’<br>
services:<br>
<a href="http://orderer1.jicki.me" target="_blank" rel="noopener">orderer1.jicki.me</a>:<br>
container_name: <a href="http://orderer1.jicki.me" target="_blank" rel="noopener">orderer1.jicki.me</a><br>
image: hyperledger/fabric-orderer<br>
environment:<br>
- CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default<br>
# - ORDERER_GENERAL_LOGLEVEL=error<br>
- ORDERER_GENERAL_LOGLEVEL=debug<br>
- ORDERER_GENERAL_LISTENADDRESS=0.0.0.0<br>
- ORDERER_GENERAL_LISTENPORT=7050<br>
#- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis<br>
- ORDERER_GENERAL_GENESISMETHOD=file<br>
- ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block<br>
- ORDERER_GENERAL_LOCALMSPID=OrdererMSP<br>
- ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp<br>
#- ORDERER_GENERAL_LEDGERTYPE=ram<br>
#- ORDERER_GENERAL_LEDGERTYPE=file<br>
# enabled TLS<br>
- ORDERER_GENERAL_TLS_ENABLED=false<br>
- ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key<br>
- ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt<br>
- ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</p>
<pre><code>  # KAFKA
  - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s
  - ORDERER_KAFKA_RETRY_LONGTOTAL=100s
  - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s
  - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s
  - ORDERER_KAFKA_VERBOSE=true
  - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]
working_dir: /opt/gopath/src/github.com/hyperledger/fabric
command: orderer
volumes:
- ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block
- ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer1.jicki.me/msp:/var/hyperledger/orderer/msp
- ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer1.jicki.me/tls/:/var/hyperledger/orderer/tls
ports:
  - 7050:7050
extra_hosts:
  - &quot;zookeeper0:192.168.100.67&quot;
  - &quot;zookeeper1:192.168.100.15&quot;
  - &quot;zookeeper2:192.168.100.91&quot;
  - &quot;kafka0:192.168.100.67&quot;
  - &quot;kafka1:192.168.100.15&quot;
  - &quot;kafka2:192.168.100.91&quot;
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">### 第三个节点 (192.168.100.91)</span><br><span class="line"></span><br><span class="line">```   </span><br><span class="line"># 创建文件 docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"># 创建于 /opt/jicki 目录下</span><br><span class="line"></span><br><span class="line">vi  docker-compose-orderer.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  orderer2.jicki.me:</span><br><span class="line">    container_name: orderer2.jicki.me</span><br><span class="line">    image: hyperledger/fabric-orderer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      # - ORDERER_GENERAL_LOGLEVEL=error</span><br><span class="line">      - ORDERER_GENERAL_LOGLEVEL=debug</span><br><span class="line">      - ORDERER_GENERAL_LISTENADDRESS=0.0.0.0</span><br><span class="line">      - ORDERER_GENERAL_LISTENPORT=7050</span><br><span class="line">      #- ORDERER_GENERAL_GENESISPROFILE=AntiMothOrdererGenesis</span><br><span class="line">      - ORDERER_GENERAL_GENESISMETHOD=file</span><br><span class="line">      - ORDERER_GENERAL_GENESISFILE=/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPID=OrdererMSP</span><br><span class="line">      - ORDERER_GENERAL_LOCALMSPDIR=/var/hyperledger/orderer/msp</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=ram</span><br><span class="line">      #- ORDERER_GENERAL_LEDGERTYPE=file</span><br><span class="line">      # enabled TLS</span><br><span class="line">      - ORDERER_GENERAL_TLS_ENABLED=false</span><br><span class="line">      - ORDERER_GENERAL_TLS_PRIVATEKEY=/var/hyperledger/orderer/tls/server.key</span><br><span class="line">      - ORDERER_GENERAL_TLS_CERTIFICATE=/var/hyperledger/orderer/tls/server.crt</span><br><span class="line">      - ORDERER_GENERAL_TLS_ROOTCAS=[/var/hyperledger/orderer/tls/ca.crt]</span><br><span class="line">      </span><br><span class="line">      # KAFKA</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGINTERVAL=10s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_LONGTOTAL=100s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTINTERVAL=1s</span><br><span class="line">      - ORDERER_KAFKA_RETRY_SHORTTOTAL=30s</span><br><span class="line">      - ORDERER_KAFKA_VERBOSE=true</span><br><span class="line">      - ORDERER_KAFKA_BROKERS=[kafka0:9092,kafka1:9092,kafka2:9092]</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric</span><br><span class="line">    command: orderer</span><br><span class="line">    volumes:</span><br><span class="line">    - ./channel-artifacts/genesis.block:/var/hyperledger/orderer/orderer.genesis.block</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer2.jicki.me/msp:/var/hyperledger/orderer/msp</span><br><span class="line">    - ./crypto-config/ordererOrganizations/jicki.me/orderers/orderer2.jicki.me/tls/:/var/hyperledger/orderer/tls</span><br><span class="line">    ports:</span><br><span class="line">      - 7050:7050</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;zookeeper0:192.168.100.67&quot;</span><br><span class="line">      - &quot;zookeeper1:192.168.100.15&quot;</span><br><span class="line">      - &quot;zookeeper2:192.168.100.91&quot;</span><br><span class="line">      - &quot;kafka0:192.168.100.67&quot;</span><br><span class="line">      - &quot;kafka1:192.168.100.15&quot;</span><br><span class="line">      - &quot;kafka2:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<blockquote>
<p>所有节点启动服务</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-orderer.yaml up -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 启动完毕，查看docker logs 如下表示成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 2fd [channel: testchainid] Successfully unmarshalled consumed message, offset is 0. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 2fe [channel: testchainid] It&apos;s a connect message - ignoring</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 2ff [channel: testchainid] Successfully unmarshalled consumed message, offset is 1. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 300 [channel: testchainid] It&apos;s a connect message - ignoring</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processMessagesToBlocks -&gt; DEBU 301 [channel: testchainid] Successfully unmarshalled consumed message, offset is 2. Inspecting type...</span><br><span class="line">2018-08-07 01:42:14.431 UTC [orderer/consensus/kafka] processConnect -&gt; DEBU 302 [channel: testchainid] It&apos;s a connect message - ignoring</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-peer">配置 Hyperledger Fabric peer</span></h2>
<blockquote>
<p>节点下都必须启动一个数据存储，如 file 或者 couchdb 等</p>
</blockquote>
<h3><span id="第二个节点-19216810015">第二个节点 (192.168.100.15)</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">vi  docker-compose-peer.yaml</span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  couchdb0:</span><br><span class="line">    container_name: couchdb0</span><br><span class="line">    image: hyperledger/fabric-couchdb</span><br><span class="line">    environment:</span><br><span class="line">      - COUCHDB_USER=</span><br><span class="line">      - COUCHDB_PASSWORD=</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5984:5984&quot;</span><br><span class="line">    #volumes:</span><br><span class="line">      # 数据持久化，用于存储链码值</span><br><span class="line">      #- ./data/couchdb0/data:/opt/couchdb/data</span><br><span class="line">      </span><br><span class="line">  peer0.org1.jicki.me:</span><br><span class="line">    container_name: peer0.org1.jicki.me</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="line">      - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb0:5984</span><br><span class="line">      </span><br><span class="line">      - CORE_PEER_ID=peer0.org1.jicki.me</span><br><span class="line">      - CORE_PEER_NETWORKID=jicki</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org1.jicki.me:7052</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line"></span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true</span><br><span class="line">      - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">      - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">      - CORE_PEER_PROFILE_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">        - ./crypto-config/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">        # 数据持久化, 存储安装，以及实例化智能合约的数据</span><br><span class="line">        - ./data/peer0org1:/var/hyperledger/production</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    depends_on:</span><br><span class="line">      - couchdb0</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;couchdb0:192.168.100.15&quot;</span><br><span class="line">      - &quot;orderer0.jicki.me:192.168.100.67&quot;</span><br><span class="line">      - &quot;orderer1.jicki.me:192.168.100.15&quot;</span><br><span class="line">      - &quot;orderer2.jicki.me:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="第三个节点-19216810091">第三个节点 (192.168.100.91)</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">vi  docker-compose-peer.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  couchdb1:</span><br><span class="line">    container_name: couchdb1</span><br><span class="line">    image: hyperledger/fabric-couchdb</span><br><span class="line">    environment:</span><br><span class="line">      - COUCHDB_USER=</span><br><span class="line">      - COUCHDB_PASSWORD=</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5984:5984&quot;</span><br><span class="line">    #volumes:</span><br><span class="line">      # 数据持久化，用于存储链码值</span><br><span class="line">      #- ./data/couchdb1/data:/opt/couchdb/data</span><br><span class="line">      </span><br><span class="line">  peer0.org2.jicki.me:</span><br><span class="line">    container_name: peer0.org2.jicki.me</span><br><span class="line">    image: hyperledger/fabric-peer</span><br><span class="line">    environment:</span><br><span class="line">      - CORE_LEDGER_STATE_STATEDATABASE=CouchDB</span><br><span class="line">      - CORE_LEDGER_STATE_COUCHDBCONFIG_COUCHDBADDRESS=couchdb1:5984</span><br><span class="line">      </span><br><span class="line">      - CORE_PEER_ID=peer0.org2.jicki.me</span><br><span class="line">      - CORE_PEER_NETWORKID=jicki</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">      - CORE_PEER_CHAINCODELISTENADDRESS=peer0.org2.jicki.me:7052</span><br><span class="line">      - CORE_PEER_GOSSIP_EXTERNALENDPOINT=peer0.org2.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org2MSP</span><br><span class="line"></span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_VM_DOCKER_HOSTCONFIG_NETWORKMODE=jicki_default</span><br><span class="line">      - CORE_PEER_GOSSIP_SKIPHANDSHAKE=true</span><br><span class="line">      - CORE_PEER_GOSSIP_USELEADERELECTION=true</span><br><span class="line">      - CORE_PEER_GOSSIP_ORGLEADER=false</span><br><span class="line">      - CORE_PEER_PROFILE_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/etc/hyperledger/fabric/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/etc/hyperledger/fabric/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/tls/ca.crt</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/msp:/etc/hyperledger/fabric/msp</span><br><span class="line">        - ./crypto-config/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls:/etc/hyperledger/fabric/tls</span><br><span class="line">        # 数据持久化, 存储安装，以及实例化智能合约的数据</span><br><span class="line">        - ./data/peer0org2:/var/hyperledger/production</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    command: peer node start</span><br><span class="line">    ports:</span><br><span class="line">      - 7051:7051</span><br><span class="line">      - 7052:7052</span><br><span class="line">      - 7053:7053</span><br><span class="line">    depends_on:</span><br><span class="line">      - couchdb1</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;couchdb1:192.168.100.91&quot;</span><br><span class="line">      - &quot;orderer0.jicki.me:192.168.100.67&quot;</span><br><span class="line">      - &quot;orderer1.jicki.me:192.168.100.15&quot;</span><br><span class="line">      - &quot;orderer2.jicki.me:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-peer.yaml up -d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看 docker logs 输出如下, 既为成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第二个节点</span><br><span class="line"></span><br><span class="line">2018-08-07 02:05:20.638 UTC [discovery] NewService -&gt; INFO 122 Created with config TLS: false, authCacheMaxSize: 1000, authCachePurgeRatio: 0.750000</span><br><span class="line">2018-08-07 02:05:20.638 UTC [nodeCmd] registerDiscoveryService -&gt; INFO 123 Discovery service activated</span><br><span class="line">2018-08-07 02:05:20.638 UTC [nodeCmd] serve -&gt; INFO 124 Starting peer with ID=[name:&quot;peer0.org1.jicki.me&quot; ], network ID=[jicki], address=[peer0.org1.jicki.me:7051]</span><br><span class="line">2018-08-07 02:05:20.638 UTC [nodeCmd] serve -&gt; INFO 125 Started peer with ID=[name:&quot;peer0.org1.jicki.me&quot; ], network ID=[jicki], address=[peer0.org1.jicki.me:7051]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 第三个节点</span><br><span class="line"></span><br><span class="line">2018-08-07 02:07:23.628 UTC [discovery] NewService -&gt; INFO 133 Created with config TLS: false, authCacheMaxSize: 1000, authCachePurgeRatio: 0.750000</span><br><span class="line">2018-08-07 02:07:23.628 UTC [nodeCmd] registerDiscoveryService -&gt; INFO 134 Discovery service activated</span><br><span class="line">2018-08-07 02:07:23.628 UTC [nodeCmd] serve -&gt; INFO 135 Starting peer with ID=[name:&quot;peer0.org2.jicki.me&quot; ], network ID=[jicki], address=[peer0.org2.jicki.me:7051]</span><br><span class="line">2018-08-07 02:07:23.628 UTC [nodeCmd] serve -&gt; INFO 136 Started peer with ID=[name:&quot;peer0.org2.jicki.me&quot; ], network ID=[jicki], address=[peer0.org2.jicki.me:7051]</span><br></pre></td></tr></table></figure>
<h2><span id="配置-hyperledger-fabric-cli-客户端">配置 Hyperledger Fabric cli 客户端</span></h2>
<blockquote>
<p>客户端服务，只需要配置一个既可，这里配置再 第一个节点中，用于调用创建 channel 与 智能合约</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vi  docker-compose-cli.yaml</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">version: &apos;2&apos;</span><br><span class="line">services:</span><br><span class="line">  cli:</span><br><span class="line">    container_name: cli</span><br><span class="line">    image: hyperledger/fabric-tools</span><br><span class="line">    tty: true</span><br><span class="line">    environment:</span><br><span class="line">      - GOPATH=/opt/gopath</span><br><span class="line">      - CORE_VM_ENDPOINT=unix:///host/var/run/docker.sock</span><br><span class="line">      # - CORE_LOGGING_LEVEL=ERROR</span><br><span class="line">      - CORE_LOGGING_LEVEL=DEBUG</span><br><span class="line">      - CORE_PEER_ID=cli</span><br><span class="line">      - CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">      - CORE_PEER_LOCALMSPID=Org1MSP</span><br><span class="line">      - CORE_PEER_TLS_ENABLED=false</span><br><span class="line">      - CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/server.crt</span><br><span class="line">      - CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/server.key</span><br><span class="line">      - CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line">      - CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp</span><br><span class="line">    working_dir: /opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">    volumes:</span><br><span class="line">        - /var/run/:/host/var/run/</span><br><span class="line">        - /opt/golang/go:/opt/go</span><br><span class="line">        - /opt/gopath:/opt/gopath</span><br><span class="line">        - ./peer:/opt/gopath/src/github.com/hyperledger/fabric/peer</span><br><span class="line">        - ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line">        - ./crypto-config:/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/</span><br><span class="line">        - ./channel-artifacts:/opt/gopath/src/github.com/hyperledger/fabric/peer/channel-artifacts</span><br><span class="line">    extra_hosts:</span><br><span class="line">      - &quot;orderer0.jicki.me:192.168.100.67&quot;</span><br><span class="line">      - &quot;orderer1.jicki.me:192.168.100.15&quot;</span><br><span class="line">      - &quot;orderer2.jicki.me:192.168.100.91&quot;</span><br><span class="line">      - &quot;peer0.org1.jicki.me:192.168.100.15&quot;</span><br><span class="line">      - &quot;peer0.org2.jicki.me:192.168.100.91&quot;</span><br></pre></td></tr></table></figure>
<h3><span id="启动服务">启动服务</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -f docker-compose-cli.yaml up -d</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-创建-channel">Hyperledger Fabric 创建 Channel</span></h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 上面我们创建了 cli 容器，我们可以直接进入 容器里操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# docker exec -it cli bash</span><br><span class="line">root@77962643125a:/opt/gopath/src/github.com/hyperledger/fabric/peer# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 执行 创建命令 (未启动 认证)</span><br><span class="line"></span><br><span class="line">peer channel create -c mychannel -f ./channel-artifacts/channel.tx --orderer orderer0.jicki.me:7050</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 以下为启用认证</span><br><span class="line"></span><br><span class="line">peer channel create -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/channel.tx --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:20:49.574 UTC [grpc] Printf -&gt; DEBU 094 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:20:49.574 UTC [grpc] Printf -&gt; DEBU 095 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:20:49.574 UTC [grpc] Printf -&gt; DEBU 096 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:20:49.574 UTC [grpc] Printf -&gt; DEBU 097 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:20:49.574 UTC [grpc] Printf -&gt; DEBU 098 pickfirstBalancer: HandleSubConnStateChange: 0xc420281c80, CONNECTING</span><br><span class="line">2018-08-07 02:20:49.575 UTC [grpc] Printf -&gt; DEBU 099 pickfirstBalancer: HandleSubConnStateChange: 0xc420281c80, READY</span><br><span class="line">2018-08-07 02:20:49.575 UTC [channelCmd] InitCmdFactory -&gt; INFO 09a Endorser and orderer connections initialized</span><br><span class="line">2018-08-07 02:20:49.775 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 09b Obtaining default signing identity</span><br><span class="line">2018-08-07 02:20:49.775 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 09c Obtaining default signing identity</span><br><span class="line">2018-08-07 02:20:49.775 UTC [msp/identity] Sign -&gt; DEBU 09d Sign: plaintext: 0AD1060A1508051A06088184A4DB0522...2FB3601B298B12080A021A0012021A00 </span><br><span class="line">2018-08-07 02:20:49.775 UTC [msp/identity] Sign -&gt; DEBU 09e Sign: digest: DE4E562C31BC2BA09C70978648AAE7EC6F81BC49BF5D6AE8760FD64B84F3541C </span><br><span class="line">2018-08-07 02:20:49.777 UTC [cli/common] readBlock -&gt; INFO 09f Received block: 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 创建以后生成文件 mychannel.block</span><br><span class="line"></span><br><span class="line">total 24</span><br><span class="line">-rw-r--r-- 1 root root 15382 Aug  7 02:20 mychannel.block</span><br><span class="line">drwxr-xr-x 2 root root  4096 Aug  6 09:16 channel-artifacts</span><br><span class="line">drwxr-xr-x 4 root root  4096 Aug  6 06:45 crypto</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-加入-channel">Hyperledger Fabric 加入 Channel</span></h2>
<blockquote>
<p>我们这边有2个 peer 所以需要分别加入, 后续有多少个 peer 都需要加入到 Channel 中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># peer0.org1.jicki.me 加入 此 channel 中，首先需要查看如下 环境变量</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo $CORE_PEER_LOCALMSPID</span><br><span class="line">echo $CORE_PEER_ADDRESS</span><br><span class="line">echo $CORE_PEER_MSPCONFIGPATH</span><br><span class="line">echo $CORE_PEER_TLS_ROOTCERT_FILE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加入 channel</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下: </span><br><span class="line"></span><br><span class="line">2018-08-07 02:31:52.810 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:31:52.811 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:31:52.811 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:31:52.811 UTC [grpc] Printf -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:31:52.811 UTC [grpc] Printf -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:31:52.811 UTC [grpc] Printf -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:31:52.811 UTC [grpc] Printf -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:31:52.811 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4203cb530, CONNECTING</span><br><span class="line">2018-08-07 02:31:52.812 UTC [grpc] Printf -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc4203cb530, READY</span><br><span class="line">2018-08-07 02:31:52.812 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-08-07 02:31:52.813 UTC [msp/identity] Sign -&gt; DEBU 03f Sign: plaintext: 0A98070A5C08011A0C089889A4DB0510...131231D39FB81A080A000A000A000A00 </span><br><span class="line">2018-08-07 02:31:52.813 UTC [msp/identity] Sign -&gt; DEBU 040 Sign: digest: E9D23EC60B2EDFA54AD140AB09299DCF3FA11A657D85743E58A15BC02FE38743 </span><br><span class="line">2018-08-07 02:31:52.902 UTC [channelCmd] executeJoin -&gt; INFO 041 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># peer1.org2.jicki.me 加入 此 channel 中，这里配置一下环境变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加入 channel</span><br><span class="line"></span><br><span class="line">peer channel join -b mychannel.block</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输入如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:32:23.864 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:32:23.864 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-08-07 02:32:23.865 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:32:23.865 UTC [grpc] Printf -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:32:23.865 UTC [grpc] Printf -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:32:23.865 UTC [grpc] Printf -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:32:23.865 UTC [grpc] Printf -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:32:23.865 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc420ca8bf0, CONNECTING</span><br><span class="line">2018-08-07 02:32:23.866 UTC [grpc] Printf -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc420ca8bf0, READY</span><br><span class="line">2018-08-07 02:32:23.866 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-08-07 02:32:23.867 UTC [msp/identity] Sign -&gt; DEBU 03f Sign: plaintext: 0A98070A5C08011A0C08B789A4DB0510...131231D39FB81A080A000A000A000A00 </span><br><span class="line">2018-08-07 02:32:23.867 UTC [msp/identity] Sign -&gt; DEBU 040 Sign: digest: 620FDAF5EA0CAC6FB6FEC4B16910082B6E471EA03688AB0095A71DC58F280E0B </span><br><span class="line">2018-08-07 02:32:23.955 UTC [channelCmd] executeJoin -&gt; INFO 041 Successfully submitted proposal to join channel</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-锚节点">Hyperledger Fabric 锚节点</span></h2>
<blockquote>
<p>锚节点通过广播的方式通知有新节点加入</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"># 使用Org1的管理员身份更新锚节点配置 </span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 未开启认证的方式</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 开启认证的方式</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/Org1MSPanchors.tx --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:45:16.093 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:45:16.093 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:45:16.093 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:16.093 UTC [grpc] Printf -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:45:16.093 UTC [grpc] Printf -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:45:16.093 UTC [grpc] Printf -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:45:16.093 UTC [grpc] Printf -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:45:16.093 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4201fe5e0, CONNECTING</span><br><span class="line">2018-08-07 02:45:16.094 UTC [grpc] Printf -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc4201fe5e0, READY</span><br><span class="line">2018-08-07 02:45:16.094 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 03f Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 040 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp/identity] Sign -&gt; DEBU 041 Sign: plaintext: 0A9A060A074F7267314D5350128E062D...2A0641646D696E732A0641646D696E73 </span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp/identity] Sign -&gt; DEBU 042 Sign: digest: B9EBDD95115ECC8722C7E5D917CE7AB428AF8F7921A55D01D988488B24EBCA64 </span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 044 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AD1060A1508021A0608BC8FA4DB0522...223072D3C517446F35F9431FCE53B9AD </span><br><span class="line">2018-08-07 02:45:16.094 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: 6B483C98171C37B2FBD318E27AC73DD68277C3719CAA04719225672B028ABABD </span><br><span class="line">2018-08-07 02:45:16.094 UTC [grpc] Printf -&gt; DEBU 047 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:45:16.094 UTC [grpc] Printf -&gt; DEBU 048 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:45:16.094 UTC [grpc] Printf -&gt; DEBU 049 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:45:16.094 UTC [grpc] Printf -&gt; DEBU 04a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:45:16.095 UTC [grpc] Printf -&gt; DEBU 04b pickfirstBalancer: HandleSubConnStateChange: 0xc4201fef50, CONNECTING</span><br><span class="line">2018-08-07 02:45:16.095 UTC [grpc] Printf -&gt; DEBU 04c pickfirstBalancer: HandleSubConnStateChange: 0xc4201fef50, READY</span><br><span class="line">2018-08-07 02:45:16.214 UTC [channelCmd] update -&gt; INFO 04d Successfully submitted channel update</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 使用Org2的管理员身份更新锚节点配置 </span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 未开启认证的方式</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 开启认证的方式</span><br><span class="line"></span><br><span class="line">peer channel update -o orderer0.jicki.me:7050 -c mychannel -f ./channel-artifacts/Org2MSPanchors.tx --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:45:36.285 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:45:36.285 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-08-07 02:45:36.286 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 037 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 038 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 039 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 03a ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 03b ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42025a560, CONNECTING</span><br><span class="line">2018-08-07 02:45:36.286 UTC [grpc] Printf -&gt; DEBU 03d pickfirstBalancer: HandleSubConnStateChange: 0xc42025a560, READY</span><br><span class="line">2018-08-07 02:45:36.287 UTC [channelCmd] InitCmdFactory -&gt; INFO 03e Endorser and orderer connections initialized</span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 03f Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 040 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp/identity] Sign -&gt; DEBU 041 Sign: plaintext: 0A9A060A074F7267324D5350128E062D...2A0641646D696E732A0641646D696E73 </span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp/identity] Sign -&gt; DEBU 042 Sign: digest: 1A11594F70194B6D24D4D5416310F049D0D292447F3A9624AC3612F36E2CA424 </span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 044 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AD1060A1508021A0608D08FA4DB0522...C2F2ED2EF0B45937BFCDDE5333EED203 </span><br><span class="line">2018-08-07 02:45:36.287 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: 8130CD8476B357A487219831107C06F93DC8AE12DF9CB2EB04BB199802467E58 </span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 047 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 048 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 049 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 04a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 04b pickfirstBalancer: HandleSubConnStateChange: 0xc42025aed0, CONNECTING</span><br><span class="line">2018-08-07 02:45:36.287 UTC [grpc] Printf -&gt; DEBU 04c pickfirstBalancer: HandleSubConnStateChange: 0xc42025aed0, READY</span><br><span class="line">2018-08-07 02:45:36.314 UTC [channelCmd] update -&gt; INFO 04d Successfully submitted channel update</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-实例化测试">Hyperledger Fabric 实例化测试</span></h2>
<blockquote>
<p>在上面我们已经拷贝了官方的例子，在 chaincode 下, 下面我们来测试一下</p>
</blockquote>
<h3><span id="安装智能合约">安装智能合约</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># cli 部分  ./chaincode/go/:/opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line"># 为 智能合约的目录 我们约定为这个目录 需要预先创建 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir -p /opt/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line">cd /opt/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line"># 创建以后~我们拷贝官方的 例子进来，方便后面进行合约测试</span><br><span class="line"></span><br><span class="line">cp -r /opt/gopath/src/github.com/hyperledger/fabric/examples/chaincode/go/example0* /opt/jicki/chaincode/go/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 官方这里有5个例子</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# ls -lt chaincode/go/</span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug  7 10:46 example01</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug  7 10:46 example02</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug  7 10:46 example03</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug  7 10:46 example04</span><br><span class="line">drwxr-xr-x 3 root root 4096 Aug  7 10:46 example05</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 如上我们挂载的地址为 github.com/hyperledger/fabric/jicki/chaincode/go</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注: 这里面的 example02 的 package 为 example02 会报错</span><br><span class="line"></span><br><span class="line">Error: could not assemble transaction, err Proposal response was not successful, error code 500, msg failed to execute transaction 819b581ce88604e9b6651764324876f2ca7a47d7aeb7ee307f273af867a4a134: error starting container: error starting container: API error (404): oci runtime error: container_linux.go:247: starting container process caused &quot;exec: \&quot;chaincode\&quot;: executable file not found in $PATH&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 将 chaincode.go  chaincode_test.go 中  package 修改成 main 然后在最下面增加 main()函数</span><br><span class="line"></span><br><span class="line">func main() &#123;</span><br><span class="line">        err := shim.Start(new(SimpleChaincode))</span><br><span class="line">        if err != nil &#123;</span><br><span class="line">                fmt.Printf(&quot;Error starting Simple chaincode: %s&quot;, err)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 安装指定合约到 所有的 peer 节点中，每个节点都必须安装一次</span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org1MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org1.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/peers/peer0.org1.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.jicki.me/users/Admin@org1.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装 合约</span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/example02 -v 1.0   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:48:05.296 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:48:05.296 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:48:05.297 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:48:05.297 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:48:05.297 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:48:05.297 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:48:05.297 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc42049c2f0, CONNECTING</span><br><span class="line">2018-08-07 02:48:05.298 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42049c2f0, READY</span><br><span class="line">2018-08-07 02:48:05.298 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:48:05.298 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:48:05.298 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:48:05.298 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:48:05.299 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4202ce020, CONNECTING</span><br><span class="line">2018-08-07 02:48:05.299 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4202ce020, READY</span><br><span class="line">2018-08-07 02:48:05.300 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:48:05.300 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 044 Using default escc</span><br><span class="line">2018-08-07 02:48:05.300 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 045 Using default vscc</span><br><span class="line">2018-08-07 02:48:05.300 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 046 java chaincode disabled</span><br><span class="line">2018-08-07 02:48:05.338 UTC [golang-platform] getCodeFromFS -&gt; DEBU 047 getCodeFromFS github.com/hyperledger/fabric/jicki/chaincode/go/example02</span><br><span class="line">2018-08-07 02:48:05.450 UTC [golang-platform] func1 -&gt; DEBU 048 Discarding GOROOT package fmt</span><br><span class="line">2018-08-07 02:48:05.450 UTC [golang-platform] func1 -&gt; DEBU 049 Discarding provided package github.com/hyperledger/fabric/core/chaincode/shim</span><br><span class="line">2018-08-07 02:48:05.450 UTC [golang-platform] func1 -&gt; DEBU 04a Discarding provided package github.com/hyperledger/fabric/protos/peer</span><br><span class="line">2018-08-07 02:48:05.450 UTC [golang-platform] func1 -&gt; DEBU 04b Discarding GOROOT package strconv</span><br><span class="line">2018-08-07 02:48:05.450 UTC [golang-platform] func1 -&gt; DEBU 04c skipping dir: /opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/cmd</span><br><span class="line">2018-08-07 02:48:05.451 UTC [golang-platform] GetDeploymentPayload -&gt; DEBU 04d done</span><br><span class="line">2018-08-07 02:48:05.451 UTC [container] WriteFileToPackage -&gt; DEBU 04e Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode.go</span><br><span class="line">2018-08-07 02:48:05.451 UTC [container] WriteFileToPackage -&gt; DEBU 04f Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode_test.go</span><br><span class="line">2018-08-07 02:48:05.452 UTC [msp/identity] Sign -&gt; DEBU 050 Sign: plaintext: 0A98070A5C08031A0C08E590A4DB0510...C7F84F000000FFFFEB6FF30D00280000 </span><br><span class="line">2018-08-07 02:48:05.452 UTC [msp/identity] Sign -&gt; DEBU 051 Sign: digest: 4CBC4EA6119D83478DB9214C41CAFB439A4D5CE4C955B0989F4AA07B94238B1B </span><br><span class="line">2018-08-07 02:48:05.469 UTC [chaincodeCmd] install -&gt; INFO 052 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 安装指定合约到 所有的 peer 节点中，每个节点都必须安装一次</span><br><span class="line"></span><br><span class="line"># 同样需要先配置变量</span><br><span class="line"></span><br><span class="line">export CORE_PEER_LOCALMSPID=&quot;Org2MSP&quot;</span><br><span class="line">export CORE_PEER_ADDRESS=peer0.org2.jicki.me:7051</span><br><span class="line">export CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/peers/peer0.org2.jicki.me/tls/ca.crt</span><br><span class="line">export CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.jicki.me/users/Admin@org2.jicki.me/msp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装 合约</span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/example02 -v 1.0  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:48:24.440 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:48:24.441 UTC [msp] Validate -&gt; DEBU 036 MSP Org2MSP validating identity</span><br><span class="line">2018-08-07 02:48:24.441 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:48:24.441 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:48:24.441 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:48:24.441 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:48:24.441 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc420229510, CONNECTING</span><br><span class="line">2018-08-07 02:48:24.442 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc420229510, READY</span><br><span class="line">2018-08-07 02:48:24.442 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:48:24.442 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:48:24.442 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org2.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:48:24.442 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:48:24.443 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4202b8a20, CONNECTING</span><br><span class="line">2018-08-07 02:48:24.443 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4202b8a20, READY</span><br><span class="line">2018-08-07 02:48:24.444 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:48:24.444 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 044 Using default escc</span><br><span class="line">2018-08-07 02:48:24.444 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 045 Using default vscc</span><br><span class="line">2018-08-07 02:48:24.444 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 046 java chaincode disabled</span><br><span class="line">2018-08-07 02:48:24.481 UTC [golang-platform] getCodeFromFS -&gt; DEBU 047 getCodeFromFS github.com/hyperledger/fabric/jicki/chaincode/go/example02</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] func1 -&gt; DEBU 048 Discarding GOROOT package fmt</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] func1 -&gt; DEBU 049 Discarding provided package github.com/hyperledger/fabric/core/chaincode/shim</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] func1 -&gt; DEBU 04a Discarding provided package github.com/hyperledger/fabric/protos/peer</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] func1 -&gt; DEBU 04b Discarding GOROOT package strconv</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] func1 -&gt; DEBU 04c skipping dir: /opt/gopath/src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/cmd</span><br><span class="line">2018-08-07 02:48:24.588 UTC [golang-platform] GetDeploymentPayload -&gt; DEBU 04d done</span><br><span class="line">2018-08-07 02:48:24.588 UTC [container] WriteFileToPackage -&gt; DEBU 04e Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode.go</span><br><span class="line">2018-08-07 02:48:24.589 UTC [container] WriteFileToPackage -&gt; DEBU 04f Writing file to tarball: src/github.com/hyperledger/fabric/jicki/chaincode/go/example02/chaincode_test.go</span><br><span class="line">2018-08-07 02:48:24.589 UTC [msp/identity] Sign -&gt; DEBU 050 Sign: plaintext: 0A98070A5C08031A0C08F890A4DB0510...C7F84F000000FFFFEB6FF30D00280000 </span><br><span class="line">2018-08-07 02:48:24.589 UTC [msp/identity] Sign -&gt; DEBU 051 Sign: digest: 8322AEA3AA9478AC330B78C685B29F2FD85505EBC838DB13A71BEB58AFD822B9 </span><br><span class="line">2018-08-07 02:48:24.606 UTC [chaincodeCmd] install -&gt; INFO 052 Installed remotely response:&lt;status:200 payload:&quot;OK&quot; &gt;</span><br></pre></td></tr></table></figure>
<h3><span id="实例化-chaincode">实例化 Chaincode</span></h3>
<blockquote>
<p>这里无论多少个 peer 节点, 实例化只需要实例化一次，就可以。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"># 实例化合约 (未认证)</span><br><span class="line">peer chaincode instantiate -o orderer0.jicki.me:7050 -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;200&quot;,&quot;B&quot;,&quot;500&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 实例化合约 (已认证)</span><br><span class="line">peer chaincode instantiate -o orderer0.jicki.me:7050 --tls $CORE_PEER_TLS_ENABLED --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/jicki.me/orderers/orderer0.jicki.me/msp/tlscacerts/tlsca.jicki.me-cert.pem -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;100&quot;,&quot;B&quot;,&quot;50&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:49:00.544 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:49:00.544 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:49:00.545 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:49:00.545 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:49:00.545 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:49:00.545 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:49:00.545 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4204ca910, CONNECTING</span><br><span class="line">2018-08-07 02:49:00.546 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4204ca910, READY</span><br><span class="line">2018-08-07 02:49:00.546 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:49:00.546 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:49:00.546 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:49:00.546 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:49:00.547 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc420549310, CONNECTING</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc420549310, READY</span><br><span class="line">2018-08-07 02:49:00.548 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 044 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 045 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 046 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 047 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 048 pickfirstBalancer: HandleSubConnStateChange: 0xc42006b380, CONNECTING</span><br><span class="line">2018-08-07 02:49:00.548 UTC [grpc] Printf -&gt; DEBU 049 pickfirstBalancer: HandleSubConnStateChange: 0xc42006b380, READY</span><br><span class="line">2018-08-07 02:49:00.548 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 04a Using default escc</span><br><span class="line">2018-08-07 02:49:00.548 UTC [chaincodeCmd] checkChaincodeCmdParams -&gt; INFO 04b Using default vscc</span><br><span class="line">2018-08-07 02:49:00.549 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 04c java chaincode disabled</span><br><span class="line">2018-08-07 02:49:00.549 UTC [msp/identity] Sign -&gt; DEBU 04d Sign: plaintext: 0AA3070A6708031A0C089C91A4DB0510...324D53500A04657363630A0476736363 </span><br><span class="line">2018-08-07 02:49:00.549 UTC [msp/identity] Sign -&gt; DEBU 04e Sign: digest: 1852003550AFAEB4A9DD2F01A3F4DA89346E64FCC1B6056D45CCC297A9763A1F </span><br><span class="line">2018-08-07 02:49:13.285 UTC [msp/identity] Sign -&gt; DEBU 04f Sign: plaintext: 0AA3070A6708031A0C089C91A4DB0510...46C5367A5E41CCC7C4704B72B4D5F2D4 </span><br><span class="line">2018-08-07 02:49:13.285 UTC [msp/identity] Sign -&gt; DEBU 050 Sign: digest: 8D57F12A907CA041F15725217B3EC56FC52C2E4A5A9FF8578FD90C18AC65F817</span><br></pre></td></tr></table></figure>
<h3><span id="操作智能合约">操作智能合约</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># query 查询方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查询 A 账户里的余额</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:49:40.807 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:49:40.807 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:49:40.807 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:49:40.807 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:49:40.807 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:49:40.807 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:49:40.808 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4201b5510, CONNECTING</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4201b5510, READY</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc420232a20, CONNECTING</span><br><span class="line">2018-08-07 02:49:40.809 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc420232a20, READY</span><br><span class="line">2018-08-07 02:49:40.811 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:49:40.811 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 044 java chaincode disabled</span><br><span class="line">2018-08-07 02:49:40.811 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AA7070A6B08031A0C08C491A4DB0510...706C65321A0A0A0571756572790A0141 </span><br><span class="line">2018-08-07 02:49:40.811 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: CD3360D1248F37AC518F8B9D55B46BA976526A6D115AE68A2EC3A93423C22D7C </span><br><span class="line">200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到 返回 200</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 查询 B 账户里的余额</span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:50:09.596 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:50:09.596 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc42053fc70, CONNECTING</span><br><span class="line">2018-08-07 02:50:09.597 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc42053fc70, READY</span><br><span class="line">2018-08-07 02:50:09.598 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:50:09.598 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:50:09.598 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:50:09.598 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:50:09.598 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc420247180, CONNECTING</span><br><span class="line">2018-08-07 02:50:09.599 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc420247180, READY</span><br><span class="line">2018-08-07 02:50:09.599 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:50:09.599 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 044 java chaincode disabled</span><br><span class="line">2018-08-07 02:50:09.599 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AA7070A6B08031A0C08E191A4DB0510...706C65321A0A0A0571756572790A0142 </span><br><span class="line">2018-08-07 02:50:09.599 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: 1C28B767E687B1C2D9CCE05C14735F2C8D250BA3C8442F3EB077BADFCFB1D65B </span><br><span class="line">500</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到 返回 500</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># invoke 转账方法</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 从A账户 转账 20 个币 到 B 账户</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">peer chaincode invoke -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;invoke&quot;, &quot;A&quot;, &quot;B&quot;, &quot;100&quot;]&#125;&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:50:40.962 UTC [grpc] Printf -&gt; DEBU 0bf parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:50:40.962 UTC [grpc] Printf -&gt; DEBU 0c0 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:50:40.962 UTC [grpc] Printf -&gt; DEBU 0c1 ccResolverWrapper: sending new addresses to cc: [&#123;orderer0.jicki.me:7050 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:50:40.962 UTC [grpc] Printf -&gt; DEBU 0c2 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:50:40.962 UTC [grpc] Printf -&gt; DEBU 0c3 pickfirstBalancer: HandleSubConnStateChange: 0xc4202e6bc0, CONNECTING</span><br><span class="line">2018-08-07 02:50:40.963 UTC [grpc] Printf -&gt; DEBU 0c4 pickfirstBalancer: HandleSubConnStateChange: 0xc4202e6bc0, READY</span><br><span class="line">2018-08-07 02:50:40.963 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 0c5 java chaincode disabled</span><br><span class="line">2018-08-07 02:50:40.963 UTC [msp/identity] Sign -&gt; DEBU 0c6 Sign: plaintext: 0AA7070A6B08031A0C088092A4DB0510...6E766F6B650A01410A01420A03313030 </span><br><span class="line">2018-08-07 02:50:40.963 UTC [msp/identity] Sign -&gt; DEBU 0c7 Sign: digest: A9C3D9F911BBD38516C15CC0AABF05588F4EDCBE8686AFA59947A62EE12F41F4 </span><br><span class="line">2018-08-07 02:50:40.972 UTC [msp/identity] Sign -&gt; DEBU 0c8 Sign: plaintext: 0AA7070A6B08031A0C088092A4DB0510...8144630C48C565D11D1AA2562DB4FB70 </span><br><span class="line">2018-08-07 02:50:40.972 UTC [msp/identity] Sign -&gt; DEBU 0c9 Sign: digest: 0E9C53305451D3168CA61B8E525C416822E24A4C2C57ECE908C51C7A3F671B8D </span><br><span class="line">2018-08-07 02:50:40.978 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; DEBU 0ca ESCC invoke result: version:1 response:&lt;status:200 &gt; payload:&quot;\n ~\303\035uF\270\254\024\3655\272|.\006\217\362&#125;\242\340\311\270_\354&#125;\353q\303Y\324\352J\000\022f\nN\0222\n\010example2\022&amp;\n\007\n\001A\022\002\010\003\n\007\n\001B\022\002\010\003\032\010\n\001A\032\003100\032\010\n\001B\032\003600\022\030\n\004lscc\022\020\n\016\n\010example2\022\002\010\003\032\003\010\310\001\&quot;\017\022\010example2\032\0031.0&quot; endorsement:&lt;endorser:&quot;\n\007Org1MSP\022\216\006-----BEGIN CERTIFICATE-----\nMIICEzCCAbqgAwIBAgIRALNKLIQGXYydTA4WqXE0UUwwCgYIKoZIzj0EAwIwZzEL\nMAkGA1UEBhMCQ04xEjAQBgNVBAgTCUd1YW5nRG9uZzERMA8GA1UEBxMIU2hlblpo\nZW4xFjAUBgNVBAoTDW9yZzEuamlja2kubWUxGTAXBgNVBAMTEGNhLm9yZzEuamlj\na2kubWUwHhcNMTgwODA2MDY0MDU0WhcNMjgwODAzMDY0MDU0WjBhMQswCQYDVQQG\nEwJDTjESMBAGA1UECBMJR3VhbmdEb25nMREwDwYDVQQHEwhTaGVuWmhlbjENMAsG\nA1UECxMEcGVlcjEcMBoGA1UEAxMTcGVlcjAub3JnMS5qaWNraS5tZTBZMBMGByqG\nSM49AgEGCCqGSM49AwEHA0IABIJsThrTC3lNx4L97bB7YopOLaQNoCXhi/KAeMur\neYOchSQh3LbTb2dvf9hlW1DlN5y+QjrxAo9QNn6/fMk74uGjTTBLMA4GA1UdDwEB\n/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1UdIwQkMCKAIExyclAVcPAhAWcUhubH\njfdv0sZOnU6wmqcDppjwTTFZMAoGCCqGSM49BAMCA0cAMEQCIEFjh/Q1281Puzjg\n7c5/BhCv8+HvDM8lQZ3kHV3CQzTsAiAJ2cWndgCLFoXqiCqo1xzEcEHNO1O9c9sn\ngnPbCBvW4g==\n-----END CERTIFICATE-----\n&quot; signature:&quot;0E\002!\000\241\244i\001\225.y1e\225@\261\003\322\275\326\013[\364\304Ri7I\304\024\361#\\_J`\002 e\310\335&amp;\241\376\270EHh4\246\010Y\264\270\201Dc\014H\305e\321\035\032\242V-\264\373p&quot; &gt; </span><br><span class="line">2018-08-07 02:50:40.978 UTC [chaincodeCmd] chaincodeInvokeOrQuery -&gt; INFO 0cb Chaincode invoke successful. result: status:200</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到返回 invoke successful. result: status:200 成功</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 这里再查询 A 与 B 的账户</span><br><span class="line"></span><br><span class="line"># A 账户余额 </span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;A&quot;]&#125;&apos;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:51:09.356 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:51:09.356 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:51:09.357 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:51:09.357 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:51:09.357 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:51:09.357 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:51:09.357 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc420533510, CONNECTING</span><br><span class="line">2018-08-07 02:51:09.358 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc420533510, READY</span><br><span class="line">2018-08-07 02:51:09.358 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:51:09.358 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:51:09.358 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:51:09.358 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:51:09.359 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc4205db310, CONNECTING</span><br><span class="line">2018-08-07 02:51:09.359 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc4205db310, READY</span><br><span class="line">2018-08-07 02:51:09.360 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:51:09.360 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 044 java chaincode disabled</span><br><span class="line">2018-08-07 02:51:09.360 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AA7070A6B08031A0C089D92A4DB0510...706C65321A0A0A0571756572790A0141 </span><br><span class="line">2018-08-07 02:51:09.360 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: 4551936C8DDCEC3821AB6868B5D9162D86B31B32E1A34585CC3E70B06C717C83 </span><br><span class="line">100</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># B 账户余额 </span><br><span class="line"></span><br><span class="line">peer chaincode query -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;query&quot;,&quot;B&quot;]&#125;&apos;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 输出如下:</span><br><span class="line"></span><br><span class="line">2018-08-07 02:51:34.433 UTC [msp] setupSigningIdentity -&gt; DEBU 035 Signing identity expires at 2028-08-03 06:40:54 +0000 UTC</span><br><span class="line">2018-08-07 02:51:34.433 UTC [msp] Validate -&gt; DEBU 036 MSP Org1MSP validating identity</span><br><span class="line">2018-08-07 02:51:34.434 UTC [grpc] Printf -&gt; DEBU 037 parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:51:34.434 UTC [grpc] Printf -&gt; DEBU 038 scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:51:34.434 UTC [grpc] Printf -&gt; DEBU 039 ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:51:34.434 UTC [grpc] Printf -&gt; DEBU 03a ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:51:34.434 UTC [grpc] Printf -&gt; DEBU 03b pickfirstBalancer: HandleSubConnStateChange: 0xc4202e7150, CONNECTING</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 03c pickfirstBalancer: HandleSubConnStateChange: 0xc4202e7150, READY</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 03d parsed scheme: &quot;&quot;</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 03e scheme &quot;&quot; not registered, fallback to default scheme</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 03f ccResolverWrapper: sending new addresses to cc: [&#123;peer0.org1.jicki.me:7051 0  &lt;nil&gt;&#125;]</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 040 ClientConn switching balancer to &quot;pick_first&quot;</span><br><span class="line">2018-08-07 02:51:34.435 UTC [grpc] Printf -&gt; DEBU 041 pickfirstBalancer: HandleSubConnStateChange: 0xc42050a660, CONNECTING</span><br><span class="line">2018-08-07 02:51:34.436 UTC [grpc] Printf -&gt; DEBU 042 pickfirstBalancer: HandleSubConnStateChange: 0xc42050a660, READY</span><br><span class="line">2018-08-07 02:51:34.437 UTC [msp] GetDefaultSigningIdentity -&gt; DEBU 043 Obtaining default signing identity</span><br><span class="line">2018-08-07 02:51:34.437 UTC [chaincodeCmd] getChaincodeSpec -&gt; DEBU 044 java chaincode disabled</span><br><span class="line">2018-08-07 02:51:34.437 UTC [msp/identity] Sign -&gt; DEBU 045 Sign: plaintext: 0AA7070A6B08031A0C08B692A4DB0510...706C65321A0A0A0571756572790A0142 </span><br><span class="line">2018-08-07 02:51:34.437 UTC [msp/identity] Sign -&gt; DEBU 046 Sign: digest: EE474CDC8DD863E3F9163AE8A73CE43EF25C9FF417DD940EE133BDC1A6646CB8 </span><br><span class="line">600</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 查看 peer0.org1.jicki.me 节点里 生成的容器</span><br><span class="line"></span><br><span class="line">[root@localhost jicki]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                                                                                                     COMMAND                  CREATED             STATUS              PORTS                                                                                         NAMES</span><br><span class="line">ddb72b9ca769        jicki-peer0.org1.jicki.me-example2-1.0-58e362edb293b97212b572bd603337608795d8168a8a3632d2a14ac12fa6ae70   &quot;chaincode -peer.add…&quot;   2 minutes ago       Up 2 minutes                                                                                                      jicki-peer0.org1.jicki.me-example2-1.0</span><br></pre></td></tr></table></figure>
<h2><span id="hyperledger-fabric-操作命令">Hyperledger Fabric 操作命令</span></h2>
<h3><span id="peer-命令">peer 命令</span></h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">peer chaincode          # 对链进行操作</span><br><span class="line">peer channel            # channel相关操作</span><br><span class="line">peer logging            # 设置日志级别</span><br><span class="line">peer node               # 启动、管理节点</span><br><span class="line">peer version            # 查看版本信息</span><br></pre></td></tr></table></figure>
<blockquote>
<p>upgrade 更新合约 更新合约相当于将合约重新实例化，并带有一个新的版本号。</p>
<p>更新合约之前，需要在所有的 peer节点 上安装(install)最新的合约，并使用新的版本号。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 更新合约</span><br><span class="line"></span><br><span class="line"># 首先安装(install)新的合约, 以本文为例, chaincode_example02, 初次安装版本号为 1.0 </span><br><span class="line"></span><br><span class="line">peer chaincode install -n example2 -p github.com/hyperledger/fabric/jicki/chaincode/go/chaincode_example02 -v 1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 更新版本为 1.1 的合约</span><br><span class="line">peer chaincode upgrade -o orderer0.jicki.me:7050 -C mychannel -n example2 -c &apos;&#123;&quot;Args&quot;:[&quot;init&quot;,&quot;A&quot;,&quot;100&quot;,&quot;B&quot;,&quot;50&quot;]&#125;&apos; -P &quot;OR (&apos;Org1MSP.member&apos;,&apos;Org2MSP.member&apos;)&quot; -v 1.1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 旧版本的合约, 目前，fabric不支持合约的启动与暂停。要暂停或删除合约，只能到peer上手动删除容器。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 查看 已经创建的 通道 (channel)</span><br><span class="line"></span><br><span class="line">peer channel  list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看通道(channel) 的状态 -c(小写) 加 通道名称</span><br><span class="line"></span><br><span class="line">peer channel getinfo -c mychannel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看已经 安装的 智能合约(chincode)</span><br><span class="line"></span><br><span class="line">peer chaincode  list --installed</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 查看已经 实例化的 智能合约(chincode) 需要使用 -C(大写) 加通道名称</span><br><span class="line"></span><br><span class="line">peer chaincode -C mychannel list --instantiated</span><br></pre></td></tr></table></figure>

                

                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/01/30/2018-02-08-kubernetes-jenkins/" data-toggle="tooltip" data-placement="top" title="kubernetes jenkins">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/01/30/2018-01-09-openshift-3.7.0/" data-toggle="tooltip" data-placement="top" title="openshift origin 3.7">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share" data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                    <div class="comment">
                        <div id="disqus_thread" class="disqus-thread"></div>
                    </div>
                
                <!-- disqus comment end -->

                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">部署 hyperledger-fabric v1.2</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">环境规划</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">官方地址</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">环境准备</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">Hyperledger Fabric 源码</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.5.</span> <span class="toc-nav-text">生成 Hyperledger Fabric 证书</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.6.</span> <span class="toc-nav-text">生成 Hyperledger Fabric 创世区块</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.</span> <span class="toc-nav-text">配置 Zookeeper Kafka 集群</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.1.</span> <span class="toc-nav-text">第一个节点 (192.168.100.67)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.2.</span> <span class="toc-nav-text">第二个节点 (192.168.100.15)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.7.3.</span> <span class="toc-nav-text">第三个节点 (192.168.100.91)</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.</span> <span class="toc-nav-text">配置 Hyperledger Fabric Orderer</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">1.8.1.</span> <span class="toc-nav-text">第一个节点 (192.168.100.67)</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">创建文件 docker-compose-orderer.yaml</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">创建于 /opt/jicki 目录下</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.0.1.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">配置 Hyperledger Fabric peer</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.1.</span> <span class="toc-nav-text">第二个节点 (192.168.100.15)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.2.</span> <span class="toc-nav-text">第三个节点 (192.168.100.91)</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.1.3.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">配置 Hyperledger Fabric cli 客户端</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.2.1.</span> <span class="toc-nav-text">启动服务</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">Hyperledger Fabric 创建 Channel</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">Hyperledger Fabric 加入 Channel</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.5.</span> <span class="toc-nav-text">Hyperledger Fabric 锚节点</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.6.</span> <span class="toc-nav-text">Hyperledger Fabric 实例化测试</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.6.1.</span> <span class="toc-nav-text">安装智能合约</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.6.2.</span> <span class="toc-nav-text">实例化 Chaincode</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.6.3.</span> <span class="toc-nav-text">操作智能合约</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.7.</span> <span class="toc-nav-text">Hyperledger Fabric 操作命令</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#undefined"><span class="toc-nav-number">3.7.1.</span> <span class="toc-nav-text">peer 命令</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://www.jicki.me" target="_blank">小炒肉</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>




<!-- disqus embedded js code start (one page only need to embed once) -->
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = "jicki";
    var disqus_identifier = "https://www.jicki.me/2019/01/30/2018-08-07-hyperledger-fabric-1.2/";
    var disqus_url = "https://www.jicki.me/2019/01/30/2018-08-07-hyperledger-fabric-1.2/";

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<!-- disqus embedded js code start end -->





<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                    <li>
                        <a target="_blank" href="https://twitter.com/jicki234">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/jicki520">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://github.com/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/jicki">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 小炒肉 2019 
                    <br>
                    Theme by <a href="http://beantech.org">BeanTech</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="http://www.huweihuang.com">胡伟煌</a> | 
                    <iframe style="margin-left: 2px; margin-bottom:-5px;" frameborder="0" scrolling="0" width="91px" height="20px" src="https://ghbtns.com/github-btn.html?user=huweihuang&repo=hexo-theme-huweihuang&type=star&count=true">
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://www.jicki.me/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-85602329-1';
    var _gaDomain = 'jicki.me';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '1b38b88e4559c6725330b8c3328e2de3';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://www.jicki.me/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
